# interpElections

Spatial interpolation of electoral data via **column-normalized inverse
distance weighting**. Disaggregates point-level data (e.g., polling
station vote counts) into polygon-level estimates (e.g., census tracts)
using travel-time-based IDW with per-zone decay parameters calibrated
against demographic totals. Column normalization ensures source
conservation (each source distributes exactly 100% of its data).

## Installation

``` r
# install.packages("remotes")
remotes::install_github("antrologos/interpElections")
```

Optional:
[`setup_torch()`](https://antrologos.github.io/interpElections/reference/setup_torch.md)
for GPU optimization,
[`setup_java()`](https://antrologos.github.io/interpElections/reference/setup_java.md)
for r5r travel-time routing.

## Quick start

``` r
library(interpElections)

result <- interpolate_election_br(3550308, 2022)
plot(result)
```

Three lines: downloads census data, electoral results, and road
networks; computes travel times; optimizes per-tract decay; interpolates
all variables into census tracts.

## Advanced usage

Control objects group tuning parameters for optimization and routing:

``` r
result <- interpolate_election_br(3550308, 2022,
  optim = optim_control(use_gpu = TRUE, max_epochs = 1000),
  routing = routing_control(mode = c("WALK", "TRANSIT"),
                            gtfs_zip_path = "sptrans.zip")
)
```

## Custom data

``` r
result <- interpolate_election(
  tracts_sf     = my_zones,
  electoral_sf  = my_sources,
  tract_id      = "zone_id",
  point_id      = "source_id",
  calib_tracts  = c("pop_young", "pop_old"),
  calib_sources = c("count_young", "count_old"),
  time_matrix   = my_travel_times
)
```

## How it works

For each tract *i* and source *j*, the IDW kernel is:

$$W_{ij} = \left( t_{ij} + 1 \right)^{- \alpha_{i}}$$

Weights are **column-normalized** so that column sums equal 1 (each
source distributes exactly 100% of its data). The optimal alpha is found
by minimizing the Poisson deviance between interpolated and census
demographics via **torch ADAM** with a log-barrier penalty.

## Vignettes

| Vignette                                                                                                | Description                                                             |
|---------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
| [Get Started](https://antrologos.github.io/interpElections/articles/get-started.html)                   | Brazilian examples (Varginha + Igrejinha), general case, core functions |
| [Methodology](https://antrologos.github.io/interpElections/articles/methodology.html)                   | Full pipeline walkthrough with equations, visualizations, and real data |
| [Working with Results](https://antrologos.github.io/interpElections/articles/working-with-results.html) | S3 methods, plotting, validation, areal aggregation                     |

## Function reference

| Category          | Functions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Interpolation** | [`interpolate_election_br()`](https://antrologos.github.io/interpElections/reference/interpolate_election_br.md), [`interpolate_election()`](https://antrologos.github.io/interpElections/reference/interpolate_election.md), [`reinterpolate()`](https://antrologos.github.io/interpElections/reference/reinterpolate.md), [`optimize_alpha()`](https://antrologos.github.io/interpElections/reference/optimize_alpha.md), [`compute_weight_matrix()`](https://antrologos.github.io/interpElections/reference/compute_weight_matrix.md), [`compute_travel_times()`](https://antrologos.github.io/interpElections/reference/compute_travel_times.md) |
| **Control**       | [`optim_control()`](https://antrologos.github.io/interpElections/reference/optim_control.md), [`routing_control()`](https://antrologos.github.io/interpElections/reference/routing_control.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Results**       | [`summary()`](https://rdrr.io/r/base/summary.html), [`plot()`](https://rdrr.io/r/graphics/plot.default.html), `autoplot()`, [`coef()`](https://rdrr.io/r/stats/coef.html), [`residuals()`](https://rdrr.io/r/stats/residuals.html), [`as.data.frame()`](https://rdrr.io/r/base/as.data.frame.html), [`plot_interactive()`](https://antrologos.github.io/interpElections/reference/plot_interactive.md)                                                                                                                                                                                                                                               |
| **Spatial**       | [`areal_weights()`](https://antrologos.github.io/interpElections/reference/areal_weights.md), [`areal_interpolate()`](https://antrologos.github.io/interpElections/reference/areal_interpolate.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Setup**         | [`setup_torch()`](https://antrologos.github.io/interpElections/reference/setup_torch.md), [`use_gpu()`](https://antrologos.github.io/interpElections/reference/use_gpu.md), [`setup_java()`](https://antrologos.github.io/interpElections/reference/setup_java.md), [`interpElections_cache()`](https://antrologos.github.io/interpElections/reference/interpElections_cache.md)                                                                                                                                                                                                                                                                     |

## GPU acceleration

``` r
setup_torch()     # one-time installation
use_gpu(TRUE)     # enable globally

# Or per-call via control objects:
result <- interpolate_election_br(3550308, 2022,
  optim = optim_control(use_gpu = TRUE))
```

GPU (CUDA/MPS) is recommended for municipalities with \>1,000 census
tracts. CPU works for all problem sizes.

## Citation

> Barbosa, R. & Gelape, L. (2025). *interpElections: Spatial
> Interpolation of Electoral Data via Inverse Distance Weighting*. R
> package version 0.1.0. <https://github.com/antrologos/interpElections>

## License

MIT

# Package index

## Interpolation

High-level wrappers and core optimization engine.

- [`interpolate_election_br()`](https://antrologos.github.io/interpElections/reference/interpolate_election_br.md)
  : Interpolate Brazilian election data into census tracts
- [`interpolate_election()`](https://antrologos.github.io/interpElections/reference/interpolate_election.md)
  : One-step IDW interpolation from source points to census tracts
- [`reinterpolate()`](https://antrologos.github.io/interpElections/reference/reinterpolate.md)
  : Re-interpolate with different electoral variables
- [`optimize_alpha()`](https://antrologos.github.io/interpElections/reference/optimize_alpha.md)
  : Find optimal decay parameters (alpha) for spatial interpolation
- [`compute_weight_matrix()`](https://antrologos.github.io/interpElections/reference/compute_weight_matrix.md)
  : Compute the weight matrix
- [`compute_travel_times()`](https://antrologos.github.io/interpElections/reference/compute_travel_times.md)
  : Compute a travel-time matrix from census tract representative points
  to source points

## Control Objects

Group tuning parameters for optimization and routing.

- [`optim_control()`](https://antrologos.github.io/interpElections/reference/optim_control.md)
  : Optimization control parameters
- [`routing_control()`](https://antrologos.github.io/interpElections/reference/routing_control.md)
  : Routing control parameters

## Results

S3 methods for inspecting, plotting, and exporting results.

- [`summary(`*`<interpElections_result>`*`)`](https://antrologos.github.io/interpElections/reference/summary.interpElections_result.md)
  : Summarize an interpElections result
- [`plot(`*`<interpElections_result>`*`)`](https://antrologos.github.io/interpElections/reference/plot.interpElections_result.md)
  [`autoplot(`*`<interpElections_result>`*`)`](https://antrologos.github.io/interpElections/reference/plot.interpElections_result.md)
  : Plot an interpolated variable as a choropleth map
- [`plot_interactive()`](https://antrologos.github.io/interpElections/reference/plot_interactive.md)
  : Interactive map of interpolated results
- [`coef(`*`<interpElections_result>`*`)`](https://antrologos.github.io/interpElections/reference/coef.interpElections_result.md)
  : Extract alpha coefficients
- [`residuals(`*`<interpElections_result>`*`)`](https://antrologos.github.io/interpElections/reference/residuals.interpElections_result.md)
  : Compute calibration residuals
- [`as.data.frame(`*`<interpElections_result>`*`)`](https://antrologos.github.io/interpElections/reference/as.data.frame.interpElections_result.md)
  : Convert result to data frame

## Diagnostics

Model validation, residual analysis, and weight matrix diagnostics.

- [`diagnostics()`](https://antrologos.github.io/interpElections/reference/diagnostics.md)
  : Run diagnostic checks on an interpolation result
- [`print(`*`<interpElections_diagnostics>`*`)`](https://antrologos.github.io/interpElections/reference/print.interpElections_diagnostics.md)
  : Print method for interpElections_diagnostics
- [`plot_convergence()`](https://antrologos.github.io/interpElections/reference/plot_convergence.md)
  : Plot optimization convergence diagnostics
- [`plot_alpha()`](https://antrologos.github.io/interpElections/reference/plot_alpha.md)
  : Plot alpha decay parameter diagnostics
- [`plot_residuals()`](https://antrologos.github.io/interpElections/reference/plot_residuals.md)
  : Plot calibration residual diagnostics
- [`residual_summary()`](https://antrologos.github.io/interpElections/reference/residual_summary.md)
  : Tabular residual summary
- [`plot_weights()`](https://antrologos.github.io/interpElections/reference/plot_weights.md)
  : Plot weight matrix diagnostics
- [`plot_connections()`](https://antrologos.github.io/interpElections/reference/plot_connections.md)
  : Plot tract-station connections
- [`weight_summary()`](https://antrologos.github.io/interpElections/reference/weight_summary.md)
  : Summarize weight matrix properties per tract
- [`plot_travel_times()`](https://antrologos.github.io/interpElections/reference/plot_travel_times.md)
  : Plot travel time matrix diagnostics
- [`plot_residual_autocorrelation()`](https://antrologos.github.io/interpElections/reference/plot_residual_autocorrelation.md)
  : Test residuals for spatial autocorrelation
- [`plot_moran()`](https://antrologos.github.io/interpElections/reference/plot_moran.md)
  : Moran's I and LISA cluster map for an interpolated variable
- [`compare_baselines()`](https://antrologos.github.io/interpElections/reference/compare_baselines.md)
  : Compare interpolation against baseline methods
- [`leave_one_out()`](https://antrologos.github.io/interpElections/reference/leave_one_out.md)
  : Leave-one-out pseudo cross-validation
- [`plot_income()`](https://antrologos.github.io/interpElections/reference/plot_income.md)
  : Plot income-vote ecological correlation
- [`plot_turnout_rates()`](https://antrologos.github.io/interpElections/reference/plot_turnout_rates.md)
  : Plot implied turnout rates by demographic bracket
- [`plot_ecological()`](https://antrologos.github.io/interpElections/reference/plot_ecological.md)
  : Cross-election consistency check

## Spatial Utilities

Reaggregate interpolated results into larger zones.

- [`areal_weights()`](https://antrologos.github.io/interpElections/reference/areal_weights.md)
  : Compute area-weighted intersection matrix between two polygon layers
- [`areal_interpolate()`](https://antrologos.github.io/interpElections/reference/areal_interpolate.md)
  : Aggregate data from source zones to target polygons using areal
  weights

## Setup

Configure GPU, Java, and cache.

- [`setup_java()`](https://antrologos.github.io/interpElections/reference/setup_java.md)
  : Download and configure Java 21 for r5r
- [`setup_torch()`](https://antrologos.github.io/interpElections/reference/setup_torch.md)
  : Install and configure torch with GPU support
- [`use_gpu()`](https://antrologos.github.io/interpElections/reference/use_gpu.md)
  : Enable or disable GPU acceleration
- [`interpElections_cache()`](https://antrologos.github.io/interpElections/reference/interpElections_cache.md)
  : Manage the interpElections download cache

## Data

Bundled reference datasets.

- [`muni_crosswalk`](https://antrologos.github.io/interpElections/reference/muni_crosswalk.md)
  : IBGE-TSE Municipality Code Crosswalk
- [`br_election_dates`](https://antrologos.github.io/interpElections/reference/br_election_dates.md)
  : Brazilian election dates

# Articles

### Getting Started

- [Get Started with
  interpElections](https://antrologos.github.io/interpElections/articles/get-started.md):

### Technical

- [Methodology](https://antrologos.github.io/interpElections/articles/methodology.md):

### Advanced

- [Working with
  Results](https://antrologos.github.io/interpElections/articles/working-with-results.md):
- [Diagnostics and
  Validation](https://antrologos.github.io/interpElections/articles/diagnostics.md):
