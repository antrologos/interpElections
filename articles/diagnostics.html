<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Diagnostics and Validation • interpElections</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostics and Validation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">interpElections</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/get-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Technical</h6></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/working-with-results.html">Working with Results</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostics.html">Diagnostics &amp; Validation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/interpElections/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Diagnostics and Validation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antrologos/interpElections/blob/HEAD/vignettes/diagnostics.Rmd" class="external-link"><code>vignettes/diagnostics.Rmd</code></a></small>
      <div class="d-none name"><code>diagnostics.Rmd</code></div>
    </div>

    
    
<p>interpElections provides 16 diagnostic functions for validating
interpolation results. This vignette demonstrates each one using
<strong>real data</strong> from four Brazilian municipalities of varying
sizes:</p>
<table class="table">
<thead><tr class="header">
<th align="left">City</th>
<th align="left">State</th>
<th align="right">Tracts</th>
<th align="right">Sources</th>
<th align="left">Character</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Igrejinha</td>
<td align="left">RS</td>
<td align="right">~40</td>
<td align="right">~10</td>
<td align="left">Tiny rural municipality</td>
</tr>
<tr class="even">
<td align="left">Varginha</td>
<td align="left">MG</td>
<td align="right">~280</td>
<td align="right">~37</td>
<td align="left">Small city (primary example)</td>
</tr>
<tr class="odd">
<td align="left">Niteroi</td>
<td align="left">RJ</td>
<td align="right">~450</td>
<td align="right">~80</td>
<td align="left">Medium, dense urban area</td>
</tr>
<tr class="even">
<td align="left">Belo Horizonte</td>
<td align="left">MG</td>
<td align="right">~5,100</td>
<td align="right">~600</td>
<td align="left">Major metropolitan area</td>
</tr>
</tbody>
</table>
<p>Each section follows the pattern: <strong>Intuition</strong> (why it
matters), <strong>Formal definition</strong> (the math), <strong>Applied
example</strong> (real output), <strong>Interpretation</strong> (what to
look for).</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/interpElections/">interpElections</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load precomputed results (2022 presidential election)</span></span>
<span><span class="va">result_igr</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/igrejinha_2022.rds"</span><span class="op">)</span></span>
<span><span class="va">result_vga</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/varginha_2022.rds"</span><span class="op">)</span></span>
<span><span class="va">result_vga2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/varginha_2022_t2.rds"</span><span class="op">)</span>  <span class="co"># turno 2</span></span>
<span><span class="va">result_nit</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/niteroi_2022.rds"</span><span class="op">)</span></span>
<span><span class="va">result_bh</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/belo_horizonte_2022.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Quick overview of each result:</p>
<pre><code><span><span class="co">#&gt; interpElections result summary</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; Municipality: VARGINHA (MG) -- IBGE: 3170701, TSE: 54135</span></span>
<span><span class="co">#&gt; Election: 2022 | Census: 2022 | Turno: 1 | Cargo: PRESIDENTE </span></span>
<span><span class="co">#&gt; Census tracts: 279 | Sources: 37 | Variables: 28</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration: gender x 7 age brackets (14 pairs)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization: pb_sgd_colnorm_cpu | Objective: 5270.4629 | Convergence: 0</span></span>
<span><span class="co">#&gt;   Alpha: min=1.000, Q1=2.831, median=3.574, Q3=4.718, max=15.888</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Candidates (13):</span></span>
<span><span class="co">#&gt;   CAND_30                  LUIZ FELIPE CHAVES D AVILA (NOVO) total=       908  mean=     3.3  [0.1, 7.9]</span></span>
<span><span class="co">#&gt;   CAND_44                  SORAYA VIEIRA THRONICKE (UNIÃO) total=       385  mean=     1.4  [0.0, 3.2]</span></span>
<span><span class="co">#&gt;   CAND_12                  CIRO FERREIRA GOMES (PDT) total=      1835  mean=     6.6  [0.2, 14.9]</span></span>
<span><span class="co">#&gt;   CAND_13                  LUIZ INÁCIO LULA DA SILVA (PT) total=     24380  mean=    87.4  [2.0, 193.6]</span></span>
<span><span class="co">#&gt;   ... 9 more -- View(result$dictionary)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Turnout (1):</span></span>
<span><span class="co">#&gt;   QT_COMPARECIMENTO        turnout                total=     71308  mean=   255.6  [6.0, 553.1]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration (14):</span></span>
<span><span class="co">#&gt;   vot_hom_18_19            calibration            total=       917  mean=     3.3  [0.0, 20.0]</span></span>
<span><span class="co">#&gt;   vot_hom_20_24            calibration            total=      3551  mean=    12.7  [0.1, 56.0]</span></span>
<span><span class="co">#&gt;   vot_hom_25_29            calibration            total=      4033  mean=    14.5  [0.6, 51.3]</span></span>
<span><span class="co">#&gt;   vot_hom_30_39            calibration            total=      8291  mean=    29.7  [1.1, 76.5]</span></span>
<span><span class="co">#&gt;   vot_hom_40_49            calibration            total=      8164  mean=    29.3  [0.7, 77.1]</span></span>
<span><span class="co">#&gt;   vot_hom_50_59            calibration            total=      6975  mean=    25.0  [0.5, 97.1]</span></span>
<span><span class="co">#&gt;   vot_hom_60_69            calibration            total=      5737  mean=    20.6  [0.3, 47.1]</span></span>
<span><span class="co">#&gt;   vot_mul_18_19            calibration            total=      1189  mean=     4.3  [0.0, 16.7]</span></span>
<span><span class="co">#&gt;   vot_mul_20_24            calibration            total=      3699  mean=    13.3  [0.1, 63.7]</span></span>
<span><span class="co">#&gt;   vot_mul_25_29            calibration            total=      4167  mean=    14.9  [0.6, 37.1]</span></span>
<span><span class="co">#&gt;   vot_mul_30_39            calibration            total=      8661  mean=    31.0  [1.2, 86.2]</span></span>
<span><span class="co">#&gt;   vot_mul_40_49            calibration            total=      8960  mean=    32.1  [0.9, 79.2]</span></span>
<span><span class="co">#&gt;   vot_mul_50_59            calibration            total=      7639  mean=    27.4  [0.7, 62.7]</span></span>
<span><span class="co">#&gt;   vot_mul_60_69            calibration            total=      6406  mean=    23.0  [0.4, 50.6]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object size: 181.3 MB</span></span>
<span><span class="co">#&gt; Neighborhoods: 387</span></span></code></pre>
<pre><code><span><span class="co">#&gt; interpElections result summary</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; Municipality: BELO HORIZONTE (MG) -- IBGE: 3106200, TSE: 41238</span></span>
<span><span class="co">#&gt; Election: 2022 | Census: 2022 | Turno: 1 | Cargo: PRESIDENTE </span></span>
<span><span class="co">#&gt; Census tracts: 5109 | Sources: 407 | Variables: 28</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration: gender x 7 age brackets (14 pairs)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization: pb_sgd_colnorm_cuda | Objective: 9191.1953 | Convergence: 0</span></span>
<span><span class="co">#&gt;   Alpha: min=1.000, Q1=1.219, median=1.314, Q3=1.431, max=17.504</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Candidates (13):</span></span>
<span><span class="co">#&gt;   CAND_13                  LUIZ INÁCIO LULA DA SILVA (PT) total=    603542  mean=   118.1  [2.9, 324.0]</span></span>
<span><span class="co">#&gt;   CAND_27                  JOSE MARIA EYMAEL (DC) total=       209  mean=     0.0  [0.0, 0.2]</span></span>
<span><span class="co">#&gt;   CAND_30                  LUIZ FELIPE CHAVES D AVILA (NOVO) total=     14496  mean=     2.8  [0.1, 9.5]</span></span>
<span><span class="co">#&gt;   CAND_14                  KELMON LUIS DA SILVA SOUZA (PTB) total=       861  mean=     0.2  [0.0, 0.8]</span></span>
<span><span class="co">#&gt;   ... 9 more -- View(result$dictionary)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Turnout (1):</span></span>
<span><span class="co">#&gt;   QT_COMPARECIMENTO        turnout                total=   1489578  mean=   291.6  [7.1, 797.5]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration (14):</span></span>
<span><span class="co">#&gt;   vot_hom_18_19            calibration            total=     21044  mean=     4.1  [0.0, 12.2]</span></span>
<span><span class="co">#&gt;   vot_hom_20_24            calibration            total=     73593  mean=    14.4  [0.3, 42.9]</span></span>
<span><span class="co">#&gt;   vot_hom_25_29            calibration            total=     81481  mean=    15.9  [0.4, 45.4]</span></span>
<span><span class="co">#&gt;   vot_hom_30_39            calibration            total=    172752  mean=    33.8  [0.8, 93.4]</span></span>
<span><span class="co">#&gt;   vot_hom_40_49            calibration            total=    170766  mean=    33.4  [0.8, 91.8]</span></span>
<span><span class="co">#&gt;   vot_hom_50_59            calibration            total=    138388  mean=    27.1  [0.7, 73.1]</span></span>
<span><span class="co">#&gt;   vot_hom_60_69            calibration            total=    105049  mean=    20.6  [0.5, 53.2]</span></span>
<span><span class="co">#&gt;   vot_mul_18_19            calibration            total=     23556  mean=     4.6  [0.0, 13.9]</span></span>
<span><span class="co">#&gt;   vot_mul_20_24            calibration            total=     77657  mean=    15.2  [0.3, 45.2]</span></span>
<span><span class="co">#&gt;   vot_mul_25_29            calibration            total=     88270  mean=    17.3  [0.4, 52.6]</span></span>
<span><span class="co">#&gt;   vot_mul_30_39            calibration            total=    190378  mean=    37.3  [0.9, 103.5]</span></span>
<span><span class="co">#&gt;   vot_mul_40_49            calibration            total=    194436  mean=    38.1  [0.9, 105.0]</span></span>
<span><span class="co">#&gt;   vot_mul_50_59            calibration            total=    165447  mean=    32.4  [0.8, 88.1]</span></span>
<span><span class="co">#&gt;   vot_mul_60_69            calibration            total=    137434  mean=    26.9  [0.6, 70.0]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object size: 243.8 MB</span></span>
<span><span class="co">#&gt; Neighborhoods: 865</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="automated-health-check-diagnostics">1. Automated Health Check: <code>diagnostics()</code><a class="anchor" aria-label="anchor" href="#automated-health-check-diagnostics"></a>
</h2>
<div class="section level3">
<h3 id="intuition">Intuition<a class="anchor" aria-label="anchor" href="#intuition"></a>
</h3>
<p><code><a href="../reference/diagnostics.html">diagnostics()</a></code> is a single-call “blood test” for your
interpolation result. It runs 8 automated checks and reports
PASS/WARN/FAIL for each. Use it as a first step after every
interpolation to catch problems early.</p>
<p>Only checks whose outcome is <strong>not guaranteed by
construction</strong> are included. Vote conservation, non-negativity,
and column normalization are all enforced by design and therefore
omitted.</p>
</div>
<div class="section level3">
<h3 id="formal-definition">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition"></a>
</h3>
<table style="width:100%;" class="table">
<colgroup>
<col width="19%">
<col width="30%">
<col width="16%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">Check</th>
<th align="left">Statistic</th>
<th align="left">PASS</th>
<th align="left">WARN</th>
<th align="left">FAIL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Convergence</td>
<td align="left">Optimizer exit code</td>
<td align="left">code = 0</td>
<td align="left">code != 0</td>
<td align="left">–</td>
</tr>
<tr class="even">
<td align="left">Alpha distribution</td>
<td align="left">% of tracts with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 15</annotation></semantics></math>
</td>
<td align="left">&lt; 5%</td>
<td align="left">&gt;= 5%</td>
<td align="left">–</td>
</tr>
<tr class="odd">
<td align="left">Residual RMSE</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mrow><mtext mathvariant="normal">mean</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>r</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><annotation encoding="application/x-tex">\sqrt{\text{mean}(r^2)}</annotation></semantics></math></td>
<td align="left">always (informational)</td>
<td align="left">–</td>
<td align="left">–</td>
</tr>
<tr class="even">
<td align="left">Residual bias</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>max</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mover><mi>r</mi><mo accent="true">‾</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow><mi>/</mi><mtext mathvariant="normal">RMSE</mtext></mrow><annotation encoding="application/x-tex">\max |\bar{r}_k| / \text{RMSE}</annotation></semantics></math></td>
<td align="left">ratio &lt; 10%</td>
<td align="left">ratio &gt;= 10%</td>
<td align="left">–</td>
</tr>
<tr class="odd">
<td align="left">Pop-voter gap</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>N</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>s</mi></mrow></msub><mo>−</mo><msub><mi>N</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mi>/</mi><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>s</mi></mrow></msub><mo>,</mo><msub><mi>N</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">|N_{census} - N_{source}| / \max(N_{census}, N_{source})</annotation></semantics></math></td>
<td align="left">&lt; 5%</td>
<td align="left">5–20%</td>
<td align="left">&gt; 20%</td>
</tr>
<tr class="even">
<td align="left">Unreachable pairs</td>
<td align="left">% of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
near max</td>
<td align="left">&lt; 1%</td>
<td align="left">1–10%</td>
<td align="left">&gt; 10%</td>
</tr>
<tr class="odd">
<td align="left">Alpha spatial CV</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">sd</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mtext mathvariant="normal">mean</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{sd}(\alpha) / \text{mean}(\alpha)</annotation></semantics></math></td>
<td align="left">CV &gt;= 0.1</td>
<td align="left">CV &lt; 0.1</td>
<td align="left">–</td>
</tr>
<tr class="even">
<td align="left">Implied turnout</td>
<td align="left">% of tracts with rate &gt; 110%</td>
<td align="left">&lt; 5%</td>
<td align="left">&gt;= 5%</td>
<td align="left">–</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="applied-example">Applied example<a class="anchor" aria-label="anchor" href="#applied-example"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; interpElections diagnostics</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt;  [PASS] Convergence: optimizer converged (code 0)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha distribution: median=3.84, IQR=[3.28, 4.91], 0% &gt; 15</span></span>
<span><span class="co">#&gt;  [PASS] Residual RMSE: 11.8866 (informational)</span></span>
<span><span class="co">#&gt;  [WARN] Residual bias: max |colMeans(resid)| = 8.6344 (72.6% of RMSE)</span></span>
<span><span class="co">#&gt;  [WARN] Population-voter gap: census=96829, source=78389, gap=19.0%</span></span>
<span><span class="co">#&gt;  [PASS] Unreachable pairs: 0.5% of pairs near max travel time (&gt;= 950000 min)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha spatial variation: CV of median-alpha = 0.385</span></span>
<span><span class="co">#&gt;  [PASS] Implied turnout: 0.7% of tracts with implied turnout &gt; 110%</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; 6 PASS, 2 WARN</span></span></code></pre>
<p>For a larger city:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">result_bh</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; interpElections diagnostics</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt;  [PASS] Convergence: optimizer converged (code 0)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha distribution: median=1.32, IQR=[1.23, 1.41], 0% &gt; 15</span></span>
<span><span class="co">#&gt;  [PASS] Residual RMSE: 7.1102 (informational)</span></span>
<span><span class="co">#&gt;  [WARN] Residual bias: max |colMeans(resid)| = 1.8894 (26.6% of RMSE)</span></span>
<span><span class="co">#&gt;  [PASS] Population-voter gap: census=1650864, source=1640251, gap=0.6%</span></span>
<span><span class="co">#&gt;  [FAIL] Unreachable pairs: 12.1% of pairs near max travel time (&gt;= 950000 min)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha spatial variation: CV of median-alpha = 0.578</span></span>
<span><span class="co">#&gt;  [PASS] Implied turnout: 2.2% of tracts with implied turnout &gt; 110%</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; 6 PASS, 1 WARN, 1 FAIL</span></span></code></pre>
<p>You can also access check values programmatically:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">result_vga</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">checks</span><span class="op">$</span><span class="va">convergence</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">checks</span><span class="op">$</span><span class="va">residual_rmse</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">checks</span><span class="op">$</span><span class="va">pop_voter_gap</span><span class="op">$</span><span class="va">value</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<ul>
<li>
<strong>Convergence WARN</strong>: The optimizer didn’t converge
within the epoch limit. Try increasing <code>max_epochs</code> in
<code><a href="../reference/optim_control.html">optim_control()</a></code>, or check if the learning rate is too
high.</li>
<li>
<strong>Alpha distribution WARN</strong>: Many tracts have very high
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">&gt; 15</annotation></semantics></math>),
meaning they effectively use only the nearest station. This can happen
when travel time data has poor coverage.</li>
<li>
<strong>Pop-voter gap WARN/FAIL</strong>: The total census
population differs substantially from the total registered voters. This
is expected to some degree (not everyone registers, some register
outside their residence), but gaps &gt; 20% suggest data quality
issues.</li>
<li>
<strong>Unreachable pairs FAIL</strong>: Many tract-station pairs
have travel times at the ceiling. This means the routing engine couldn’t
find paths — check OSM road network coverage.</li>
<li>
<strong>Alpha spatial CV WARN</strong>: Alpha values have very low
variation across tracts (CV &lt; 0.1). The optimizer may not be adapting
to local conditions, possibly because of insufficient data or poor
convergence.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="optimization-convergence-plot_convergence">2. Optimization Convergence: <code>plot_convergence()</code><a class="anchor" aria-label="anchor" href="#optimization-convergence-plot_convergence"></a>
</h2>
<div class="section level3">
<h3 id="intuition-1">Intuition<a class="anchor" aria-label="anchor" href="#intuition-1"></a>
</h3>
<p>The optimizer minimizes Poisson deviance by adjusting the decay
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
<code><a href="../reference/plot_convergence.html">plot_convergence()</a></code> shows the optimization trajectory: is
the loss decreasing smoothly? Is the gradient approaching zero? What
learning rate schedule was used?</p>
</div>
<div class="section level3">
<h3 id="formal-definition-1">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-1"></a>
</h3>
<ul>
<li>
<strong>Loss</strong>: Poisson deviance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>2</mn><msub><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>k</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>log</mo><mfrac><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub></mfrac><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">= 2 \sum_{i,k} \left[ y_{ik} \log\frac{y_{ik}}{\hat{y}_{ik}} - (y_{ik} - \hat{y}_{ik}) \right]</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
= observed census population and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>y</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math>
= fitted population from the model.</li>
<li>
<strong>Gradient norm</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">‖</mo><msub><mi>∇</mi><mi>α</mi></msub><mi>L</mi><mo stretchy="true" form="postfix">‖</mo></mrow><mn>2</mn></msub><annotation encoding="application/x-tex">\lVert \nabla_\alpha L \rVert_2</annotation></semantics></math>,
the Euclidean norm of the gradient of the loss with respect to all alpha
parameters.</li>
<li>
<strong>Learning rate</strong>: Step size in gradient descent. May
decay over epochs via cosine annealing or other schedules.</li>
</ul>
</div>
<div class="section level3">
<h3 id="applied-examples">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples"></a>
</h3>
<p>All three panels (loss, gradient, learning rate):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-vga-all.png" alt="" width="100%"></p>
<p>Comparing with a GPU-optimized large city:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_bh</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-bh-all.png" alt="" width="100%"></p>
<p>Show only the loss panel:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_vga</span>, which <span class="op">=</span> <span class="st">"loss"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-vga-loss.png" alt="" width="100%"></p>
<p>Log scale for loss and gradient (useful when the values span orders
of magnitude):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_vga</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loss"</span>, <span class="st">"gradient"</span><span class="op">)</span>, log_y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-vga-log.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interpretation-1">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-1"></a>
</h3>
<ul>
<li>
<strong>Good convergence</strong>: Smooth, monotonically decreasing
loss that plateaus. Gradient norm approaches zero. The vertical dashed
red line marks the best epoch.</li>
<li>
<strong>Poor convergence</strong>: Oscillating loss, gradient that
doesn’t shrink, or loss that hasn’t plateaued by the last epoch.
Consider increasing <code>max_epochs</code> or adjusting the learning
rate.</li>
<li>
<strong>Learning rate</strong>: If using cosine annealing, you’ll
see a decaying pattern. Flat LR = constant step size throughout.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="alpha-decay-parameters-plot_alpha">3. Alpha Decay Parameters: <code>plot_alpha()</code><a class="anchor" aria-label="anchor" href="#alpha-decay-parameters-plot_alpha"></a>
</h2>
<div class="section level3">
<h3 id="intuition-2">Intuition<a class="anchor" aria-label="anchor" href="#intuition-2"></a>
</h3>
<p>The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math>
controls how sharply the weight of station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
decays with travel time for tract
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
Higher
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
means voters are more localized (sharp decay — only nearby stations
matter). Lower
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
means voters come from a broader area (gradual decay — distant stations
still contribute).</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is a <strong>matrix</strong> with one row per tract and one column per
demographic bracket (14 brackets = 7 age groups
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>
2 genders). Different brackets may have different decay patterns (e.g.,
young voters may travel farther to vote).</p>
</div>
<div class="section level3">
<h3 id="formal-definition-2">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-2"></a>
</h3>
<p>The weight before column normalization is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><msub><mi>α</mi><mi>i</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">K_{ij} = (t_{ij} + 1)^{-\alpha_i}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel time (in minutes) from tract
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
to station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.
The final weight is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{ij} = K_{ij} / \sum_i K_{ij}</annotation></semantics></math>
(column-normalized so each station’s voters are fully distributed).</p>
</div>
<div class="section level3">
<h3 id="applied-examples-map-mode">Applied examples: Map mode<a class="anchor" aria-label="anchor" href="#applied-examples-map-mode"></a>
</h3>
<p>The map mode collapses the 14-bracket alpha matrix to a single scalar
per tract using <code>summary_fn</code>. This is the key visualization
choice — different summaries answer different questions.</p>
<p><strong>Median</strong> (default) — the “typical” alpha across all
brackets:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-median.png" alt="" width="100%"></p>
<p><strong>Mean</strong> — sensitive to extreme values in any
bracket:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-mean.png" alt="" width="100%"></p>
<p><strong>Population-weighted</strong> — weights each bracket by the
tract’s population in that bracket:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"pop_weighted"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-popwt.png" alt="" width="100%"></p>
<p><strong>Range</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>max</mo><mo>−</mo><mo>min</mo></mrow><annotation encoding="application/x-tex">\max - \min</annotation></semantics></math>)
— measures how much
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
varies across brackets within each tract:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"range"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-range.png" alt="" width="100%"></p>
<p><strong>Single bracket</strong> (e.g., bracket 1 = Male 18–20):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-bracket1.png" alt="" width="100%"></p>
<p><strong>Large city comparison</strong> (Belo Horizonte):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-bh-map-median.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-histogram-mode">Applied examples: Histogram mode<a class="anchor" aria-label="anchor" href="#applied-examples-histogram-mode"></a>
</h3>
<p>Density plots faceted by bracket. With 14 brackets arranged in a 2$$7
grid, you can compare age groups and genders at a glance.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-nit-hist-all.png" alt="" width="100%"></p>
<p>Select specific brackets:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, brackets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-nit-hist-sel.png" alt="" width="100%"></p>
<p>Small city (narrower distributions due to fewer tracts):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_igr</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-igr-hist-all.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-bracket-boxplot">Applied examples: Bracket boxplot<a class="anchor" aria-label="anchor" href="#applied-examples-bracket-boxplot"></a>
</h3>
<p>The most compact view — one boxplot per bracket on a single
panel:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-bh-bracket.png" alt="" width="100%"></p>
<p>Male brackets only:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"bracket"</span>, brackets <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-nit-bracket-male.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interpretation-2">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-2"></a>
</h3>
<ul>
<li>
<strong>Urban core vs periphery</strong>: Central tracts with many
nearby stations tend to have higher
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
(sharper decay). Peripheral tracts with few nearby stations have lower
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
(they must draw from distant stations).</li>
<li>
<strong>Age patterns</strong>: Younger brackets may show different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
distributions than older ones, reflecting different mobility
patterns.</li>
<li>
<strong>Range map</strong>: High range = the optimizer found very
different decay rates for different brackets in that tract. This often
occurs at the urban-rural boundary.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 15</annotation></semantics></math></strong>:
Effectively nearest-station assignment. The decay is so steep that only
the closest station has non-negligible weight.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="calibration-residuals-plot_residuals-residual_summary">4. Calibration Residuals: <code>plot_residuals()</code> +
<code>residual_summary()</code><a class="anchor" aria-label="anchor" href="#calibration-residuals-plot_residuals-residual_summary"></a>
</h2>
<div class="section level3">
<h3 id="intuition-3">Intuition<a class="anchor" aria-label="anchor" href="#intuition-3"></a>
</h3>
<p>The model calibrates against known census demographics (population by
age<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>gender
bracket). Residuals measure how well the model reproduces these known
quantities. Small residuals mean the model’s spatial allocation of
voters closely matches census demographics — giving confidence that the
interpolated (unknown) electoral variables are also spatially
accurate.</p>
</div>
<div class="section level3">
<h3 id="formal-definition-3">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-3"></a>
</h3>
<p>Three types of residuals are available:</p>
<ul>
<li>
<strong>Raw</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">r_{ik} = \hat{y}_{ik} - y_{ik}</annotation></semantics></math>
(fitted minus observed). Scale depends on population size.</li>
<li>
<strong>Pearson</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>r</mi><mrow><mi>i</mi><mi>k</mi></mrow><mi>P</mi></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msqrt><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub></msqrt></mrow><annotation encoding="application/x-tex">r_{ik}^P = (\hat{y}_{ik} - y_{ik}) / \sqrt{\hat{y}_{ik}}</annotation></semantics></math>.
Standardized under the Poisson assumption — comparable across tracts of
different sizes.</li>
<li>
<strong>Deviance</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>r</mi><mrow><mi>i</mi><mi>k</mi></mrow><mi>D</mi></msubsup><mo>=</mo><mtext mathvariant="normal">sign</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><msqrt><mrow><mn>2</mn><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>log</mo><mfrac><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub></mfrac><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">r_{ik}^D = \text{sign}(\hat{y}_{ik} - y_{ik}) \cdot \sqrt{2\left[y_{ik}\log\frac{y_{ik}}{\hat{y}_{ik}} - (y_{ik} - \hat{y}_{ik})\right]}</annotation></semantics></math>.
Individual Poisson deviance contributions.</li>
</ul>
</div>
<div class="section level3">
<h3 id="applied-examples-map-mode-1">Applied examples: Map mode<a class="anchor" aria-label="anchor" href="#applied-examples-map-mode-1"></a>
</h3>
<p>For maps, <code>summary_fn</code> collapses across the 14 brackets to
a single value per tract.</p>
<p><strong>RMSE</strong> (default) — magnitude of misfit:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-rmse.png" alt="" width="100%"></p>
<p><strong>Mean</strong> — directional bias (positive = over-prediction,
negative = under-prediction):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-mean.png" alt="" width="100%"></p>
<p><strong>Pearson residuals</strong> (standardized):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, residual_type <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>               summary_fn <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-pearson.png" alt="" width="100%"></p>
<p><strong>Large city</strong> (Belo Horizonte):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-bh-map-rmse.png" alt="" width="100%"></p>
<p><strong>Single bracket</strong>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-bracket1.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-histogram-mode-1">Applied examples: Histogram mode<a class="anchor" aria-label="anchor" href="#applied-examples-histogram-mode-1"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-nit-hist-raw.png" alt="" width="100%"></p>
<p>Compare with Pearson residuals:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, residual_type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-nit-hist-pearson.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-bracket-boxplot-1">Applied examples: Bracket boxplot<a class="anchor" aria-label="anchor" href="#applied-examples-bracket-boxplot-1"></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-bh-bracket-raw.png" alt="" width="100%"></p>
<p>Deviance scale:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"bracket"</span>, residual_type <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-bh-bracket-dev.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-scatter-fitted-vs-observed">Applied examples: Scatter (fitted vs observed)<a class="anchor" aria-label="anchor" href="#applied-examples-scatter-fitted-vs-observed"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_igr</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-igr-scatter.png" alt="" width="100%"></p>
<p>Selected brackets:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"scatter"</span>, brackets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-scatter-sel.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="tabular-summary-residual_summary">Tabular summary: <code>residual_summary()</code><a class="anchor" aria-label="anchor" href="#tabular-summary-residual_summary"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/residual_summary.html">residual_summary</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $per_bracket</span></span>
<span><span class="co">#&gt;         bracket      mean      rmse  max_abs pct_gt_2sd</span></span>
<span><span class="co">#&gt; 1    Male 18-19 -2.827957  4.209189 20.46048  11.827957</span></span>
<span><span class="co">#&gt; 2    Male 20-24 -4.939068  8.287797 30.71516  11.111111</span></span>
<span><span class="co">#&gt; 3    Male 25-29 -3.688171  8.342815 50.75840   5.017921</span></span>
<span><span class="co">#&gt; 4    Male 30-39 -8.189962 17.909438 83.99157   7.885305</span></span>
<span><span class="co">#&gt; 5    Male 40-49 -6.788528 13.438064 52.24830   8.243728</span></span>
<span><span class="co">#&gt; 6    Male 50-59 -3.684587 11.706946 65.13645   5.017921</span></span>
<span><span class="co">#&gt; 7    Male 60-69 -2.093190 11.244240 35.32155   5.017921</span></span>
<span><span class="co">#&gt; 8  Female 18-19 -1.896057  3.410637 15.37841   8.243728</span></span>
<span><span class="co">#&gt; 9  Female 20-24 -4.594981  8.917599 42.27376   6.810036</span></span>
<span><span class="co">#&gt; 10 Female 25-29 -3.767024  9.286171 58.46458   4.659498</span></span>
<span><span class="co">#&gt; 11 Female 30-39 -8.634406 19.425422 78.13362   8.243728</span></span>
<span><span class="co">#&gt; 12 Female 40-49 -7.537632 13.969830 49.00763   9.318996</span></span>
<span><span class="co">#&gt; 13 Female 50-59 -4.498207 11.625338 37.09436   7.168459</span></span>
<span><span class="co">#&gt; 14 Female 60-69 -2.953405 13.122651 36.39059   3.225806</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $per_tract</span></span>
<span><span class="co">#&gt;            tract_id          mean      rmse worst_bracket</span></span>
<span><span class="co">#&gt; 1   317070105000001  -4.630109290  7.854223    Male 30-39</span></span>
<span><span class="co">#&gt; 2   317070105000008  -5.886793911  8.031612    Male 40-49</span></span>
<span><span class="co">#&gt; 3   317070105000009  -6.605707241  9.215402  Female 50-59</span></span>
<span><span class="co">#&gt; 4   317070105000010  -4.236636139  9.349483  Female 60-69</span></span>
<span><span class="co">#&gt; 5   317070105000013  -6.013139227  7.726308    Male 50-59</span></span>
<span><span class="co">#&gt; 6   317070105000014  -4.856914096  6.287569  Female 60-69</span></span>
<span><span class="co">#&gt; 7   317070105000015  -3.319747847  5.310147  Female 20-24</span></span>
<span><span class="co">#&gt; 8   317070105000016  -3.774009904  6.453683    Male 40-49</span></span>
<span><span class="co">#&gt; 9   317070105000017  -8.241622634 10.827912  Female 30-39</span></span>
<span><span class="co">#&gt; 10  317070105000019  -3.485833675  5.424265    Male 60-69</span></span>
<span><span class="co">#&gt; 11  317070105000021  -5.220301588  7.021112    Male 40-49</span></span>
<span><span class="co">#&gt; 12  317070105000022  -3.004615132  5.403922  Female 25-29</span></span>
<span><span class="co">#&gt; 13  317070105000023  -4.852032672  7.434122    Male 30-39</span></span>
<span><span class="co">#&gt; 14  317070105000024  -4.793924563  7.593723    Male 25-29</span></span>
<span><span class="co">#&gt; 15  317070105000025  -3.669051013  8.001687  Female 60-69</span></span>
<span><span class="co">#&gt; 16  317070105000026  -2.649422078  5.080389  Female 30-39</span></span>
<span><span class="co">#&gt; 17  317070105000028  -8.070366895 14.782164  Female 30-39</span></span>
<span><span class="co">#&gt; 18  317070105000029  -5.565291775 10.422337  Female 40-49</span></span>
<span><span class="co">#&gt; 19  317070105000031  -4.016547848  8.530849  Female 60-69</span></span>
<span><span class="co">#&gt; 20  317070105000032  -5.438884433 12.164612    Male 50-59</span></span>
<span><span class="co">#&gt; 21  317070105000033  -3.930110659  5.308515    Male 25-29</span></span>
<span><span class="co">#&gt; 22  317070105000035  -4.356855694  6.736049  Female 30-39</span></span>
<span><span class="co">#&gt; 23  317070105000036  -5.416730985  9.966833    Male 30-39</span></span>
<span><span class="co">#&gt; 24  317070105000037  -3.814261695  5.809060  Female 60-69</span></span>
<span><span class="co">#&gt; 25  317070105000039  -5.340265667  8.765161    Male 40-49</span></span>
<span><span class="co">#&gt; 26  317070105000040  -5.714328208 22.982966    Male 50-59</span></span>
<span><span class="co">#&gt; 27  317070105000041  -4.516477218  9.037659  Female 50-59</span></span>
<span><span class="co">#&gt; 28  317070105000043  -3.035520014  5.251145    Male 40-49</span></span>
<span><span class="co">#&gt; 29  317070105000044  -5.065246215 14.888315    Male 40-49</span></span>
<span><span class="co">#&gt; 30  317070105000045  -5.714497381  9.388884  Female 40-49</span></span>
<span><span class="co">#&gt; 31  317070105000047  -7.080920378 12.265487  Female 50-59</span></span>
<span><span class="co">#&gt; 32  317070105000048  -4.262370418  8.282950    Male 30-39</span></span>
<span><span class="co">#&gt; 33  317070105000049  -3.988253366  6.319518  Female 30-39</span></span>
<span><span class="co">#&gt; 34  317070105000050  -5.242626324  9.581782  Female 60-69</span></span>
<span><span class="co">#&gt; 35  317070105000051  -3.266283543  4.756737  Female 40-49</span></span>
<span><span class="co">#&gt; 36  317070105000052  -5.135468378  8.094767  Female 30-39</span></span>
<span><span class="co">#&gt; 37  317070105000054  -4.503018900 12.261451  Female 30-39</span></span>
<span><span class="co">#&gt; 38  317070105000055  -4.449178769 16.379824  Female 50-59</span></span>
<span><span class="co">#&gt; 39  317070105000056  -2.748768786  6.040385  Female 60-69</span></span>
<span><span class="co">#&gt; 40  317070105000057  -3.667382542  8.853467  Female 60-69</span></span>
<span><span class="co">#&gt; 41  317070105000059  -5.719035727 10.739006    Male 40-49</span></span>
<span><span class="co">#&gt; 42  317070105000060  -5.863244692  7.238815    Male 50-59</span></span>
<span><span class="co">#&gt; 43  317070105000061  -4.702417169  7.354734  Female 40-49</span></span>
<span><span class="co">#&gt; 44  317070105000063  -4.447474290 12.301240  Female 60-69</span></span>
<span><span class="co">#&gt; 45  317070105000065  -6.688117725 12.894434    Male 60-69</span></span>
<span><span class="co">#&gt; 46  317070105000066  -5.815605557 12.195837    Male 60-69</span></span>
<span><span class="co">#&gt; 47  317070105000067  -3.829085686  9.608111  Female 50-59</span></span>
<span><span class="co">#&gt; 48  317070105000069  -7.304365784 10.085045    Male 30-39</span></span>
<span><span class="co">#&gt; 49  317070105000070  -5.294118505  8.530518  Female 50-59</span></span>
<span><span class="co">#&gt; 50  317070105000071  -5.168341863  7.795125  Female 60-69</span></span>
<span><span class="co">#&gt; 51  317070105000074  -4.774002961  7.707495  Female 60-69</span></span>
<span><span class="co">#&gt; 52  317070105000077  -4.070944532  8.596225  Female 60-69</span></span>
<span><span class="co">#&gt; 53  317070105000078  -5.443628548  8.314696  Female 60-69</span></span>
<span><span class="co">#&gt; 54  317070105000079  -5.588898034  8.396789  Female 40-49</span></span>
<span><span class="co">#&gt; 55  317070105000082  -5.835901479  9.833477    Male 60-69</span></span>
<span><span class="co">#&gt; 56  317070105000083  -4.819548566 10.393838  Female 50-59</span></span>
<span><span class="co">#&gt; 57  317070105000086  -5.968035069 10.224676    Male 40-49</span></span>
<span><span class="co">#&gt; 58  317070105000087  -5.485904904  8.760943  Female 50-59</span></span>
<span><span class="co">#&gt; 59  317070105000089  -7.687342312 12.214781  Female 40-49</span></span>
<span><span class="co">#&gt; 60  317070105000091  -6.057448563 10.690688  Female 60-69</span></span>
<span><span class="co">#&gt; 61  317070105000094  -7.125899354  9.276823  Female 60-69</span></span>
<span><span class="co">#&gt; 62  317070105000095  -7.256897776  9.933460    Male 40-49</span></span>
<span><span class="co">#&gt; 63  317070105000096  -7.064500230 10.916087  Female 40-49</span></span>
<span><span class="co">#&gt; 64  317070105000100 -10.200379624 16.880535  Female 40-49</span></span>
<span><span class="co">#&gt; 65  317070105000101  -4.860209009 10.809288    Male 50-59</span></span>
<span><span class="co">#&gt; 66  317070105000102  -9.704647033 16.497653  Female 50-59</span></span>
<span><span class="co">#&gt; 67  317070105000103  -3.529739917  7.245040    Male 30-39</span></span>
<span><span class="co">#&gt; 68  317070105000104  -5.207516048 10.435571  Female 40-49</span></span>
<span><span class="co">#&gt; 69  317070105000105  -6.832841284  9.900862  Female 60-69</span></span>
<span><span class="co">#&gt; 70  317070105000106  -4.882422787  7.992882  Female 60-69</span></span>
<span><span class="co">#&gt; 71  317070105000107  -5.181972658 10.575480  Female 60-69</span></span>
<span><span class="co">#&gt; 72  317070105000108  -4.647805428 12.785139  Female 60-69</span></span>
<span><span class="co">#&gt; 73  317070105000112 -10.894226944 19.939288  Female 40-49</span></span>
<span><span class="co">#&gt; 74  317070105000114  -7.626299688 13.621924  Female 50-59</span></span>
<span><span class="co">#&gt; 75  317070105000115  -7.844729447 16.809352    Male 50-59</span></span>
<span><span class="co">#&gt; 76  317070105000116  -5.158202234 11.493129    Male 50-59</span></span>
<span><span class="co">#&gt; 77  317070105000117  -6.074862316  9.454171  Female 40-49</span></span>
<span><span class="co">#&gt; 78  317070105000120  -5.026261835 15.485737    Male 40-49</span></span>
<span><span class="co">#&gt; 79  317070105000121  -1.498502269  4.891413    Male 50-59</span></span>
<span><span class="co">#&gt; 80  317070105000124  -9.559874370 12.913171  Female 30-39</span></span>
<span><span class="co">#&gt; 81  317070105000125  -8.048842436 10.295527    Male 50-59</span></span>
<span><span class="co">#&gt; 82  317070105000126  -4.405281841  7.727971  Female 60-69</span></span>
<span><span class="co">#&gt; 83  317070105000127  -4.913965288  7.938807  Female 50-59</span></span>
<span><span class="co">#&gt; 84  317070105000128  -6.700204886 11.855738    Male 60-69</span></span>
<span><span class="co">#&gt; 85  317070105000129  -6.085356389  9.848476  Female 50-59</span></span>
<span><span class="co">#&gt; 86  317070105000130  -5.807968497  7.707512  Female 50-59</span></span>
<span><span class="co">#&gt; 87  317070105000131  -6.958212509 13.738961  Female 60-69</span></span>
<span><span class="co">#&gt; 88  317070105000133  -6.229899023 12.637184  Female 60-69</span></span>
<span><span class="co">#&gt; 89  317070105000134  -3.186294392  6.723167  Female 50-59</span></span>
<span><span class="co">#&gt; 90  317070105000135  -5.048888016 11.295701  Female 60-69</span></span>
<span><span class="co">#&gt; 91  317070105000136  -1.910540233  5.724796  Female 30-39</span></span>
<span><span class="co">#&gt; 92  317070105000138  -1.840615941  2.985009  Female 60-69</span></span>
<span><span class="co">#&gt; 93  317070105000139  -2.926372703  7.342291    Male 50-59</span></span>
<span><span class="co">#&gt; 94  317070105000140  -1.723690277  4.687788    Male 50-59</span></span>
<span><span class="co">#&gt; 95  317070105000141  -1.988978227  4.763140    Male 50-59</span></span>
<span><span class="co">#&gt; 96  317070105000142  -1.931905284  4.152455    Male 40-49</span></span>
<span><span class="co">#&gt; 97  317070105000143  -3.275506461  4.608420    Male 50-59</span></span>
<span><span class="co">#&gt; 98  317070105000144  -4.385480945  6.638927    Male 40-49</span></span>
<span><span class="co">#&gt; 99  317070105000147  -4.461848823 11.579625    Male 40-49</span></span>
<span><span class="co">#&gt; 100 317070105000148  -7.150472634 10.442835  Female 40-49</span></span>
<span><span class="co">#&gt; 101 317070105000149  -4.186255476  8.908961  Female 50-59</span></span>
<span><span class="co">#&gt; 102 317070105000150  -0.108535425  2.279904  Female 60-69</span></span>
<span><span class="co">#&gt; 103 317070105000151  -9.699318433 14.925035    Male 50-59</span></span>
<span><span class="co">#&gt; 104 317070105000152  -4.191106742 12.523168  Female 40-49</span></span>
<span><span class="co">#&gt; 105 317070105000153  -5.288966305  7.015434  Female 60-69</span></span>
<span><span class="co">#&gt; 106 317070105000154  -6.149877547  7.666987  Female 50-59</span></span>
<span><span class="co">#&gt; 107 317070105000155  -4.545943460  6.086591  Female 50-59</span></span>
<span><span class="co">#&gt; 108 317070105000156  -3.493053554  6.633612  Female 60-69</span></span>
<span><span class="co">#&gt; 109 317070105000157  -7.592280903 15.158657    Male 50-59</span></span>
<span><span class="co">#&gt; 110 317070105000158  -4.650061477  5.980179    Male 60-69</span></span>
<span><span class="co">#&gt; 111 317070105000159  -6.731951128 15.840909  Female 40-49</span></span>
<span><span class="co">#&gt; 112 317070105000160  -5.998235475 11.393179  Female 50-59</span></span>
<span><span class="co">#&gt; 113 317070105000161  -8.594718441 16.616369  Female 50-59</span></span>
<span><span class="co">#&gt; 114 317070105000162  -6.579159844 16.356048    Male 50-59</span></span>
<span><span class="co">#&gt; 115 317070105000164  -2.354986192  8.684508  Female 30-39</span></span>
<span><span class="co">#&gt; 116 317070105000165   0.218517272  1.103221  Female 25-29</span></span>
<span><span class="co">#&gt; 117 317070105000166  -6.989158889  9.358852  Female 50-59</span></span>
<span><span class="co">#&gt; 118 317070105000168  -7.765005624  9.898700  Female 40-49</span></span>
<span><span class="co">#&gt; 119 317070105000169  -6.361366435  8.610138  Female 60-69</span></span>
<span><span class="co">#&gt; 120 317070105000171  -5.815823803 14.518528  Female 40-49</span></span>
<span><span class="co">#&gt; 121 317070105000172  -5.462784849 16.081400    Male 40-49</span></span>
<span><span class="co">#&gt; 122 317070105000174  -4.850434959 16.372646    Male 30-39</span></span>
<span><span class="co">#&gt; 123 317070105000175  -2.787648323 10.164460  Female 30-39</span></span>
<span><span class="co">#&gt; 124 317070105000176  -1.646013773  3.789748    Male 30-39</span></span>
<span><span class="co">#&gt; 125 317070105000177  15.878238663 21.227877  Female 30-39</span></span>
<span><span class="co">#&gt; 126 317070105000178  -4.666537899 15.232267  Female 30-39</span></span>
<span><span class="co">#&gt; 127 317070105000179  -4.179462036  6.771014  Female 60-69</span></span>
<span><span class="co">#&gt; 128 317070105000180  -3.880096755  7.123963  Female 60-69</span></span>
<span><span class="co">#&gt; 129 317070105000181  -3.158900069  6.700366    Male 50-59</span></span>
<span><span class="co">#&gt; 130 317070105000182  -6.296226443 20.667942  Female 30-39</span></span>
<span><span class="co">#&gt; 131 317070105000183  -9.572683530 21.044592  Female 30-39</span></span>
<span><span class="co">#&gt; 132 317070105000185  -4.489352289  6.116863  Female 50-59</span></span>
<span><span class="co">#&gt; 133 317070105000186  -4.404326626  8.817879  Female 60-69</span></span>
<span><span class="co">#&gt; 134 317070105000188  -7.299105939  9.309987  Female 60-69</span></span>
<span><span class="co">#&gt; 135 317070105000189  -4.615226896  9.798512  Female 60-69</span></span>
<span><span class="co">#&gt; 136 317070105000190  -3.567255147  4.945474  Female 40-49</span></span>
<span><span class="co">#&gt; 137 317070105000191  -2.243721940  5.405970  Female 60-69</span></span>
<span><span class="co">#&gt; 138 317070105000192  -4.062288641  7.806079  Female 30-39</span></span>
<span><span class="co">#&gt; 139 317070105000193  -3.499670704  8.575538    Male 30-39</span></span>
<span><span class="co">#&gt; 140 317070105000194  -6.056262871 11.250656  Female 60-69</span></span>
<span><span class="co">#&gt; 141 317070105000196  -7.598395228 24.242550  Female 30-39</span></span>
<span><span class="co">#&gt; 142 317070105000197   0.076637984  1.576852    Male 30-39</span></span>
<span><span class="co">#&gt; 143 317070105000198  -0.540836294  1.614873    Male 60-69</span></span>
<span><span class="co">#&gt; 144 317070105000199  -5.842992046  9.630518  Female 40-49</span></span>
<span><span class="co">#&gt; 145 317070105000200  -7.529359166 14.266759    Male 40-49</span></span>
<span><span class="co">#&gt; 146 317070105000201  -7.293401296 16.628752  Female 50-59</span></span>
<span><span class="co">#&gt; 147 317070105000205  -7.485828616 20.438674  Female 40-49</span></span>
<span><span class="co">#&gt; 148 317070105000206  -7.565716842 19.029706  Female 40-49</span></span>
<span><span class="co">#&gt; 149 317070105000207  -2.248787416  6.928961    Male 20-24</span></span>
<span><span class="co">#&gt; 150 317070105000208  -5.875739684 15.690290  Female 30-39</span></span>
<span><span class="co">#&gt; 151 317070105000209  -7.346604849 18.928375  Female 30-39</span></span>
<span><span class="co">#&gt; 152 317070105000210  -5.307557284 13.209943  Female 40-49</span></span>
<span><span class="co">#&gt; 153 317070105000211  -3.846382316 11.588691  Female 20-24</span></span>
<span><span class="co">#&gt; 154 317070105000212  -4.739416325 11.852023  Female 40-49</span></span>
<span><span class="co">#&gt; 155 317070105000213  -5.294724446 13.928285  Female 30-39</span></span>
<span><span class="co">#&gt; 156 317070105000214  -9.096545340 27.247339  Female 30-39</span></span>
<span><span class="co">#&gt; 157 317070105000216  -6.772650635 21.844016    Male 30-39</span></span>
<span><span class="co">#&gt; 158 317070105000217  -3.057020323 11.937814  Female 30-39</span></span>
<span><span class="co">#&gt; 159 317070105000219  -9.326667169 31.210258    Male 30-39</span></span>
<span><span class="co">#&gt; 160 317070105000220  -2.311173032  6.620009  Female 30-39</span></span>
<span><span class="co">#&gt; 161 317070105000221  -3.553621233  6.754268  Female 60-69</span></span>
<span><span class="co">#&gt; 162 317070105000222  -2.201388172  4.478535    Male 60-69</span></span>
<span><span class="co">#&gt; 163 317070105000223  -1.617638366  4.516715  Female 60-69</span></span>
<span><span class="co">#&gt; 164 317070105000224  -2.668126737  7.752327  Female 25-29</span></span>
<span><span class="co">#&gt; 165 317070105000225  -2.155761835  5.599975    Male 60-69</span></span>
<span><span class="co">#&gt; 166 317070105000226  -2.109777381  5.128595    Male 25-29</span></span>
<span><span class="co">#&gt; 167 317070105000227  -4.081941391  6.567115    Male 30-39</span></span>
<span><span class="co">#&gt; 168 317070105000228  -3.007399640  5.106716    Male 40-49</span></span>
<span><span class="co">#&gt; 169 317070105000229  -3.809625258  6.825246  Female 60-69</span></span>
<span><span class="co">#&gt; 170 317070105000230  -3.499551860  5.279647  Female 60-69</span></span>
<span><span class="co">#&gt; 171 317070105000231  -3.969128094  5.876176    Male 30-39</span></span>
<span><span class="co">#&gt; 172 317070105000232  -2.950180828  4.329330    Male 60-69</span></span>
<span><span class="co">#&gt; 173 317070105000233  -2.692962530  4.714858    Male 30-39</span></span>
<span><span class="co">#&gt; 174 317070105000234  -2.110104487  5.469849  Female 40-49</span></span>
<span><span class="co">#&gt; 175 317070105000235  -4.042528855  7.564898  Female 30-39</span></span>
<span><span class="co">#&gt; 176 317070105000236  -2.365566109  4.671211  Female 20-24</span></span>
<span><span class="co">#&gt; 177 317070105000237  -5.210946368  8.988258  Female 40-49</span></span>
<span><span class="co">#&gt; 178 317070105000238  -3.212206418  7.195733  Female 30-39</span></span>
<span><span class="co">#&gt; 179 317070105000239  -2.669467521  5.063805    Male 50-59</span></span>
<span><span class="co">#&gt; 180 317070105000240  -2.638176546  6.619145  Female 60-69</span></span>
<span><span class="co">#&gt; 181 317070105000241  -3.419243510  9.717658  Female 50-59</span></span>
<span><span class="co">#&gt; 182 317070105000242  -5.649863651  9.207695    Male 30-39</span></span>
<span><span class="co">#&gt; 183 317070105000243  -3.054202636  5.550048    Male 30-39</span></span>
<span><span class="co">#&gt; 184 317070105000244  -3.038228141  6.030304    Male 20-24</span></span>
<span><span class="co">#&gt; 185 317070105000245  -6.295349651  8.254236  Female 40-49</span></span>
<span><span class="co">#&gt; 186 317070105000246  -4.938819175 15.213054  Female 30-39</span></span>
<span><span class="co">#&gt; 187 317070105000247  -4.004123527  5.681665    Male 25-29</span></span>
<span><span class="co">#&gt; 188 317070105000248  -3.768515679  6.205819  Female 60-69</span></span>
<span><span class="co">#&gt; 189 317070105000249  -2.811335932  5.390914  Female 60-69</span></span>
<span><span class="co">#&gt; 190 317070105000250  -2.234091598 10.459655    Male 40-49</span></span>
<span><span class="co">#&gt; 191 317070105000251  -6.021435405 13.986366  Female 30-39</span></span>
<span><span class="co">#&gt; 192 317070105000252  -6.312768634  9.814692  Female 40-49</span></span>
<span><span class="co">#&gt; 193 317070105000253  -5.777188001 12.785393  Female 30-39</span></span>
<span><span class="co">#&gt; 194 317070105000254  -4.581057831  7.442210    Male 50-59</span></span>
<span><span class="co">#&gt; 195 317070105000255  -5.338220353  6.965514  Female 50-59</span></span>
<span><span class="co">#&gt; 196 317070105000256  -3.651699641  7.934269    Male 40-49</span></span>
<span><span class="co">#&gt; 197 317070105000257  -4.709354506  6.735817  Female 40-49</span></span>
<span><span class="co">#&gt; 198 317070105000258  -3.689301804  7.827739  Female 40-49</span></span>
<span><span class="co">#&gt; 199 317070105000259  -3.874193811 11.284335  Female 60-69</span></span>
<span><span class="co">#&gt; 200 317070105000260  -2.763944395  7.321266  Female 60-69</span></span>
<span><span class="co">#&gt; 201 317070105000261  -4.672432416 10.546564    Male 60-69</span></span>
<span><span class="co">#&gt; 202 317070105000262  -2.958946109  8.496072    Male 60-69</span></span>
<span><span class="co">#&gt; 203 317070105000263  -5.098413921  7.019186    Male 40-49</span></span>
<span><span class="co">#&gt; 204 317070105000264  -3.522359789  8.903755    Male 60-69</span></span>
<span><span class="co">#&gt; 205 317070105000265  -3.704107530  6.755859    Male 60-69</span></span>
<span><span class="co">#&gt; 206 317070105000266  -3.194381220  6.111179  Female 60-69</span></span>
<span><span class="co">#&gt; 207 317070105000267  -2.917722150  5.824603    Male 40-49</span></span>
<span><span class="co">#&gt; 208 317070105000268  -3.496144188  5.447981    Male 30-39</span></span>
<span><span class="co">#&gt; 209 317070105000269  -6.001768265  8.569098  Female 60-69</span></span>
<span><span class="co">#&gt; 210 317070105000270  -2.666196919  8.370687  Female 40-49</span></span>
<span><span class="co">#&gt; 211 317070105000271  -7.047635761 11.042345    Male 40-49</span></span>
<span><span class="co">#&gt; 212 317070105000272  -3.066115920  6.105955    Male 20-24</span></span>
<span><span class="co">#&gt; 213 317070105000273  -7.562849583 11.821085  Female 40-49</span></span>
<span><span class="co">#&gt; 214 317070105000274  -3.655213518  7.211799    Male 40-49</span></span>
<span><span class="co">#&gt; 215 317070105000275  -3.695887724  8.270917  Female 50-59</span></span>
<span><span class="co">#&gt; 216 317070105000276  -1.189600471  2.233211    Male 50-59</span></span>
<span><span class="co">#&gt; 217 317070105000277  -4.953878364 16.373349  Female 20-24</span></span>
<span><span class="co">#&gt; 218 317070105000278  -3.565794681 11.393461  Female 20-24</span></span>
<span><span class="co">#&gt; 219 317070105000279 -11.594007183 23.633192  Female 30-39</span></span>
<span><span class="co">#&gt; 220 317070105000281  -6.654144025  8.642368    Male 30-39</span></span>
<span><span class="co">#&gt; 221 317070105000282  -8.546463443 22.613677    Male 40-49</span></span>
<span><span class="co">#&gt; 222 317070105000283  -4.432225628  8.039981  Female 60-69</span></span>
<span><span class="co">#&gt; 223 317070105000284  -3.707090652  8.825232  Female 60-69</span></span>
<span><span class="co">#&gt; 224 317070105000285  -0.537464001  2.768665    Male 50-59</span></span>
<span><span class="co">#&gt; 225 317070105000286  -1.807909013  3.232673    Male 60-69</span></span>
<span><span class="co">#&gt; 226 317070105000287  -4.381317356  7.938512    Male 50-59</span></span>
<span><span class="co">#&gt; 227 317070105000288  -6.086301134 11.600421    Male 50-59</span></span>
<span><span class="co">#&gt; 228 317070105000289  -4.027160750  4.933711    Male 20-24</span></span>
<span><span class="co">#&gt; 229 317070105000290  -7.748782348 23.511662    Male 30-39</span></span>
<span><span class="co">#&gt; 230 317070105000291  -4.363969995 12.134440  Female 30-39</span></span>
<span><span class="co">#&gt; 231 317070105000292  -7.365142075 30.242930  Female 30-39</span></span>
<span><span class="co">#&gt; 232 317070105000293  -6.905727839 25.152891    Male 30-39</span></span>
<span><span class="co">#&gt; 233 317070105000294  -3.547164443 13.508307  Female 40-49</span></span>
<span><span class="co">#&gt; 234 317070105000295  -6.964366262 16.209073  Female 30-39</span></span>
<span><span class="co">#&gt; 235 317070105000296  -4.223952680 10.398351    Male 60-69</span></span>
<span><span class="co">#&gt; 236 317070105000297  -4.222351460  6.777063    Male 50-59</span></span>
<span><span class="co">#&gt; 237 317070105000298  -6.331106512 13.147982  Female 30-39</span></span>
<span><span class="co">#&gt; 238 317070105000299  -4.475451063 12.343387  Female 30-39</span></span>
<span><span class="co">#&gt; 239 317070105000300  -8.980553170 17.210600    Male 30-39</span></span>
<span><span class="co">#&gt; 240 317070105000301  -7.290172617 19.088791  Female 30-39</span></span>
<span><span class="co">#&gt; 241 317070105000302  -9.407134064 31.048275  Female 30-39</span></span>
<span><span class="co">#&gt; 242 317070105000303 -10.080143649 30.117859    Male 30-39</span></span>
<span><span class="co">#&gt; 243 317070105000304  -5.209253313 21.294205  Female 30-39</span></span>
<span><span class="co">#&gt; 244 317070105000305  -3.690891471 11.889800  Female 30-39</span></span>
<span><span class="co">#&gt; 245 317070105000307  -7.492488540 28.964634  Female 30-39</span></span>
<span><span class="co">#&gt; 246 317070105000308  -7.898635953 23.927083  Female 25-29</span></span>
<span><span class="co">#&gt; 247 317070105000309  -4.080914155 16.058502    Male 30-39</span></span>
<span><span class="co">#&gt; 248 317070105000310  -6.268152384 21.728936  Female 25-29</span></span>
<span><span class="co">#&gt; 249 317070105000311  -1.650459354  3.442875  Female 60-69</span></span>
<span><span class="co">#&gt; 250 317070105000312  -5.679039355  9.623447  Female 40-49</span></span>
<span><span class="co">#&gt; 251 317070105000313  -5.994919323 12.424701  Female 40-49</span></span>
<span><span class="co">#&gt; 252 317070105000314  -2.954517011  4.214217  Female 30-39</span></span>
<span><span class="co">#&gt; 253 317070105000315  -1.422398423  3.448372  Female 50-59</span></span>
<span><span class="co">#&gt; 254 317070105000316  -1.276813124  4.535691    Male 40-49</span></span>
<span><span class="co">#&gt; 255 317070105000317   0.002337349  2.109013    Male 50-59</span></span>
<span><span class="co">#&gt; 256 317070105000318  -0.655811850  3.065793  Female 50-59</span></span>
<span><span class="co">#&gt; 257 317070105000319 -10.471478154 35.318308  Female 25-29</span></span>
<span><span class="co">#&gt; 258 317070105000320  -7.246357928 26.947617    Male 30-39</span></span>
<span><span class="co">#&gt; 259 317070105000321  -2.639987955  4.939696    Male 20-24</span></span>
<span><span class="co">#&gt; 260 317070105000322   0.084269509  1.458974    Male 20-24</span></span>
<span><span class="co">#&gt; 261 317070105000323  -2.416368901  5.339798  Female 20-24</span></span>
<span><span class="co">#&gt; 262 317070105000324  -4.232734258  7.743083  Female 40-49</span></span>
<span><span class="co">#&gt; 263 317070105000325  -1.233191186  6.404219  Female 60-69</span></span>
<span><span class="co">#&gt; 264 317070105000326  -0.762689195  3.540455  Female 50-59</span></span>
<span><span class="co">#&gt; 265 317070105000327  -1.692596331  4.349274  Female 40-49</span></span>
<span><span class="co">#&gt; 266 317070105000328  -1.191501039  3.966117  Female 50-59</span></span>
<span><span class="co">#&gt; 267 317070105000329  -4.797839235  7.410948    Male 20-24</span></span>
<span><span class="co">#&gt; 268 317070105000330  -5.527286711  9.135221    Male 20-24</span></span>
<span><span class="co">#&gt; 269 317070105000331  -2.860272287  4.079684  Female 25-29</span></span>
<span><span class="co">#&gt; 270 317070105000332  -2.623671435  4.561947    Male 50-59</span></span>
<span><span class="co">#&gt; 271 317070105000333  -8.217850852 16.571257    Male 40-49</span></span>
<span><span class="co">#&gt; 272 317070105000334  -4.938284061  8.354723  Female 40-49</span></span>
<span><span class="co">#&gt; 273 317070105000335  -4.687237419 16.711641    Male 30-39</span></span>
<span><span class="co">#&gt; 274 317070105000336  -6.687065772 24.666189  Female 30-39</span></span>
<span><span class="co">#&gt; 275 317070105000337  -0.821977943  2.928114    Male 60-69</span></span>
<span><span class="co">#&gt; 276 317070105000338  -6.065643406 17.062547  Female 25-29</span></span>
<span><span class="co">#&gt; 277 317070105000339  -7.949126845 14.063181  Female 40-49</span></span>
<span><span class="co">#&gt; 278 317070105000340  -3.574588421  5.639981    Male 60-69</span></span>
<span><span class="co">#&gt; 279 317070105000342  -3.127221173  6.200498    Male 50-59</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall</span></span>
<span><span class="co">#&gt; $overall$rmse</span></span>
<span><span class="co">#&gt; [1] 11.88657</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall$mean_bias</span></span>
<span><span class="co">#&gt; [1] -4.720941</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall$total_deviance</span></span>
<span><span class="co">#&gt; [1] 18946.51</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="interpretation-3">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-3"></a>
</h3>
<ul>
<li>
<strong>Raw residuals</strong>: Scale depends on tract population. A
residual of 10 means different things in a tract with 50 people vs
5,000. Use Pearson or deviance for fair comparison.</li>
<li>
<strong>Pearson residuals</strong>: Standardized — values around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>±</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\pm 2</annotation></semantics></math>
are typical. Values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">&gt; 3</annotation></semantics></math>
are outliers under the Poisson assumption.</li>
<li>
<strong>Bracket comparison</strong>: If one bracket consistently has
larger residuals, the model may have trouble with that demographic group
— check whether the census data for that bracket is reliable.</li>
<li>
<strong>Scatter plot</strong>: Points should cluster tightly around
the 45-degree line. Systematic departures indicate bias.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="weight-structure">5. Weight Structure<a class="anchor" aria-label="anchor" href="#weight-structure"></a>
</h2>
<div class="section level3">
<h3 id="intuition-4">Intuition<a class="anchor" aria-label="anchor" href="#intuition-4"></a>
</h3>
<p>The weight matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
(dimensions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \times m</annotation></semantics></math>,
tracts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>
sources) is the heart of the interpolation. It determines how voters
from each station are allocated to each tract. Understanding the
structure of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
reveals:</p>
<ul>
<li>
<strong>Catchment areas</strong>: which stations serve which
tracts</li>
<li>
<strong>Concentration</strong>: does a tract depend on one station
or many?</li>
<li>
<strong>Fragility</strong>: tracts dependent on a single station are
sensitive to that station’s data</li>
</ul>
</div>
<div class="section level3">
<h3 id="formal-definition-4">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-4"></a>
</h3>
<p>Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
is column-normalized
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_i W_{ij} = 1</annotation></semantics></math>),
the row sums are NOT 1. For concentration measures, we row-normalize:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{ij} = W_{ij} / \sum_j W_{ij}</annotation></semantics></math>.</p>
<ul>
<li>
<strong>Shannon entropy</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>=</mo><mi>−</mi><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>ln</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">H_i = -\sum_j p_{ij} \ln p_{ij}</annotation></semantics></math>
</li>
<li>
<strong>Effective number of sources</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(H_i)</annotation></semantics></math>
— the equivalent number of equal-weight stations</li>
<li>
<strong>Herfindahl-Hirschman Index</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">HHI</mtext><mi>i</mi></msub><mo>=</mo><msub><mo>∑</mo><mi>j</mi></msub><msubsup><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\text{HHI}_i = \sum_j p_{ij}^2</annotation></semantics></math>
— ranges from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">1/m</annotation></semantics></math>
(perfect equality) to 1 (monopoly by one station)</li>
</ul>
</div>
<div class="section level3">
<h3 id="tabular-summary-weight_summary">Tabular summary: <code>weight_summary()</code><a class="anchor" aria-label="anchor" href="#tabular-summary-weight_summary"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/weight_summary.html">weight_summary</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                        tract_id dominant_source dominant_weight top3_weight</span></span>
<span><span class="co">#&gt; 317070105000001 317070105000001              26      0.12408125  0.12548549</span></span>
<span><span class="co">#&gt; 317070105000008 317070105000008              26      0.10368346  0.13690291</span></span>
<span><span class="co">#&gt; 317070105000009 317070105000009              14      0.05923250  0.09887616</span></span>
<span><span class="co">#&gt; 317070105000010 317070105000010              14      0.08093105  0.09071796</span></span>
<span><span class="co">#&gt; 317070105000013 317070105000013              14      0.05163750  0.12089023</span></span>
<span><span class="co">#&gt; 317070105000014 317070105000014              14      0.07547978  0.08929105</span></span>
<span><span class="co">#&gt; 317070105000015 317070105000015              10      0.05262199  0.05460941</span></span>
<span><span class="co">#&gt; 317070105000016 317070105000016              10      0.02950864  0.04743211</span></span>
<span><span class="co">#&gt; 317070105000017 317070105000017              10      0.05651994  0.09632084</span></span>
<span><span class="co">#&gt; 317070105000019 317070105000019               9      0.02146672  0.04130694</span></span>
<span><span class="co">#&gt; 317070105000021 317070105000021               9      0.03803299  0.05853421</span></span>
<span><span class="co">#&gt; 317070105000022 317070105000022               9      0.01285708  0.03461886</span></span>
<span><span class="co">#&gt; 317070105000023 317070105000023              19      0.03226264  0.09443522</span></span>
<span><span class="co">#&gt; 317070105000024 317070105000024              19      0.02869849  0.07895928</span></span>
<span><span class="co">#&gt; 317070105000025 317070105000025               9      0.08000839  0.08214851</span></span>
<span><span class="co">#&gt;                   entropy effective_n_sources herfindahl</span></span>
<span><span class="co">#&gt; 317070105000001 0.1519486            1.164100 0.95817586</span></span>
<span><span class="co">#&gt; 317070105000008 1.5321530            4.628130 0.42717988</span></span>
<span><span class="co">#&gt; 317070105000009 2.2700263            9.679655 0.21317381</span></span>
<span><span class="co">#&gt; 317070105000010 1.0630185            2.895097 0.63566633</span></span>
<span><span class="co">#&gt; 317070105000013 2.1052747            8.209358 0.20094016</span></span>
<span><span class="co">#&gt; 317070105000014 1.6159889            5.032863 0.44725614</span></span>
<span><span class="co">#&gt; 317070105000015 0.6429356            1.902056 0.80643610</span></span>
<span><span class="co">#&gt; 317070105000016 2.4444072           11.523717 0.17699440</span></span>
<span><span class="co">#&gt; 317070105000017 2.5797114           13.193330 0.15107200</span></span>
<span><span class="co">#&gt; 317070105000019 2.8825026           17.858910 0.09367962</span></span>
<span><span class="co">#&gt; 317070105000021 2.8524101           17.329497 0.10108259</span></span>
<span><span class="co">#&gt; 317070105000022 2.8477686           17.249250 0.07599913</span></span>
<span><span class="co">#&gt; 317070105000023 2.4385696           11.456641 0.11262129</span></span>
<span><span class="co">#&gt; 317070105000024 2.5576613           12.905600 0.10251343</span></span>
<span><span class="co">#&gt; 317070105000025 0.6114269            1.843059 0.81827336</span></span>
<span><span class="co">#&gt;                 mean_travel_time_weighted</span></span>
<span><span class="co">#&gt; 317070105000001                 0.1543856</span></span>
<span><span class="co">#&gt; 317070105000008                 1.4432354</span></span>
<span><span class="co">#&gt; 317070105000009                 2.4963593</span></span>
<span><span class="co">#&gt; 317070105000010                 0.8130018</span></span>
<span><span class="co">#&gt; 317070105000013                 1.8402696</span></span>
<span><span class="co">#&gt; 317070105000014                 1.3304447</span></span>
<span><span class="co">#&gt; 317070105000015                 0.2910496</span></span>
<span><span class="co">#&gt; 317070105000016                 1.4913282</span></span>
<span><span class="co">#&gt; 317070105000017                 3.6505367</span></span>
<span><span class="co">#&gt; 317070105000019                 3.1447257</span></span>
<span><span class="co">#&gt; 317070105000021                 4.7405601</span></span>
<span><span class="co">#&gt; 317070105000022                 2.7729012</span></span>
<span><span class="co">#&gt; 317070105000023                 2.9506975</span></span>
<span><span class="co">#&gt; 317070105000024                 3.1158297</span></span>
<span><span class="co">#&gt; 317070105000025                 0.5150568</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ... (279 rows total)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="entropy-map-plot_weightstype-entropy">Entropy map: <code>plot_weights(type = "entropy")</code><a class="anchor" aria-label="anchor" href="#entropy-map-plot_weightstype-entropy"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"entropy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-entropy.png" alt="" width="100%"></p>
<p>Large city comparison:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"entropy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-bh-entropy.png" alt="" width="100%"></p>
<p>Interactive version (click tracts to see weight summary stats):</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"entropy"</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="figures/diag-s5-ent-bh-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
</div>
<div class="section level3">
<h3 id="dominant-station-map-plot_weightstype-dominant">Dominant station map:
<code>plot_weights(type = "dominant")</code><a class="anchor" aria-label="anchor" href="#dominant-station-map-plot_weightstype-dominant"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"dominant"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-dominant.png" alt="" width="100%"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"dominant"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-nit-dominant.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="catchment-mode-plot_weightstype-catchment">Catchment mode: <code>plot_weights(type = "catchment")</code><a class="anchor" aria-label="anchor" href="#catchment-mode-plot_weightstype-catchment"></a>
</h3>
<p>Auto-selects the tract with highest effective number of sources:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"catchment"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-catchment-auto.png" alt="" width="100%"></p>
<p>Filtered view with <code>top_k</code> and <code>threshold</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"catchment"</span>, tract <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             top_k <span class="op">=</span> <span class="fl">3</span>, threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-catchment-filt.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="connections-plot_connections">Connections: <code>plot_connections()</code><a class="anchor" aria-label="anchor" href="#connections-plot_connections"></a>
</h3>
<p>Overview — one spoke per tract to its dominant station:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-conn-vga-overview.png" alt="" width="100%"></p>
<p>Large city:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_bh</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-conn-bh-overview.png" alt="" width="100%"></p>
<p>Interactive version for BH (click tracts and stations for detailed
weight tables):</p>
<iframe src="figures/diag-s5-conn-bh-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
<p>Detail for a specific tract:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_vga</span>, tract <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-conn-vga-detail1.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interactive-exploration">Interactive exploration<a class="anchor" aria-label="anchor" href="#interactive-exploration"></a>
</h3>
<p>All weight diagnostics support <code>interactive = TRUE</code>, which
produces leaflet/mapview maps with rich click popups. This is the
recommended way to explore the weight structure for individual tracts
and stations.</p>
<p><strong>Interactive connections</strong> — click any tract to see its
top-5 connected stations (with weights, travel times, and cumulative
weight). Click any station to see which tracts it serves:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_vga</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="figures/diag-s5-conn-vga-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
<p><strong>Interactive dominant station map</strong> — click any tract
to see weight summary statistics (effective sources, HHI, dominant
weight):</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"dominant"</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="figures/diag-s5-dom-vga-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
</div>
<div class="section level3">
<h3 id="interpretation-4">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-4"></a>
</h3>
<ul>
<li>
<strong>Effective number of sources</strong>: This is the
exponential of Shannon entropy on the row-normalized weights. A value of
1 means the tract depends on a single station; a value of 10 means the
weights are equivalent to 10 equal-weight stations. High values (e.g.,
&gt; 50) can indicate that the travel time ceiling is creating a uniform
background weight across many distant stations. The
<code>fill_missing = Inf</code> default (see Section 6) addresses this
by zeroing out unreachable pairs.</li>
<li>
<strong>Low entropy tracts</strong> (effective N close to 1): The
interpolation for this tract depends almost entirely on a single
station. If that station’s data is atypical, the interpolated values may
be unreliable.</li>
<li>
<strong>Dominant station map</strong>: Produces a Voronoi-like
partition. If catchment areas don’t match geographic intuition, check
the travel time matrix.</li>
<li>
<strong>Connections</strong>: The spoke pattern should make
geographic sense — tracts should connect to nearby stations.
Long-distance connections suggest routing issues.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="travel-time-data-quality-plot_travel_times">6. Travel Time Data Quality: <code>plot_travel_times()</code><a class="anchor" aria-label="anchor" href="#travel-time-data-quality-plot_travel_times"></a>
</h2>
<div class="section level3">
<h3 id="intuition-5">Intuition<a class="anchor" aria-label="anchor" href="#intuition-5"></a>
</h3>
<p>The travel time matrix is the input that drives everything:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
optimization, weight computation, and ultimately the spatial allocation
of voters. Poor travel time data (unreachable pairs, disconnected road
networks) directly degrades interpolation quality.</p>
</div>
<div class="section level3">
<h3 id="applied-examples-1">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-1"></a>
</h3>
<p><strong>Histogram</strong> — distribution of all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \times m</annotation></semantics></math>
travel times:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-vga-hist.png" alt="" width="100%"></p>
<p>Large city:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-bh-hist.png" alt="" width="100%"></p>
<p><strong>Heatmap</strong> — rows = tracts (ordered by latitude),
columns = stations. Block-diagonal structure reveals spatial
locality:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-vga-heatmap.png" alt="" width="100%"></p>
<p><strong>Map</strong> — station points colored by travel time for a
specific tract:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, tract <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-vga-map.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="the-fill_missing-parameter">The <code>fill_missing</code> parameter<a class="anchor" aria-label="anchor" href="#the-fill_missing-parameter"></a>
</h3>
<p>When the routing engine cannot find a path between a tract and a
station, the travel time is set to <code>fill_missing</code>. By
default, <code>routing_control(fill_missing = NULL)</code> resolves to
<code>Inf</code>, which is internally replaced by a large finite
sentinel value (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mn>6</mn></msup><annotation encoding="application/x-tex">10^6</annotation></semantics></math>
minutes). This gives these unreachable pairs an effective weight of
zero:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mn>10</mn><mn>6</mn></msup><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><mi>α</mi></mrow></msup><mo>≈</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">K_{ij} = (10^6 + 1)^{-\alpha} \approx 0</annotation></semantics></math></p>
<p>Previous versions used <code>fill_missing = max_trip_duration</code>
(typically 300 minutes), which gave unreachable pairs a non-negligible
weight of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>301</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><mi>α</mi></mrow></msup><annotation encoding="application/x-tex">(301)^{-\alpha}</annotation></semantics></math>.
In dense cities with many unreachable pairs, this created a uniform
background weight that inflated the effective number of sources. To
restore the old behavior:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/routing_control.html">routing_control</a></span><span class="op">(</span>fill_missing <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpretation-5">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-5"></a>
</h3>
<ul>
<li>
<strong>Spike at sentinel value</strong>: These are “fill” values
for unreachable pairs. With <code>fill_missing = Inf</code>, these pairs
receive zero weight and do not affect interpolation. A large number of
unreachable pairs suggests poor OSM network coverage.</li>
<li>
<strong>Bimodal distribution</strong>: May indicate disconnected
graph components (e.g., separated by a river without bridge in the OSM
network).</li>
<li>
<strong>Block-diagonal heatmap</strong>: Expected — nearby tracts
have similar travel times to the same stations. Absence of block
structure suggests the travel times lack spatial coherence.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="spatial-autocorrelation-plot_residual_autocorrelation-plot_moran">7. Spatial Autocorrelation:
<code>plot_residual_autocorrelation()</code> +
<code>plot_moran()</code><a class="anchor" aria-label="anchor" href="#spatial-autocorrelation-plot_residual_autocorrelation-plot_moran"></a>
</h2>
<div class="section level3">
<h3 id="intuition-6">Intuition<a class="anchor" aria-label="anchor" href="#intuition-6"></a>
</h3>
<p><strong>Residual autocorrelation</strong>: If residuals are spatially
clustered (nearby tracts have similar residuals), the model is missing
spatial structure — a misspecification signal.</p>
<p><strong>Moran’s I on interpolated variables</strong>: If the
interpolated vote shares show expected spatial concentration (e.g., PT
strongholds in low-income areas), the method is preserving realistic
political geography.</p>
</div>
<div class="section level3">
<h3 id="formal-definition-5">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-5"></a>
</h3>
<p><strong>Global Moran’s I</strong>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>=</mo><mfrac><mi>n</mi><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo>⋅</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">I = \frac{n}{\sum_{i,j} w_{ij}} \cdot \frac{\sum_{i,j} w_{ij}(x_i - \bar{x})(x_j - \bar{x})}{\sum_i (x_i - \bar{x})^2}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math>
are spatial weights (queen contiguity). Range:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>−</mi><mn>1</mn><mo>,</mo><mi>+</mi><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[-1, +1]</annotation></semantics></math>.
Positive = clustering,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\approx 0</annotation></semantics></math>
= random, negative = dispersion.</p>
<p><strong>LISA (Local Moran’s I)</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>s</mi><mn>2</mn></msup></mfrac><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I_i = \frac{(x_i - \bar{x})}{s^2} \sum_j w_{ij}(x_j - \bar{x})</annotation></semantics></math>.
Classification: HH (high-high cluster), LL (low-low), HL (high
surrounded by low), LH (low surrounded by high).</p>
</div>
<div class="section level3">
<h3 id="applied-examples-residual-autocorrelation">Applied examples: Residual autocorrelation<a class="anchor" aria-label="anchor" href="#applied-examples-residual-autocorrelation"></a>
</h3>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residual_autocorrelation.html">plot_residual_autocorrelation</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-moran-resid-vga.png" alt="" width="100%"></p>
<p>Pearson residuals:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residual_autocorrelation.html">plot_residual_autocorrelation</a></span><span class="op">(</span><span class="va">result_vga</span>, residual_type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-moran-resid-vga-pear.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-lisa-cluster-maps">Applied examples: LISA cluster maps<a class="anchor" aria-label="anchor" href="#applied-examples-lisa-cluster-maps"></a>
</h3>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"lisa"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-lisa-vga-lula.png" alt="" width="100%"></p>
<p>Moran scatterplot:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"moran"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-moran-vga-lula.png" alt="" width="100%"></p>
<p>Large city:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_bh</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"lisa"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-lisa-bh-lula.png" alt="" width="100%"></p>
<p>By party:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_nit</span>, variable <span class="op">=</span> <span class="st">"PT"</span>, type <span class="op">=</span> <span class="st">"lisa"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-lisa-nit-pt.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interpretation-6">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-6"></a>
</h3>
<ul>
<li>
<strong>Significant Moran’s I on residuals</strong> (p &lt; 0.05):
The model has spatially structured error. Consider whether the travel
time data has systematic problems in certain areas.</li>
<li>
<strong>HH clusters of Lula votes</strong>: Expected in low-income
neighborhoods (PT strongholds). Their presence validates that the
interpolation preserves known political geography.</li>
<li>
<strong>HL/LH clusters</strong>: Spatial outliers — tracts with high
vote share surrounded by low (or vice versa). May indicate local effects
or data irregularities.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="baseline-comparisons-compare_baselines-leave_one_out">8. Baseline Comparisons: <code>compare_baselines()</code> +
<code>leave_one_out()</code><a class="anchor" aria-label="anchor" href="#baseline-comparisons-compare_baselines-leave_one_out"></a>
</h2>
<div class="section level3">
<h3 id="intuition-7">Intuition<a class="anchor" aria-label="anchor" href="#intuition-7"></a>
</h3>
<p>Is the optimized IDW actually better than simpler alternatives? And
how robust is the interpolation to removing individual stations?</p>
</div>
<div class="section level3">
<h3 id="formal-definition-6">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-6"></a>
</h3>
<p><strong>Baselines</strong>: - <strong>Nearest</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><msup><mi>j</mi><mo>*</mo></msup></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">W_{ij^*} = 1</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>j</mi><mo>*</mo></msup><mo>=</mo><mo>arg</mo><msub><mo>min</mo><mi>j</mi></msub><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">j^* = \arg\min_j t_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">W_{ij} = 0</annotation></semantics></math>
otherwise (binary assignment to closest station) -
<strong>Uniform</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn><mi>/</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">W_{ij} = 1/m</annotation></semantics></math>
(equal weight to all stations, column-normalized) -
<strong>Areal</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
based on spatial intersection areas between tract and station Voronoi
cells</p>
<p><strong>Leave-one-out</strong>: Remove station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
predict its demographics using remaining
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m-1</annotation></semantics></math>
stations with the full-model alpha values. Compare predicted vs actual.
This is the only form of out-of-sample validation possible (there is no
tract-level ground truth).</p>
</div>
<div class="section level3">
<h3 id="applied-examples-compare_baselines">Applied examples: <code>compare_baselines()</code><a class="anchor" aria-label="anchor" href="#applied-examples-compare_baselines"></a>
</h3>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_baselines.html">compare_baselines</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Baseline comparison</span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt;   Optimized IDW          RMSE=11.89  Deviance=18946.51</span></span>
<span><span class="co">#&gt;   Nearest station        RMSE=36.79  Deviance=157454.96  (IDW 68% better)</span></span>
<span><span class="co">#&gt;   Uniform weights        RMSE=15.81  Deviance=34553.92  (IDW 25% better)</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_baselines.html">compare_baselines</a></span><span class="op">(</span><span class="va">result_bh</span>, methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nearest"</span>, <span class="st">"uniform"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Baseline comparison</span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt;   Optimized IDW          RMSE=7.11  Deviance=144450.98</span></span>
<span><span class="co">#&gt;   Nearest station        RMSE=27.00  Deviance=1393922.64  (IDW 74% better)</span></span>
<span><span class="co">#&gt;   Uniform weights        RMSE=12.96  Deviance=477898.82  (IDW 45% better)</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="applied-examples-leave_one_out">Applied examples: <code>leave_one_out()</code><a class="anchor" aria-label="anchor" href="#applied-examples-leave_one_out"></a>
</h3>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/leave_one_out.html">leave_one_out</a></span><span class="op">(</span><span class="va">result_igr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   LOO: station 1 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 2 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 3 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 4 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 5 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 6 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 7 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 8 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 9 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 10 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 11 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 12 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 13 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 14 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 15 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 16 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 17 / 17</span></span>
<span><span class="co">#&gt; Leave-one-out RMSE: 7.2895 (mean), 7.1375 (median)</span></span>
<span><span class="co">#&gt; Full model RMSE:    6.7842</span></span>
<span><span class="co">#&gt; LOO degradation:    7.4%</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/leave_one_out.html">leave_one_out</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   LOO: station 1 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 2 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 3 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 4 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 5 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 6 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 7 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 8 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 9 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 10 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 11 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 12 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 13 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 14 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 15 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 16 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 17 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 18 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 19 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 20 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 21 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 22 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 23 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 24 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 25 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 26 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 27 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 28 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 29 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 30 / 30</span></span>
<span><span class="co">#&gt; Leave-one-out RMSE: 14.6001 (mean), 14.5283 (median)</span></span>
<span><span class="co">#&gt; Full model RMSE:    11.8866</span></span>
<span><span class="co">#&gt; LOO degradation:    22.8%</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="interpretation-7">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-7"></a>
</h3>
<ul>
<li>
<strong>Positive improvement %</strong>: The optimized IDW has lower
RMSE/deviance than the baseline. The optimization adds value.</li>
<li>
<strong>Negative improvement %</strong>: This should not happen. If
it does, the optimization may have overfitted or the data has
issues.</li>
<li>
<strong>LOO degradation</strong>: LOO RMSE should be comparable to
full-model RMSE. If LOO RMSE is much larger, the model may be
overfitting to specific station configurations.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="ecological-validation">9. Ecological Validation<a class="anchor" aria-label="anchor" href="#ecological-validation"></a>
</h2>
<div class="section level3">
<h3 id="a--implied-turnout-rates-plot_turnout_rates">9a. Implied Turnout Rates: <code>plot_turnout_rates()</code><a class="anchor" aria-label="anchor" href="#a--implied-turnout-rates-plot_turnout_rates"></a>
</h3>
<div class="section level4">
<h4 id="intuition-8">Intuition<a class="anchor" aria-label="anchor" href="#intuition-8"></a>
</h4>
<p>For each tract and demographic bracket, the implied turnout rate
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">rate</mtext><mrow><mi>i</mi><mo>,</mo><mi>b</mi></mrow></msub><mo>=</mo><mfrac><msub><mtext mathvariant="normal">fitted voters</mtext><mrow><mi>i</mi><mo>,</mo><mi>b</mi></mrow></msub><msub><mtext mathvariant="normal">census population</mtext><mrow><mi>i</mi><mo>,</mo><mi>b</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">\text{rate}_{i,b} = \frac{\text{fitted voters}_{i,b}}{\text{census population}_{i,b}}</annotation></semantics></math></p>
<p>In Brazil, voting is <strong>compulsory</strong> for ages 18–69, so
expected turnout is ~75–85%. For 16–17 and 70+, voting is optional and
rates should be lower. Rates exceeding 100% indicate tracts where the
model allocates more voters than residents — signaling boundary effects
or registration mismatches.</p>
</div>
<div class="section level4">
<h4 id="applied-examples-2">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-2"></a>
</h4>
<p>Bracket boxplot:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-vga-bracket.png" alt="" width="100%"></p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-nit-bracket.png" alt="" width="100%"></p>
<p>Spatial pattern:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-bh-map.png" alt="" width="100%"></p>
<p>Faceted histogram:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-vga-hist.png" alt="" width="100%"></p>
</div>
<div class="section level4">
<h4 id="interpretation-8">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-8"></a>
</h4>
<ul>
<li>
<strong>Compulsory brackets clustering around 80%</strong>: Expected
for ages 18–69.</li>
<li>
<strong>Optional brackets lower</strong>: 16–17 and 70+ should show
lower turnout.</li>
<li>
<strong>Rates &gt; 100%</strong>: Voters registered in one
municipality who may actually reside in another (commuters, students).
These boundary effects are a known limitation of the model.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="b--income-vote-correlation-plot_income">9b. Income-Vote Correlation: <code>plot_income()</code><a class="anchor" aria-label="anchor" href="#b--income-vote-correlation-plot_income"></a>
</h3>
<div class="section level4">
<h4 id="intuition-9">Intuition<a class="anchor" aria-label="anchor" href="#intuition-9"></a>
</h4>
<p>The negative correlation between PT vote share and income is one of
the best-documented patterns in Brazilian political science (the
“PT-income gradient”). If the interpolation preserves this gradient, it
builds confidence that the spatial allocation of votes is realistic. If
it destroys it, something is wrong.</p>
<p>Income data comes from censobr (Census Bureau microdata), which
provides mean household head income by tract. No deflation is applied —
within a single census year, the correlation is scale-invariant.</p>
</div>
<div class="section level4">
<h4 id="applied-examples-3">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-3"></a>
</h4>
<p>Lula (PT) vs income — expect negative correlation:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-vga-lula.png" alt="" width="100%"></p>
<p>Bolsonaro (PL) vs income — expect positive correlation:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="fl">22</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-vga-bolso.png" alt="" width="100%"></p>
<p>Larger city:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_bh</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-bh-lula.png" alt="" width="100%"></p>
<p>Side-by-side maps:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_nit</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-nit-map.png" alt="" width="100%"></p>
</div>
</div>
<div class="section level3">
<h3 id="c--cross-round-consistency-plot_ecological">9c. Cross-Round Consistency: <code>plot_ecological()</code><a class="anchor" aria-label="anchor" href="#c--cross-round-consistency-plot_ecological"></a>
</h3>
<div class="section level4">
<h4 id="intuition-10">Intuition<a class="anchor" aria-label="anchor" href="#intuition-10"></a>
</h4>
<p>Political geography is sticky. Neighborhoods that vote strongly for a
candidate in round 1 should vote even more strongly in round 2 (where
only 2 candidates remain). A high correlation between turno 1 and turno
2 tract-level vote shares validates that the interpolation preserves
spatial patterns.</p>
</div>
<div class="section level4">
<h4 id="applied-examples-4">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-4"></a>
</h4>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ecological.html">plot_ecological</a></span><span class="op">(</span><span class="va">result_vga</span>, <span class="va">result_vga2</span>,</span>
<span>                variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-ecol-vga-scatter.png" alt="" width="100%"></p>
<p>Side-by-side maps:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ecological.html">plot_ecological</a></span><span class="op">(</span><span class="va">result_vga</span>, <span class="va">result_vga2</span>,</span>
<span>                variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-ecol-vga-map.png" alt="" width="100%"></p>
</div>
<div class="section level4">
<h4 id="interpretation-9">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-9"></a>
</h4>
<ul>
<li>
<strong>Strong positive correlation</strong> between rounds: The
spatial patterns are consistent, as expected. The method is recovering
stable partisan geography.</li>
<li>
<strong>Weak or no correlation</strong>: The interpolation may be
injecting noise rather than recovering signal. Investigate whether the
travel time data or optimization is causing problems.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="quick-reference">10. Quick Reference<a class="anchor" aria-label="anchor" href="#quick-reference"></a>
</h2>
<table class="table">
<colgroup>
<col width="16%">
<col width="34%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">Function</th>
<th align="left">Question it answers</th>
<th align="left">Key arguments</th>
<th align="left">When to worry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="../reference/diagnostics.html">diagnostics()</a></code></td>
<td align="left">Is anything obviously wrong?</td>
<td align="left"><code>verbose</code></td>
<td align="left">Any FAIL or multiple WARNs</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_convergence.html">plot_convergence()</a></code></td>
<td align="left">Did the optimizer converge?</td>
<td align="left">
<code>which</code>, <code>log_y</code>
</td>
<td align="left">Oscillating loss, non-shrinking gradient</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_alpha.html">plot_alpha()</a></code></td>
<td align="left">How does distance decay vary?</td>
<td align="left">
<code>type</code>, <code>summary_fn</code>,
<code>brackets</code>
</td>
<td align="left">Many tracts with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 15</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_residuals.html">plot_residuals()</a></code></td>
<td align="left">How well are demographics reproduced?</td>
<td align="left">
<code>type</code>, <code>residual_type</code>,
<code>summary_fn</code>
</td>
<td align="left">Large systematic bias, Pearson &gt; 3</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/residual_summary.html">residual_summary()</a></code></td>
<td align="left">Which brackets/tracts fit worst?</td>
<td align="left"><code>type</code></td>
<td align="left">One bracket much worse than others</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/weight_summary.html">weight_summary()</a></code></td>
<td align="left">How concentrated are the weights?</td>
<td align="left">—</td>
<td align="left">Many tracts with effective N = 1</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_weights.html">plot_weights()</a></code></td>
<td align="left">Where are catchment areas?</td>
<td align="left">
<code>type</code>, <code>tract</code>,
<code>top_k</code>
</td>
<td align="left">Catchments that defy geography</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_connections.html">plot_connections()</a></code></td>
<td align="left">Which stations serve which tracts?</td>
<td align="left">
<code>tract</code>, <code>top_k</code>,
<code>threshold</code>
</td>
<td align="left">Long-distance connections</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_travel_times.html">plot_travel_times()</a></code></td>
<td align="left">Is the travel time matrix clean?</td>
<td align="left">
<code>type</code>, <code>tract</code>
</td>
<td align="left">Large spike at max value</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_residual_autocorrelation.html">plot_residual_autocorrelation()</a></code></td>
<td align="left">Are residuals spatially clustered?</td>
<td align="left">
<code>residual_type</code>,
<code>summary_fn</code>
</td>
<td align="left">Significant Moran’s I (p &lt; 0.05)</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_moran.html">plot_moran()</a></code></td>
<td align="left">Is vote geography realistic?</td>
<td align="left">
<code>variable</code>, <code>type</code>
</td>
<td align="left">No spatial clustering</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/compare_baselines.html">compare_baselines()</a></code></td>
<td align="left">Is IDW better than naive methods?</td>
<td align="left"><code>methods</code></td>
<td align="left">Negative improvement</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/leave_one_out.html">leave_one_out()</a></code></td>
<td align="left">Is the model overfitting?</td>
<td align="left"><code>max_stations</code></td>
<td align="left">LOO RMSE &gt;&gt; full RMSE</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_turnout_rates.html">plot_turnout_rates()</a></code></td>
<td align="left">Are implied turnout rates plausible?</td>
<td align="left"><code>type</code></td>
<td align="left">Many tracts &gt; 100%</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_income.html">plot_income()</a></code></td>
<td align="left">Does the PT-income gradient hold?</td>
<td align="left">
<code>variable</code>, <code>type</code>
</td>
<td align="left">Wrong sign on correlation</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_ecological.html">plot_ecological()</a></code></td>
<td align="left">Are spatial patterns consistent?</td>
<td align="left">
<code>variable</code>, <code>type</code>
</td>
<td align="left">Weak cross-round correlation</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rogerio Barbosa, Lucas Gelape.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
