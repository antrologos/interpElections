<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Diagnostics and Validation • interpElections</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostics and Validation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">interpElections</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/get-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Technical</h6></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/working-with-results.html">Working with Results</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostics.html">Diagnostics &amp; Validation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/interpElections/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Diagnostics and Validation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antrologos/interpElections/blob/HEAD/vignettes/diagnostics.Rmd" class="external-link"><code>vignettes/diagnostics.Rmd</code></a></small>
      <div class="d-none name"><code>diagnostics.Rmd</code></div>
    </div>

    
    
<p>interpElections provides 16 diagnostic functions for validating
interpolation results. This vignette demonstrates each one using
<strong>real data</strong> from four Brazilian municipalities of varying
sizes:</p>
<table class="table">
<thead><tr class="header">
<th align="left">City</th>
<th align="left">State</th>
<th align="right">Tracts</th>
<th align="right">Sources</th>
<th align="left">Character</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Igrejinha</td>
<td align="left">RS</td>
<td align="right">~40</td>
<td align="right">~10</td>
<td align="left">Tiny rural municipality</td>
</tr>
<tr class="even">
<td align="left">Varginha</td>
<td align="left">MG</td>
<td align="right">~280</td>
<td align="right">~37</td>
<td align="left">Small city (primary example)</td>
</tr>
<tr class="odd">
<td align="left">Niteroi</td>
<td align="left">RJ</td>
<td align="right">~450</td>
<td align="right">~80</td>
<td align="left">Medium, dense urban area</td>
</tr>
<tr class="even">
<td align="left">Belo Horizonte</td>
<td align="left">MG</td>
<td align="right">~5,100</td>
<td align="right">~600</td>
<td align="left">Major metropolitan area</td>
</tr>
</tbody>
</table>
<p>Each section follows the pattern: <strong>Intuition</strong> (why it
matters), <strong>Formal definition</strong> (the math), <strong>Applied
example</strong> (real output), <strong>Interpretation</strong> (what to
look for).</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/interpElections/">interpElections</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load precomputed results (2022 presidential election)</span></span>
<span><span class="va">result_igr</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/igrejinha_2022.rds"</span><span class="op">)</span></span>
<span><span class="va">result_vga</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/varginha_2022.rds"</span><span class="op">)</span></span>
<span><span class="va">result_vga2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/varginha_2022_t2.rds"</span><span class="op">)</span>  <span class="co"># turno 2</span></span>
<span><span class="va">result_nit</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/niteroi_2022.rds"</span><span class="op">)</span></span>
<span><span class="va">result_bh</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"precomputed/belo_horizonte_2022.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Quick overview of each result:</p>
<pre><code><span><span class="co">#&gt; interpElections result summary</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; Municipality: VARGINHA (MG) -- IBGE: 3170701, TSE: 54135</span></span>
<span><span class="co">#&gt; Election: 2022 | Census: 2022 | Turno: 1 | Cargo: PRESIDENTE </span></span>
<span><span class="co">#&gt; Census tracts: 279 | Sources: 37 | Variables: 28</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration: gender x 7 age brackets (14 pairs)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization: pb_sgd_colnorm_cpu | Objective: 4670.4370 | Convergence: 0</span></span>
<span><span class="co">#&gt;   Alpha: min=1.000, Q1=1.604, median=1.870, Q3=2.227, max=11.836</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Candidates (13):</span></span>
<span><span class="co">#&gt;   CAND_30                  LUIZ FELIPE CHAVES D AVILA (NOVO) total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   CAND_44                  SORAYA VIEIRA THRONICKE (UNIÃO) total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   CAND_12                  CIRO FERREIRA GOMES (PDT) total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   CAND_13                  LUIZ INÁCIO LULA DA SILVA (PT) total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   ... 9 more -- View(result$dictionary)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Turnout (1):</span></span>
<span><span class="co">#&gt;   QT_COMPARECIMENTO        turnout                total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration (14):</span></span>
<span><span class="co">#&gt;   vot_hom_18_19            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_hom_20_24            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_hom_25_29            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_hom_30_39            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_hom_40_49            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_hom_50_59            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_hom_60_69            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_18_19            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_20_24            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_25_29            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_30_39            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_40_49            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_50_59            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt;   vot_mul_60_69            calibration            total=        NA  mean=      NA  [NA, NA]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object size: 181.3 MB</span></span>
<span><span class="co">#&gt; Neighborhoods: 387</span></span></code></pre>
<pre><code><span><span class="co">#&gt; interpElections result summary</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; Municipality: BELO HORIZONTE (MG) -- IBGE: 3106200, TSE: 41238</span></span>
<span><span class="co">#&gt; Election: 2022 | Census: 2022 | Turno: 1 | Cargo: PRESIDENTE </span></span>
<span><span class="co">#&gt; Census tracts: 5109 | Sources: 407 | Variables: 28</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration: gender x 7 age brackets (14 pairs)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization: pb_sgd_colnorm_cuda | Objective: 13281.0293 | Convergence: 0</span></span>
<span><span class="co">#&gt;   Alpha: min=1.000, Q1=1.248, median=1.357, Q3=1.487, max=17.115</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Candidates (13):</span></span>
<span><span class="co">#&gt;   CAND_13                  LUIZ INÁCIO LULA DA SILVA (PT) total=    603542  mean=   118.1  [2.8, 334.0]</span></span>
<span><span class="co">#&gt;   CAND_27                  JOSE MARIA EYMAEL (DC) total=       209  mean=     0.0  [0.0, 0.3]</span></span>
<span><span class="co">#&gt;   CAND_30                  LUIZ FELIPE CHAVES D AVILA (NOVO) total=     14496  mean=     2.8  [0.1, 12.2]</span></span>
<span><span class="co">#&gt;   CAND_14                  KELMON LUIS DA SILVA SOUZA (PTB) total=       861  mean=     0.2  [0.0, 1.0]</span></span>
<span><span class="co">#&gt;   ... 9 more -- View(result$dictionary)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Turnout (1):</span></span>
<span><span class="co">#&gt;   QT_COMPARECIMENTO        turnout                total=   1489578  mean=   291.6  [7.1, 802.2]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration (14):</span></span>
<span><span class="co">#&gt;   vot_hom_18_19            calibration            total=     21044  mean=     4.1  [0.0, 12.6]</span></span>
<span><span class="co">#&gt;   vot_hom_20_24            calibration            total=     73593  mean=    14.4  [0.3, 44.4]</span></span>
<span><span class="co">#&gt;   vot_hom_25_29            calibration            total=     81481  mean=    15.9  [0.4, 58.2]</span></span>
<span><span class="co">#&gt;   vot_hom_30_39            calibration            total=    172752  mean=    33.8  [0.8, 102.2]</span></span>
<span><span class="co">#&gt;   vot_hom_40_49            calibration            total=    170766  mean=    33.4  [0.8, 113.1]</span></span>
<span><span class="co">#&gt;   vot_hom_50_59            calibration            total=    138388  mean=    27.1  [0.7, 71.7]</span></span>
<span><span class="co">#&gt;   vot_hom_60_69            calibration            total=    105049  mean=    20.6  [0.4, 52.7]</span></span>
<span><span class="co">#&gt;   vot_mul_18_19            calibration            total=     23556  mean=     4.6  [0.0, 15.0]</span></span>
<span><span class="co">#&gt;   vot_mul_20_24            calibration            total=     77657  mean=    15.2  [0.3, 46.7]</span></span>
<span><span class="co">#&gt;   vot_mul_25_29            calibration            total=     88270  mean=    17.3  [0.4, 69.7]</span></span>
<span><span class="co">#&gt;   vot_mul_30_39            calibration            total=    190378  mean=    37.3  [0.9, 110.6]</span></span>
<span><span class="co">#&gt;   vot_mul_40_49            calibration            total=    194436  mean=    38.1  [0.9, 136.5]</span></span>
<span><span class="co">#&gt;   vot_mul_50_59            calibration            total=    165447  mean=    32.4  [0.8, 86.6]</span></span>
<span><span class="co">#&gt;   vot_mul_60_69            calibration            total=    137434  mean=    26.9  [0.6, 68.5]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object size: 243.8 MB</span></span>
<span><span class="co">#&gt; Neighborhoods: 865</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="automated-health-check-diagnostics">1. Automated Health Check: <code>diagnostics()</code><a class="anchor" aria-label="anchor" href="#automated-health-check-diagnostics"></a>
</h2>
<div class="section level3">
<h3 id="intuition">Intuition<a class="anchor" aria-label="anchor" href="#intuition"></a>
</h3>
<p><code><a href="../reference/diagnostics.html">diagnostics()</a></code> is a single-call “blood test” for your
interpolation result. It runs 8 automated checks and reports
PASS/WARN/FAIL for each. Use it as a first step after every
interpolation to catch problems early.</p>
<p>Only checks whose outcome is <strong>not guaranteed by
construction</strong> are included. Vote conservation, non-negativity,
and column normalization are all enforced by design and therefore
omitted.</p>
</div>
<div class="section level3">
<h3 id="formal-definition">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition"></a>
</h3>
<table style="width:100%;" class="table">
<colgroup>
<col width="19%">
<col width="30%">
<col width="16%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">Check</th>
<th align="left">Statistic</th>
<th align="left">PASS</th>
<th align="left">WARN</th>
<th align="left">FAIL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Convergence</td>
<td align="left">Optimizer exit code</td>
<td align="left">code = 0</td>
<td align="left">code != 0</td>
<td align="left">–</td>
</tr>
<tr class="even">
<td align="left">Alpha distribution</td>
<td align="left">% of tracts with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 15</annotation></semantics></math>
</td>
<td align="left">&lt; 5%</td>
<td align="left">&gt;= 5%</td>
<td align="left">–</td>
</tr>
<tr class="odd">
<td align="left">Residual RMSE</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mrow><mtext mathvariant="normal">mean</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>r</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><annotation encoding="application/x-tex">\sqrt{\text{mean}(r^2)}</annotation></semantics></math></td>
<td align="left">always (informational)</td>
<td align="left">–</td>
<td align="left">–</td>
</tr>
<tr class="even">
<td align="left">Residual bias</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>max</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mover><mi>r</mi><mo accent="true">‾</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow><mi>/</mi><mtext mathvariant="normal">RMSE</mtext></mrow><annotation encoding="application/x-tex">\max |\bar{r}_k| / \text{RMSE}</annotation></semantics></math></td>
<td align="left">ratio &lt; 10%</td>
<td align="left">ratio &gt;= 10%</td>
<td align="left">–</td>
</tr>
<tr class="odd">
<td align="left">Pop-voter gap</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>N</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>s</mi></mrow></msub><mo>−</mo><msub><mi>N</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mi>/</mi><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>s</mi></mrow></msub><mo>,</mo><msub><mi>N</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">|N_{census} - N_{source}| / \max(N_{census}, N_{source})</annotation></semantics></math></td>
<td align="left">&lt; 5%</td>
<td align="left">5–20%</td>
<td align="left">&gt; 20%</td>
</tr>
<tr class="even">
<td align="left">Unreachable pairs</td>
<td align="left">% of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
near max</td>
<td align="left">&lt; 1%</td>
<td align="left">1–10%</td>
<td align="left">&gt; 10%</td>
</tr>
<tr class="odd">
<td align="left">Alpha spatial CV</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">sd</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mtext mathvariant="normal">mean</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{sd}(\alpha) / \text{mean}(\alpha)</annotation></semantics></math></td>
<td align="left">CV &gt;= 0.1</td>
<td align="left">CV &lt; 0.1</td>
<td align="left">–</td>
</tr>
<tr class="even">
<td align="left">Implied turnout</td>
<td align="left">% of tracts with rate &gt; 110%</td>
<td align="left">&lt; 5%</td>
<td align="left">&gt;= 5%</td>
<td align="left">–</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="applied-example">Applied example<a class="anchor" aria-label="anchor" href="#applied-example"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; interpElections diagnostics</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt;  [PASS] Convergence: optimizer converged (code 0)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha distribution: median=1.83, IQR=[1.61, 2.16], 0% &gt; 15</span></span>
<span><span class="co">#&gt;  [PASS] Residual RMSE: 11.3331 (informational)</span></span>
<span><span class="co">#&gt;  [WARN] Residual bias: max |colMeans(resid)| = 8.6344 (76.2% of RMSE)</span></span>
<span><span class="co">#&gt;  [WARN] Population-voter gap: census=96829, source=78389, gap=19.0%</span></span>
<span><span class="co">#&gt;  [WARN] Unreachable pairs: 2.9% of pairs unreachable (298 / 10323 NA)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha spatial variation: CV of median-alpha = 0.492</span></span>
<span><span class="co">#&gt;  [PASS] Implied turnout: 1.1% of tracts with implied turnout &gt; 110%</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; 5 PASS, 3 WARN</span></span></code></pre>
<p>For a larger city:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">result_bh</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; interpElections diagnostics</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt;  [PASS] Convergence: optimizer converged (code 0)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha distribution: median=1.36, IQR=[1.26, 1.47], 0% &gt; 15</span></span>
<span><span class="co">#&gt;  [PASS] Residual RMSE: 7.2604 (informational)</span></span>
<span><span class="co">#&gt;  [WARN] Residual bias: max |colMeans(resid)| = 1.8894 (26.0% of RMSE)</span></span>
<span><span class="co">#&gt;  [PASS] Population-voter gap: census=1650864, source=1640251, gap=0.6%</span></span>
<span><span class="co">#&gt;  [FAIL] Unreachable pairs: 48.0% of pairs unreachable (997611 / 2079363 NA)</span></span>
<span><span class="co">#&gt;  [PASS] Alpha spatial variation: CV of median-alpha = 0.567</span></span>
<span><span class="co">#&gt;  [PASS] Implied turnout: 2.2% of tracts with implied turnout &gt; 110%</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; 6 PASS, 1 WARN, 1 FAIL</span></span></code></pre>
<p>You can also access check values programmatically:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">result_vga</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">checks</span><span class="op">$</span><span class="va">convergence</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">checks</span><span class="op">$</span><span class="va">residual_rmse</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">checks</span><span class="op">$</span><span class="va">pop_voter_gap</span><span class="op">$</span><span class="va">value</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<ul>
<li>
<strong>Convergence WARN</strong>: The optimizer didn’t converge
within the epoch limit. Try increasing <code>max_epochs</code> in
<code><a href="../reference/optim_control.html">optim_control()</a></code>, or check if the learning rate is too
high.</li>
<li>
<strong>Alpha distribution WARN</strong>: Many tracts have very high
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">&gt; 15</annotation></semantics></math>),
meaning they effectively use only the nearest station. This can happen
when travel time data has poor coverage.</li>
<li>
<strong>Pop-voter gap WARN/FAIL</strong>: The total census
population differs substantially from the total registered voters. This
is expected to some degree (not everyone registers, some register
outside their residence), but gaps &gt; 20% suggest data quality
issues.</li>
<li>
<strong>Unreachable pairs FAIL</strong>: Many tract-station pairs
have travel times at the ceiling. This means the routing engine couldn’t
find paths — check OSM road network coverage.</li>
<li>
<strong>Alpha spatial CV WARN</strong>: Alpha values have very low
variation across tracts (CV &lt; 0.1). The optimizer may not be adapting
to local conditions, possibly because of insufficient data or poor
convergence.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="optimization-convergence-plot_convergence">2. Optimization Convergence: <code>plot_convergence()</code><a class="anchor" aria-label="anchor" href="#optimization-convergence-plot_convergence"></a>
</h2>
<div class="section level3">
<h3 id="intuition-1">Intuition<a class="anchor" aria-label="anchor" href="#intuition-1"></a>
</h3>
<p>The optimizer minimizes Poisson deviance by adjusting the decay
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
<code><a href="../reference/plot_convergence.html">plot_convergence()</a></code> shows the optimization trajectory: is
the loss decreasing smoothly? Is the gradient approaching zero? What
learning rate schedule was used?</p>
</div>
<div class="section level3">
<h3 id="formal-definition-1">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-1"></a>
</h3>
<ul>
<li>
<strong>Loss</strong>: Poisson deviance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>2</mn><msub><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>k</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>log</mo><mfrac><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub></mfrac><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">= 2 \sum_{i,k} \left[ y_{ik} \log\frac{y_{ik}}{\hat{y}_{ik}} - (y_{ik} - \hat{y}_{ik}) \right]</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
= observed census population and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>y</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math>
= fitted population from the model.</li>
<li>
<strong>Gradient norm</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">‖</mo><msub><mi>∇</mi><mi>α</mi></msub><mi>L</mi><mo stretchy="true" form="postfix">‖</mo></mrow><mn>2</mn></msub><annotation encoding="application/x-tex">\lVert \nabla_\alpha L \rVert_2</annotation></semantics></math>,
the Euclidean norm of the gradient of the loss with respect to all alpha
parameters.</li>
<li>
<strong>Learning rate</strong>: Step size in gradient descent. May
decay over epochs via cosine annealing or other schedules.</li>
</ul>
</div>
<div class="section level3">
<h3 id="applied-examples">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples"></a>
</h3>
<p>All three panels (loss, gradient, learning rate):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-vga-all.png" alt="" width="100%"></p>
<p>Comparing with a GPU-optimized large city:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_bh</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-bh-all.png" alt="" width="100%"></p>
<p>Show only the loss panel:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_vga</span>, which <span class="op">=</span> <span class="st">"loss"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-vga-loss.png" alt="" width="100%"></p>
<p>Log scale for loss and gradient (useful when the values span orders
of magnitude):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">result_vga</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loss"</span>, <span class="st">"gradient"</span><span class="op">)</span>, log_y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s2-conv-vga-log.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interpretation-1">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-1"></a>
</h3>
<ul>
<li>
<strong>Good convergence</strong>: Smooth, monotonically decreasing
loss that plateaus. Gradient norm approaches zero. The vertical dashed
red line marks the best epoch.</li>
<li>
<strong>Poor convergence</strong>: Oscillating loss, gradient that
doesn’t shrink, or loss that hasn’t plateaued by the last epoch.
Consider increasing <code>max_epochs</code> or adjusting the learning
rate.</li>
<li>
<strong>Learning rate</strong>: If using cosine annealing, you’ll
see a decaying pattern. Flat LR = constant step size throughout.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="alpha-decay-parameters-plot_alpha">3. Alpha Decay Parameters: <code>plot_alpha()</code><a class="anchor" aria-label="anchor" href="#alpha-decay-parameters-plot_alpha"></a>
</h2>
<div class="section level3">
<h3 id="intuition-2">Intuition<a class="anchor" aria-label="anchor" href="#intuition-2"></a>
</h3>
<p>The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math>
controls how sharply the weight of station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
decays with travel time for tract
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
Higher
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
means voters are more localized (sharp decay — only nearby stations
matter). Lower
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
means voters come from a broader area (gradual decay — distant stations
still contribute).</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is a <strong>matrix</strong> with one row per tract and one column per
demographic bracket (14 brackets = 7 age groups
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>
2 genders). Different brackets may have different decay patterns (e.g.,
young voters may travel farther to vote).</p>
</div>
<div class="section level3">
<h3 id="formal-definition-2">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-2"></a>
</h3>
<p>The weight before column normalization is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><msub><mi>α</mi><mi>i</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">K_{ij} = (t_{ij} + 1)^{-\alpha_i}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel time (in minutes) from tract
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
to station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.
The final weight is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>K</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{ij} = K_{ij} / \sum_i K_{ij}</annotation></semantics></math>
(column-normalized so each station’s voters are fully distributed).</p>
</div>
<div class="section level3">
<h3 id="applied-examples-map-mode">Applied examples: Map mode<a class="anchor" aria-label="anchor" href="#applied-examples-map-mode"></a>
</h3>
<p>The map mode collapses the 14-bracket alpha matrix to a single scalar
per tract using <code>summary_fn</code>. This is the key visualization
choice — different summaries answer different questions.</p>
<p><strong>Median</strong> (default) — the “typical” alpha across all
brackets:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-median.png" alt="" width="100%"></p>
<p><strong>Mean</strong> — sensitive to extreme values in any
bracket:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-mean.png" alt="" width="100%"></p>
<p><strong>Population-weighted</strong> — weights each bracket by the
tract’s population in that bracket:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"pop_weighted"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-popwt.png" alt="" width="100%"></p>
<p><strong>Range</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>max</mo><mo>−</mo><mo>min</mo></mrow><annotation encoding="application/x-tex">\max - \min</annotation></semantics></math>)
— measures how much
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
varies across brackets within each tract:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"range"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-range.png" alt="" width="100%"></p>
<p><strong>Single bracket</strong> (e.g., bracket 1 = Male 18–20):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-vga-map-bracket1.png" alt="" width="100%"></p>
<p><strong>Large city comparison</strong> (Belo Horizonte):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-bh-map-median.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-histogram-mode">Applied examples: Histogram mode<a class="anchor" aria-label="anchor" href="#applied-examples-histogram-mode"></a>
</h3>
<p>Density plots faceted by bracket. With 14 brackets arranged in a 2$$7
grid, you can compare age groups and genders at a glance.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-nit-hist-all.png" alt="" width="100%"></p>
<p>Select specific brackets:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, brackets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-nit-hist-sel.png" alt="" width="100%"></p>
<p>Small city (narrower distributions due to fewer tracts):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_igr</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-igr-hist-all.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-bracket-boxplot">Applied examples: Bracket boxplot<a class="anchor" aria-label="anchor" href="#applied-examples-bracket-boxplot"></a>
</h3>
<p>The most compact view — one boxplot per bracket on a single
panel:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-bh-bracket.png" alt="" width="100%"></p>
<p>Male brackets only:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alpha.html">plot_alpha</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"bracket"</span>, brackets <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s3-alpha-nit-bracket-male.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interpretation-2">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-2"></a>
</h3>
<ul>
<li>
<strong>Urban core vs periphery</strong>: Central tracts with many
nearby stations tend to have higher
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
(sharper decay). Peripheral tracts with few nearby stations have lower
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
(they must draw from distant stations).</li>
<li>
<strong>Age patterns</strong>: Younger brackets may show different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
distributions than older ones, reflecting different mobility
patterns.</li>
<li>
<strong>Range map</strong>: High range = the optimizer found very
different decay rates for different brackets in that tract. This often
occurs at the urban-rural boundary.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 15</annotation></semantics></math></strong>:
Effectively nearest-station assignment. The decay is so steep that only
the closest station has non-negligible weight.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="calibration-residuals-plot_residuals-residual_summary">4. Calibration Residuals: <code>plot_residuals()</code> +
<code>residual_summary()</code><a class="anchor" aria-label="anchor" href="#calibration-residuals-plot_residuals-residual_summary"></a>
</h2>
<div class="section level3">
<h3 id="intuition-3">Intuition<a class="anchor" aria-label="anchor" href="#intuition-3"></a>
</h3>
<p>The model calibrates against known census demographics (population by
age<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>gender
bracket). Residuals measure how well the model reproduces these known
quantities. Small residuals mean the model’s spatial allocation of
voters closely matches census demographics — giving confidence that the
interpolated (unknown) electoral variables are also spatially
accurate.</p>
</div>
<div class="section level3">
<h3 id="formal-definition-3">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-3"></a>
</h3>
<p>Three types of residuals are available:</p>
<ul>
<li>
<strong>Raw</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">r_{ik} = \hat{y}_{ik} - y_{ik}</annotation></semantics></math>
(fitted minus observed). Scale depends on population size.</li>
<li>
<strong>Pearson</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>r</mi><mrow><mi>i</mi><mi>k</mi></mrow><mi>P</mi></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msqrt><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub></msqrt></mrow><annotation encoding="application/x-tex">r_{ik}^P = (\hat{y}_{ik} - y_{ik}) / \sqrt{\hat{y}_{ik}}</annotation></semantics></math>.
Standardized under the Poisson assumption — comparable across tracts of
different sizes.</li>
<li>
<strong>Deviance</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>r</mi><mrow><mi>i</mi><mi>k</mi></mrow><mi>D</mi></msubsup><mo>=</mo><mtext mathvariant="normal">sign</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><msqrt><mrow><mn>2</mn><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>log</mo><mfrac><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub></mfrac><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>−</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">r_{ik}^D = \text{sign}(\hat{y}_{ik} - y_{ik}) \cdot \sqrt{2\left[y_{ik}\log\frac{y_{ik}}{\hat{y}_{ik}} - (y_{ik} - \hat{y}_{ik})\right]}</annotation></semantics></math>.
Individual Poisson deviance contributions.</li>
</ul>
</div>
<div class="section level3">
<h3 id="applied-examples-map-mode-1">Applied examples: Map mode<a class="anchor" aria-label="anchor" href="#applied-examples-map-mode-1"></a>
</h3>
<p>For maps, <code>summary_fn</code> collapses across the 14 brackets to
a single value per tract.</p>
<p><strong>RMSE</strong> (default) — magnitude of misfit:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-rmse.png" alt="" width="100%"></p>
<p><strong>Mean</strong> — directional bias (positive = over-prediction,
negative = under-prediction):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-mean.png" alt="" width="100%"></p>
<p><strong>Pearson residuals</strong> (standardized):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, residual_type <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>               summary_fn <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-pearson.png" alt="" width="100%"></p>
<p><strong>Large city</strong> (Belo Horizonte):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-bh-map-rmse.png" alt="" width="100%"></p>
<p><strong>Single bracket</strong>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, summary_fn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-map-bracket1.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-histogram-mode-1">Applied examples: Histogram mode<a class="anchor" aria-label="anchor" href="#applied-examples-histogram-mode-1"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-nit-hist-raw.png" alt="" width="100%"></p>
<p>Compare with Pearson residuals:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, residual_type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-nit-hist-pearson.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-bracket-boxplot-1">Applied examples: Bracket boxplot<a class="anchor" aria-label="anchor" href="#applied-examples-bracket-boxplot-1"></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-bh-bracket-raw.png" alt="" width="100%"></p>
<p>Deviance scale:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"bracket"</span>, residual_type <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-bh-bracket-dev.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-scatter-fitted-vs-observed">Applied examples: Scatter (fitted vs observed)<a class="anchor" aria-label="anchor" href="#applied-examples-scatter-fitted-vs-observed"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_igr</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-igr-scatter.png" alt="" width="100%"></p>
<p>Selected brackets:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"scatter"</span>, brackets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s4-resid-vga-scatter-sel.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="tabular-summary-residual_summary">Tabular summary: <code>residual_summary()</code><a class="anchor" aria-label="anchor" href="#tabular-summary-residual_summary"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/residual_summary.html">residual_summary</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $per_bracket</span></span>
<span><span class="co">#&gt;         bracket      mean      rmse  max_abs pct_gt_2sd</span></span>
<span><span class="co">#&gt; 1    Male 18-19 -2.827957  4.090797 20.49560  11.111111</span></span>
<span><span class="co">#&gt; 2    Male 20-24 -4.939068  7.863136 30.09403  10.752688</span></span>
<span><span class="co">#&gt; 3    Male 25-29 -3.688171  8.143861 50.85045   5.376344</span></span>
<span><span class="co">#&gt; 4    Male 30-39 -8.189961 17.197483 81.67102   8.243728</span></span>
<span><span class="co">#&gt; 5    Male 40-49 -6.788528 12.646651 51.29978   7.885305</span></span>
<span><span class="co">#&gt; 6    Male 50-59 -3.684587 10.722865 47.07844   5.734767</span></span>
<span><span class="co">#&gt; 7    Male 60-69 -2.093190 10.621665 34.50467   3.942652</span></span>
<span><span class="co">#&gt; 8  Female 18-19 -1.896057  3.223661 15.23459   8.243728</span></span>
<span><span class="co">#&gt; 9  Female 20-24 -4.594982  8.286037 40.84304   6.451613</span></span>
<span><span class="co">#&gt; 10 Female 25-29 -3.767024  9.127714 58.36239   4.659498</span></span>
<span><span class="co">#&gt; 11 Female 30-39 -8.634406 18.520190 76.77784   9.318996</span></span>
<span><span class="co">#&gt; 12 Female 40-49 -7.537632 13.327423 49.34589  10.035842</span></span>
<span><span class="co">#&gt; 13 Female 50-59 -4.498207 11.115594 35.52768   7.526882</span></span>
<span><span class="co">#&gt; 14 Female 60-69 -2.953405 12.776099 42.50458   3.584229</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $per_tract</span></span>
<span><span class="co">#&gt;            tract_id         mean      rmse worst_bracket</span></span>
<span><span class="co">#&gt; 1   317070105000001  -4.46978183  7.780279    Male 30-39</span></span>
<span><span class="co">#&gt; 2   317070105000008  -5.69532052  6.521208  Female 30-39</span></span>
<span><span class="co">#&gt; 3   317070105000009  -6.40664761  9.267085  Female 50-59</span></span>
<span><span class="co">#&gt; 4   317070105000010  -4.09593649  8.241522  Female 60-69</span></span>
<span><span class="co">#&gt; 5   317070105000013  -5.79583025  7.723394    Male 50-59</span></span>
<span><span class="co">#&gt; 6   317070105000014  -4.70288513  6.429955  Female 60-69</span></span>
<span><span class="co">#&gt; 7   317070105000015  -3.21996417  5.024781  Female 20-24</span></span>
<span><span class="co">#&gt; 8   317070105000016  -3.66598534  5.970083    Male 40-49</span></span>
<span><span class="co">#&gt; 9   317070105000017  -8.02832181 10.453555  Female 30-39</span></span>
<span><span class="co">#&gt; 10  317070105000019  -3.39119823  5.524819    Male 60-69</span></span>
<span><span class="co">#&gt; 11  317070105000021  -5.09111145  7.203794    Male 40-49</span></span>
<span><span class="co">#&gt; 12  317070105000022  -2.92625683  5.141192  Female 25-29</span></span>
<span><span class="co">#&gt; 13  317070105000023  -4.70994909  7.473714    Male 30-39</span></span>
<span><span class="co">#&gt; 14  317070105000024  -4.65966836  7.084826    Male 25-29</span></span>
<span><span class="co">#&gt; 15  317070105000025  -3.58820938  7.515399  Female 60-69</span></span>
<span><span class="co">#&gt; 16  317070105000026  -2.59066838  4.599541  Female 30-39</span></span>
<span><span class="co">#&gt; 17  317070105000028  -7.85698397 15.446466  Female 30-39</span></span>
<span><span class="co">#&gt; 18  317070105000029  -5.40849541  8.450547  Female 40-49</span></span>
<span><span class="co">#&gt; 19  317070105000031  -3.89397077  5.834789  Female 60-69</span></span>
<span><span class="co">#&gt; 20  317070105000032  -5.28109306  8.720115    Male 20-24</span></span>
<span><span class="co">#&gt; 21  317070105000033  -3.80484335  5.778048    Male 60-69</span></span>
<span><span class="co">#&gt; 22  317070105000035  -4.22505171  6.261096  Female 30-39</span></span>
<span><span class="co">#&gt; 23  317070105000036  -5.25458948  9.366690    Male 30-39</span></span>
<span><span class="co">#&gt; 24  317070105000037  -3.69797455  5.705231  Female 60-69</span></span>
<span><span class="co">#&gt; 25  317070105000039  -5.18900581  7.768118    Male 40-49</span></span>
<span><span class="co">#&gt; 26  317070105000040  -5.54970207 17.902995    Male 50-59</span></span>
<span><span class="co">#&gt; 27  317070105000041  -4.35580469  8.416798  Female 50-59</span></span>
<span><span class="co">#&gt; 28  317070105000043  -2.92924034  5.086059    Male 40-49</span></span>
<span><span class="co">#&gt; 29  317070105000044  -4.92242984 14.221143    Male 40-49</span></span>
<span><span class="co">#&gt; 30  317070105000045  -5.54451610  9.378096  Female 40-49</span></span>
<span><span class="co">#&gt; 31  317070105000047  -6.87290218 11.932898  Female 50-59</span></span>
<span><span class="co">#&gt; 32  317070105000048  -4.12777463  7.548253    Male 30-39</span></span>
<span><span class="co">#&gt; 33  317070105000049  -3.86660142  5.565906  Female 30-39</span></span>
<span><span class="co">#&gt; 34  317070105000050  -5.07588214  8.838433  Female 60-69</span></span>
<span><span class="co">#&gt; 35  317070105000051  -3.16488998  4.579301  Female 40-49</span></span>
<span><span class="co">#&gt; 36  317070105000052  -4.98188243  7.269529  Female 30-39</span></span>
<span><span class="co">#&gt; 37  317070105000054  -4.35382028  8.647110  Female 60-69</span></span>
<span><span class="co">#&gt; 38  317070105000055  -4.29991404 11.477892  Female 50-59</span></span>
<span><span class="co">#&gt; 39  317070105000056  -2.65074687  5.708509  Female 60-69</span></span>
<span><span class="co">#&gt; 40  317070105000057  -3.53921237  7.376684  Female 60-69</span></span>
<span><span class="co">#&gt; 41  317070105000059  -5.54329305  8.078800  Female 40-49</span></span>
<span><span class="co">#&gt; 42  317070105000060  -5.67776673  7.052883    Male 50-59</span></span>
<span><span class="co">#&gt; 43  317070105000061  -4.54991476  6.796096  Female 50-59</span></span>
<span><span class="co">#&gt; 44  317070105000063  -4.27955069  9.015014  Female 60-69</span></span>
<span><span class="co">#&gt; 45  317070105000065  -6.46841403  9.618279    Male 60-69</span></span>
<span><span class="co">#&gt; 46  317070105000066  -5.61921541 11.229709    Male 60-69</span></span>
<span><span class="co">#&gt; 47  317070105000067  -3.70455425  7.798223  Female 50-59</span></span>
<span><span class="co">#&gt; 48  317070105000069  -7.08697385  9.610891    Male 30-39</span></span>
<span><span class="co">#&gt; 49  317070105000070  -5.11650942  8.360278  Female 50-59</span></span>
<span><span class="co">#&gt; 50  317070105000071  -5.00843229  7.873160  Female 60-69</span></span>
<span><span class="co">#&gt; 51  317070105000074  -4.61650515  7.532968  Female 60-69</span></span>
<span><span class="co">#&gt; 52  317070105000077  -3.93589804  9.000784  Female 60-69</span></span>
<span><span class="co">#&gt; 53  317070105000078  -5.27064515  8.735191  Female 60-69</span></span>
<span><span class="co">#&gt; 54  317070105000079  -5.42014183  8.153125  Female 40-49</span></span>
<span><span class="co">#&gt; 55  317070105000082  -5.65931668  8.814523    Male 60-69</span></span>
<span><span class="co">#&gt; 56  317070105000083  -4.67848798  8.477325  Female 50-59</span></span>
<span><span class="co">#&gt; 57  317070105000086  -5.79974066  9.232188    Male 40-49</span></span>
<span><span class="co">#&gt; 58  317070105000087  -5.33495329  8.472898  Female 50-59</span></span>
<span><span class="co">#&gt; 59  317070105000089  -7.47620551 10.905327  Female 40-49</span></span>
<span><span class="co">#&gt; 60  317070105000091  -5.88057711  9.118924  Female 60-69</span></span>
<span><span class="co">#&gt; 61  317070105000094  -6.92574008  9.256367  Female 60-69</span></span>
<span><span class="co">#&gt; 62  317070105000095  -7.06021306  9.379119    Male 40-49</span></span>
<span><span class="co">#&gt; 63  317070105000096  -6.87335323 10.553908  Female 40-49</span></span>
<span><span class="co">#&gt; 64  317070105000100  -9.94300685 15.623448  Female 40-49</span></span>
<span><span class="co">#&gt; 65  317070105000101  -4.73015509  8.957741    Male 50-59</span></span>
<span><span class="co">#&gt; 66  317070105000102  -9.45775086 14.596251  Female 50-59</span></span>
<span><span class="co">#&gt; 67  317070105000103  -3.42464735  6.877452  Female 60-69</span></span>
<span><span class="co">#&gt; 68  317070105000104  -5.05947052 10.247530  Female 60-69</span></span>
<span><span class="co">#&gt; 69  317070105000105  -6.64221452 10.466741  Female 60-69</span></span>
<span><span class="co">#&gt; 70  317070105000106  -4.74402852  7.739311  Female 60-69</span></span>
<span><span class="co">#&gt; 71  317070105000107  -5.04264300  9.476863  Female 60-69</span></span>
<span><span class="co">#&gt; 72  317070105000108  -4.52430196 11.836652  Female 60-69</span></span>
<span><span class="co">#&gt; 73  317070105000112 -10.70524209 19.208083  Female 40-49</span></span>
<span><span class="co">#&gt; 74  317070105000114  -7.58292592 12.414566  Female 50-59</span></span>
<span><span class="co">#&gt; 75  317070105000115  -7.85118226 12.988053    Male 50-59</span></span>
<span><span class="co">#&gt; 76  317070105000116  -5.23164076 10.780131    Male 50-59</span></span>
<span><span class="co">#&gt; 77  317070105000117  -5.95415250  9.466325  Female 40-49</span></span>
<span><span class="co">#&gt; 78  317070105000120  -4.89691516 14.875840  Female 30-39</span></span>
<span><span class="co">#&gt; 79  317070105000121  -1.44764559  5.226840    Male 50-59</span></span>
<span><span class="co">#&gt; 80  317070105000124  -9.30533133 12.488768  Female 30-39</span></span>
<span><span class="co">#&gt; 81  317070105000125  -7.83185485  9.944685  Female 40-49</span></span>
<span><span class="co">#&gt; 82  317070105000126  -4.28045952  6.748654  Female 60-69</span></span>
<span><span class="co">#&gt; 83  317070105000127  -4.77031584  7.512045  Female 50-59</span></span>
<span><span class="co">#&gt; 84  317070105000128  -6.51097071 10.078242    Male 60-69</span></span>
<span><span class="co">#&gt; 85  317070105000129  -5.90250621  9.063544  Female 50-59</span></span>
<span><span class="co">#&gt; 86  317070105000130  -5.64954139  6.886282  Female 50-59</span></span>
<span><span class="co">#&gt; 87  317070105000131  -6.75248864 12.220189  Female 60-69</span></span>
<span><span class="co">#&gt; 88  317070105000133  -6.03865184 13.555790  Female 60-69</span></span>
<span><span class="co">#&gt; 89  317070105000134  -3.08150406  6.888872  Female 50-59</span></span>
<span><span class="co">#&gt; 90  317070105000135  -4.89329067  9.373227  Female 60-69</span></span>
<span><span class="co">#&gt; 91  317070105000136  -1.84728816  5.654837  Female 30-39</span></span>
<span><span class="co">#&gt; 92  317070105000138 -11.01428571 12.405644  Female 60-69</span></span>
<span><span class="co">#&gt; 93  317070105000139  -2.83529955  7.100915    Male 50-59</span></span>
<span><span class="co">#&gt; 94  317070105000140  -1.73322996  5.343345    Male 50-59</span></span>
<span><span class="co">#&gt; 95  317070105000141  -1.96477361  4.927858    Male 50-59</span></span>
<span><span class="co">#&gt; 96  317070105000142 -10.51428571 12.016417    Male 40-49</span></span>
<span><span class="co">#&gt; 97  317070105000143 -10.95714286 12.349320  Female 40-49</span></span>
<span><span class="co">#&gt; 98  317070105000144  -4.29576738  6.475777    Male 40-49</span></span>
<span><span class="co">#&gt; 99  317070105000147  -7.57497684 13.883793    Male 40-49</span></span>
<span><span class="co">#&gt; 100 317070105000148  -6.95230788  9.746854  Female 40-49</span></span>
<span><span class="co">#&gt; 101 317070105000149  -4.04310841  9.315555  Female 50-59</span></span>
<span><span class="co">#&gt; 102 317070105000150  -0.09205360  2.453728  Female 60-69</span></span>
<span><span class="co">#&gt; 103 317070105000151  -9.38574168 14.562069    Male 50-59</span></span>
<span><span class="co">#&gt; 104 317070105000152  -4.05701272 10.191480  Female 60-69</span></span>
<span><span class="co">#&gt; 105 317070105000153  -5.12329326  7.086856  Female 60-69</span></span>
<span><span class="co">#&gt; 106 317070105000154  -5.97116573  7.561613  Female 50-59</span></span>
<span><span class="co">#&gt; 107 317070105000155  -4.40479715  5.876291  Female 50-59</span></span>
<span><span class="co">#&gt; 108 317070105000156  -3.38121653  6.447234  Female 60-69</span></span>
<span><span class="co">#&gt; 109 317070105000157  -7.38748886 14.083776  Female 40-49</span></span>
<span><span class="co">#&gt; 110 317070105000158  -4.51901512  6.005070    Male 60-69</span></span>
<span><span class="co">#&gt; 111 317070105000159  -6.55120159 15.163124  Female 40-49</span></span>
<span><span class="co">#&gt; 112 317070105000160  -5.82683227 10.990449  Female 50-59</span></span>
<span><span class="co">#&gt; 113 317070105000161  -8.37639883 13.662417  Female 50-59</span></span>
<span><span class="co">#&gt; 114 317070105000162  -6.40080059 13.818299    Male 50-59</span></span>
<span><span class="co">#&gt; 115 317070105000164  -2.37118808  8.546970  Female 30-39</span></span>
<span><span class="co">#&gt; 116 317070105000165   0.22212169  1.101596  Female 25-29</span></span>
<span><span class="co">#&gt; 117 317070105000166  -6.87200698  9.183925  Female 50-59</span></span>
<span><span class="co">#&gt; 118 317070105000168  -7.55816260  9.901026  Female 40-49</span></span>
<span><span class="co">#&gt; 119 317070105000169  -6.18064683  8.358678  Female 60-69</span></span>
<span><span class="co">#&gt; 120 317070105000171  -5.65975764 14.035889  Female 40-49</span></span>
<span><span class="co">#&gt; 121 317070105000172  -5.31781160 16.142278    Male 40-49</span></span>
<span><span class="co">#&gt; 122 317070105000174  -4.72435992 16.356485    Male 30-39</span></span>
<span><span class="co">#&gt; 123 317070105000175  -2.71496952 10.298496  Female 30-39</span></span>
<span><span class="co">#&gt; 124 317070105000176  -1.55969492  3.617670  Female 30-39</span></span>
<span><span class="co">#&gt; 125 317070105000177   9.37303532 14.054435  Female 30-39</span></span>
<span><span class="co">#&gt; 126 317070105000178  -4.56211561 14.353457  Female 30-39</span></span>
<span><span class="co">#&gt; 127 317070105000179  -4.06906832  6.673661  Female 60-69</span></span>
<span><span class="co">#&gt; 128 317070105000180  -3.81645096  6.853486  Female 60-69</span></span>
<span><span class="co">#&gt; 129 317070105000181  -3.05099036  6.596282    Male 60-69</span></span>
<span><span class="co">#&gt; 130 317070105000182  -6.13905913 19.792027  Female 30-39</span></span>
<span><span class="co">#&gt; 131 317070105000183  -9.32212146 19.624818  Female 40-49</span></span>
<span><span class="co">#&gt; 132 317070105000185  -4.35020716  6.326250  Female 50-59</span></span>
<span><span class="co">#&gt; 133 317070105000186  -4.26238139  8.832778  Female 60-69</span></span>
<span><span class="co">#&gt; 134 317070105000188  -7.11605725  9.998682  Female 40-49</span></span>
<span><span class="co">#&gt; 135 317070105000189  -4.48957226  8.247922  Female 60-69</span></span>
<span><span class="co">#&gt; 136 317070105000190  -3.48081790  4.948018  Female 40-49</span></span>
<span><span class="co">#&gt; 137 317070105000191  -2.16225685  5.348972  Female 60-69</span></span>
<span><span class="co">#&gt; 138 317070105000192  -3.98062714  7.363546  Female 30-39</span></span>
<span><span class="co">#&gt; 139 317070105000193  -3.41123408  8.592075    Male 30-39</span></span>
<span><span class="co">#&gt; 140 317070105000194  -5.89246770 10.087114    Male 20-24</span></span>
<span><span class="co">#&gt; 141 317070105000196  -7.41453811 23.364285  Female 30-39</span></span>
<span><span class="co">#&gt; 142 317070105000197   0.08298607  1.586720    Male 30-39</span></span>
<span><span class="co">#&gt; 143 317070105000198  -0.52907993  1.760266    Male 60-69</span></span>
<span><span class="co">#&gt; 144 317070105000199  -5.66189173  9.579314  Female 40-49</span></span>
<span><span class="co">#&gt; 145 317070105000200  -7.39849787 13.993152    Male 40-49</span></span>
<span><span class="co">#&gt; 146 317070105000201  -7.37047749 13.272088  Female 50-59</span></span>
<span><span class="co">#&gt; 147 317070105000205  -7.30761777 20.104961  Female 40-49</span></span>
<span><span class="co">#&gt; 148 317070105000206  -7.38316109 18.697316  Female 40-49</span></span>
<span><span class="co">#&gt; 149 317070105000207  -2.19033493  6.801264    Male 20-24</span></span>
<span><span class="co">#&gt; 150 317070105000208  -5.74515367 15.286066  Female 30-39</span></span>
<span><span class="co">#&gt; 151 317070105000209  -7.17987136 18.356939  Female 30-39</span></span>
<span><span class="co">#&gt; 152 317070105000210  -5.18184771 12.734001  Female 40-49</span></span>
<span><span class="co">#&gt; 153 317070105000211  -3.76001088 11.339685  Female 40-49</span></span>
<span><span class="co">#&gt; 154 317070105000212  -4.63035739 11.521751  Female 40-49</span></span>
<span><span class="co">#&gt; 155 317070105000213  -5.17376113 13.426430  Female 30-39</span></span>
<span><span class="co">#&gt; 156 317070105000214  -8.88049176 26.172918  Female 30-39</span></span>
<span><span class="co">#&gt; 157 317070105000216  -6.60765474 20.959614    Male 30-39</span></span>
<span><span class="co">#&gt; 158 317070105000217  -2.98070111 11.574437  Female 30-39</span></span>
<span><span class="co">#&gt; 159 317070105000219  -9.00126981 30.011366    Male 30-39</span></span>
<span><span class="co">#&gt; 160 317070105000220  -2.24084214  6.325360    Male 20-24</span></span>
<span><span class="co">#&gt; 161 317070105000221  -3.40950336  6.094611  Female 60-69</span></span>
<span><span class="co">#&gt; 162 317070105000222  -2.09463879  4.456393    Male 60-69</span></span>
<span><span class="co">#&gt; 163 317070105000223  -1.54964403  4.448766  Female 60-69</span></span>
<span><span class="co">#&gt; 164 317070105000224  -2.54114135  7.189218  Female 25-29</span></span>
<span><span class="co">#&gt; 165 317070105000225  -2.06761302  5.207428    Male 60-69</span></span>
<span><span class="co">#&gt; 166 317070105000226  -2.03412647  4.494774    Male 25-29</span></span>
<span><span class="co">#&gt; 167 317070105000227  -3.93916279  7.105443    Male 30-39</span></span>
<span><span class="co">#&gt; 168 317070105000228  -2.88029353  4.856285  Female 20-24</span></span>
<span><span class="co">#&gt; 169 317070105000229  -3.72300315  6.301937  Female 60-69</span></span>
<span><span class="co">#&gt; 170 317070105000230  -3.40944562  4.990152  Female 60-69</span></span>
<span><span class="co">#&gt; 171 317070105000231  -3.85189135  6.035891    Male 30-39</span></span>
<span><span class="co">#&gt; 172 317070105000232  -2.85902328  4.248717    Male 60-69</span></span>
<span><span class="co">#&gt; 173 317070105000233  -2.60761506  3.980579    Male 30-39</span></span>
<span><span class="co">#&gt; 174 317070105000234  -2.04350410  4.884697    Male 20-24</span></span>
<span><span class="co">#&gt; 175 317070105000235  -3.92571869  6.701134  Female 30-39</span></span>
<span><span class="co">#&gt; 176 317070105000236  -2.29353158  4.713671  Female 20-24</span></span>
<span><span class="co">#&gt; 177 317070105000237  -5.05134358  8.760045  Female 40-49</span></span>
<span><span class="co">#&gt; 178 317070105000238  -3.10664216  6.845682  Female 60-69</span></span>
<span><span class="co">#&gt; 179 317070105000239  -2.58490714  4.991092  Female 50-59</span></span>
<span><span class="co">#&gt; 180 317070105000240  -2.55276300  5.017651  Female 60-69</span></span>
<span><span class="co">#&gt; 181 317070105000241  -3.29748551  9.692393  Female 50-59</span></span>
<span><span class="co">#&gt; 182 317070105000242  -5.47205505  8.967630    Male 30-39</span></span>
<span><span class="co">#&gt; 183 317070105000243  -2.94082344  5.089976    Male 30-39</span></span>
<span><span class="co">#&gt; 184 317070105000244  -2.92593525  5.871260    Male 20-24</span></span>
<span><span class="co">#&gt; 185 317070105000245  -6.09796927  7.880939  Female 40-49</span></span>
<span><span class="co">#&gt; 186 317070105000246  -4.79644059 14.507438  Female 30-39</span></span>
<span><span class="co">#&gt; 187 317070105000247  -3.87800652  5.314640    Male 25-29</span></span>
<span><span class="co">#&gt; 188 317070105000248  -3.64048516  6.197416  Female 60-69</span></span>
<span><span class="co">#&gt; 189 317070105000249  -2.70802333  5.142643  Female 60-69</span></span>
<span><span class="co">#&gt; 190 317070105000250  -2.14734239  7.188832    Male 40-49</span></span>
<span><span class="co">#&gt; 191 317070105000251  -5.85967447 13.289550  Female 30-39</span></span>
<span><span class="co">#&gt; 192 317070105000252  -6.13233465  9.426209  Female 40-49</span></span>
<span><span class="co">#&gt; 193 317070105000253  -5.62125579 11.996178  Female 30-39</span></span>
<span><span class="co">#&gt; 194 317070105000254  -4.43924613  7.247192    Male 50-59</span></span>
<span><span class="co">#&gt; 195 317070105000255  -5.17465209  6.778978  Female 50-59</span></span>
<span><span class="co">#&gt; 196 317070105000256  -3.54452564  7.116696    Male 40-49</span></span>
<span><span class="co">#&gt; 197 317070105000257  -4.56645349  6.532802  Female 40-49</span></span>
<span><span class="co">#&gt; 198 317070105000258  -3.57928864  6.598547  Female 40-49</span></span>
<span><span class="co">#&gt; 199 317070105000259  -3.75511963 11.034016  Female 60-69</span></span>
<span><span class="co">#&gt; 200 317070105000260  -2.68180853  6.567740  Female 60-69</span></span>
<span><span class="co">#&gt; 201 317070105000261  -4.53623565  8.572451    Male 60-69</span></span>
<span><span class="co">#&gt; 202 317070105000262  -2.86537006  7.349391    Male 60-69</span></span>
<span><span class="co">#&gt; 203 317070105000263  -4.95779910  6.752232    Male 40-49</span></span>
<span><span class="co">#&gt; 204 317070105000264  -3.41874363  7.568416    Male 60-69</span></span>
<span><span class="co">#&gt; 205 317070105000265  -3.59290264  5.707987  Female 50-59</span></span>
<span><span class="co">#&gt; 206 317070105000266  -3.09675628  5.397823  Female 60-69</span></span>
<span><span class="co">#&gt; 207 317070105000267  -2.82532021  5.326122    Male 40-49</span></span>
<span><span class="co">#&gt; 208 317070105000268  -3.39354091  4.775391    Male 30-39</span></span>
<span><span class="co">#&gt; 209 317070105000269  -5.82607350  8.532071  Female 60-69</span></span>
<span><span class="co">#&gt; 210 317070105000270  -2.58332027  7.494807  Female 40-49</span></span>
<span><span class="co">#&gt; 211 317070105000271  -6.86463086 10.141773    Male 40-49</span></span>
<span><span class="co">#&gt; 212 317070105000272  -2.99226218  6.048348    Male 20-24</span></span>
<span><span class="co">#&gt; 213 317070105000273  -7.42774649 11.595932  Female 40-49</span></span>
<span><span class="co">#&gt; 214 317070105000274  -3.59836205  7.065970    Male 40-49</span></span>
<span><span class="co">#&gt; 215 317070105000275  -3.57947639  7.495054  Female 50-59</span></span>
<span><span class="co">#&gt; 216 317070105000276  -1.15282145  2.235907    Male 50-59</span></span>
<span><span class="co">#&gt; 217 317070105000277  -4.94508815 12.877212  Female 50-59</span></span>
<span><span class="co">#&gt; 218 317070105000278  -3.56140529  9.012226  Female 60-69</span></span>
<span><span class="co">#&gt; 219 317070105000279 -11.38037062 23.160827  Female 30-39</span></span>
<span><span class="co">#&gt; 220 317070105000281  -6.46720990  8.330964    Male 30-39</span></span>
<span><span class="co">#&gt; 221 317070105000282  -8.32424305 21.559227    Male 40-49</span></span>
<span><span class="co">#&gt; 222 317070105000283  -4.29694270  7.084340  Female 60-69</span></span>
<span><span class="co">#&gt; 223 317070105000284  -3.58707074  7.900689  Female 60-69</span></span>
<span><span class="co">#&gt; 224 317070105000285  -0.51066122  2.584213    Male 50-59</span></span>
<span><span class="co">#&gt; 225 317070105000286  -2.05797467  3.537599    Male 60-69</span></span>
<span><span class="co">#&gt; 226 317070105000287  -4.27751720  8.201016    Male 50-59</span></span>
<span><span class="co">#&gt; 227 317070105000288  -5.98806256 11.224576    Male 50-59</span></span>
<span><span class="co">#&gt; 228 317070105000289  -3.97599679  4.952262  Female 40-49</span></span>
<span><span class="co">#&gt; 229 317070105000290  -7.56002009 23.456935    Male 30-39</span></span>
<span><span class="co">#&gt; 230 317070105000291  -4.25221956 12.654563  Female 30-39</span></span>
<span><span class="co">#&gt; 231 317070105000292  -7.19632528 29.571819  Female 30-39</span></span>
<span><span class="co">#&gt; 232 317070105000293  -6.73239594 25.289948    Male 30-39</span></span>
<span><span class="co">#&gt; 233 317070105000294  -3.44708939 13.481216  Female 40-49</span></span>
<span><span class="co">#&gt; 234 317070105000295  -6.78640747 15.223176  Female 30-39</span></span>
<span><span class="co">#&gt; 235 317070105000296  -4.09955191  8.383322    Male 60-69</span></span>
<span><span class="co">#&gt; 236 317070105000297  -4.10914492  5.277312    Male 20-24</span></span>
<span><span class="co">#&gt; 237 317070105000298  -6.16337522 13.886344  Female 30-39</span></span>
<span><span class="co">#&gt; 238 317070105000299  -4.35758986 12.768339  Female 30-39</span></span>
<span><span class="co">#&gt; 239 317070105000300  -8.75445183 18.876183    Male 30-39</span></span>
<span><span class="co">#&gt; 240 317070105000301  -7.11259054 19.989977  Female 30-39</span></span>
<span><span class="co">#&gt; 241 317070105000302  -9.18575187 30.215780  Female 30-39</span></span>
<span><span class="co">#&gt; 242 317070105000303  -9.82653476 28.642227    Male 30-39</span></span>
<span><span class="co">#&gt; 243 317070105000304  -5.07906810 20.678122  Female 30-39</span></span>
<span><span class="co">#&gt; 244 317070105000305  -3.59284370 11.397482  Female 30-39</span></span>
<span><span class="co">#&gt; 245 317070105000307  -7.31920961 27.990769  Female 30-39</span></span>
<span><span class="co">#&gt; 246 317070105000308  -7.75966438 23.471593  Female 25-29</span></span>
<span><span class="co">#&gt; 247 317070105000309  -4.00167392 15.882670    Male 30-39</span></span>
<span><span class="co">#&gt; 248 317070105000310  -6.15993693 21.472827  Female 25-29</span></span>
<span><span class="co">#&gt; 249 317070105000311  -1.57470078  3.016574  Female 60-69</span></span>
<span><span class="co">#&gt; 250 317070105000312  -5.54156791  9.630858  Female 40-49</span></span>
<span><span class="co">#&gt; 251 317070105000313  -5.85762555 12.702007  Female 40-49</span></span>
<span><span class="co">#&gt; 252 317070105000314  -2.87938883  4.196684  Female 30-39</span></span>
<span><span class="co">#&gt; 253 317070105000315  -1.37737761  3.483471  Female 50-59</span></span>
<span><span class="co">#&gt; 254 317070105000316  -1.23277201  4.479257    Male 40-49</span></span>
<span><span class="co">#&gt; 255 317070105000317   0.01399407  2.139608    Male 50-59</span></span>
<span><span class="co">#&gt; 256 317070105000318  -0.63718519  3.038524  Female 50-59</span></span>
<span><span class="co">#&gt; 257 317070105000319 -10.38046181 34.833139  Female 25-29</span></span>
<span><span class="co">#&gt; 258 317070105000320  -7.07545181 25.984031    Male 30-39</span></span>
<span><span class="co">#&gt; 259 317070105000321  -2.49054020  4.428701    Male 20-24</span></span>
<span><span class="co">#&gt; 260 317070105000322   0.12236642  1.472273    Male 20-24</span></span>
<span><span class="co">#&gt; 261 317070105000323  -2.35604319  4.833344  Female 20-24</span></span>
<span><span class="co">#&gt; 262 317070105000324  -4.12526054  7.456818  Female 40-49</span></span>
<span><span class="co">#&gt; 263 317070105000325  -1.17784209  5.739841  Female 60-69</span></span>
<span><span class="co">#&gt; 264 317070105000326  -0.72381730  3.503868  Female 50-59</span></span>
<span><span class="co">#&gt; 265 317070105000327  -1.57529433  3.979720  Female 40-49</span></span>
<span><span class="co">#&gt; 266 317070105000328  -1.12288164  3.901462  Female 50-59</span></span>
<span><span class="co">#&gt; 267 317070105000329  -4.67508709  7.222797    Male 20-24</span></span>
<span><span class="co">#&gt; 268 317070105000330  -5.38153777  8.481056    Male 20-24</span></span>
<span><span class="co">#&gt; 269 317070105000331  -2.75902925  3.921396  Female 25-29</span></span>
<span><span class="co">#&gt; 270 317070105000332  -2.52359254  4.539937    Male 50-59</span></span>
<span><span class="co">#&gt; 271 317070105000333  -8.06454046 16.087327    Male 40-49</span></span>
<span><span class="co">#&gt; 272 317070105000334  -4.82366537  8.221776  Female 40-49</span></span>
<span><span class="co">#&gt; 273 317070105000335  -4.57115619 16.070901    Male 30-39</span></span>
<span><span class="co">#&gt; 274 317070105000336  -6.52853053 23.845661  Female 30-39</span></span>
<span><span class="co">#&gt; 275 317070105000337  -0.78879429  2.949064    Male 60-69</span></span>
<span><span class="co">#&gt; 276 317070105000338  -5.98369692 17.759237  Female 25-29</span></span>
<span><span class="co">#&gt; 277 317070105000339  -7.82263327 14.399701  Female 40-49</span></span>
<span><span class="co">#&gt; 278 317070105000340  -3.47486827  5.862351    Male 60-69</span></span>
<span><span class="co">#&gt; 279 317070105000342  -3.03012118  6.102017    Male 50-59</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall</span></span>
<span><span class="co">#&gt; $overall$rmse</span></span>
<span><span class="co">#&gt; [1] 11.33309</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall$mean_bias</span></span>
<span><span class="co">#&gt; [1] -4.720941</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall$total_deviance</span></span>
<span><span class="co">#&gt; [1] 50734.63</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="interpretation-3">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-3"></a>
</h3>
<ul>
<li>
<strong>Raw residuals</strong>: Scale depends on tract population. A
residual of 10 means different things in a tract with 50 people vs
5,000. Use Pearson or deviance for fair comparison.</li>
<li>
<strong>Pearson residuals</strong>: Standardized — values around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>±</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\pm 2</annotation></semantics></math>
are typical. Values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">&gt; 3</annotation></semantics></math>
are outliers under the Poisson assumption.</li>
<li>
<strong>Bracket comparison</strong>: If one bracket consistently has
larger residuals, the model may have trouble with that demographic group
— check whether the census data for that bracket is reliable.</li>
<li>
<strong>Scatter plot</strong>: Points should cluster tightly around
the 45-degree line. Systematic departures indicate bias.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="weight-structure">5. Weight Structure<a class="anchor" aria-label="anchor" href="#weight-structure"></a>
</h2>
<div class="section level3">
<h3 id="intuition-4">Intuition<a class="anchor" aria-label="anchor" href="#intuition-4"></a>
</h3>
<p>The weight matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
(dimensions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \times m</annotation></semantics></math>,
tracts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>
sources) is the heart of the interpolation. It determines how voters
from each station are allocated to each tract. Understanding the
structure of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
reveals:</p>
<ul>
<li>
<strong>Catchment areas</strong>: which stations serve which
tracts</li>
<li>
<strong>Concentration</strong>: does a tract depend on one station
or many?</li>
<li>
<strong>Fragility</strong>: tracts dependent on a single station are
sensitive to that station’s data</li>
</ul>
</div>
<div class="section level3">
<h3 id="formal-definition-4">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-4"></a>
</h3>
<p>Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
is column-normalized
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_i W_{ij} = 1</annotation></semantics></math>),
the row sums are NOT 1. For concentration measures, we row-normalize:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{ij} = W_{ij} / \sum_j W_{ij}</annotation></semantics></math>.</p>
<ul>
<li>
<strong>Shannon entropy</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>=</mo><mi>−</mi><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>ln</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">H_i = -\sum_j p_{ij} \ln p_{ij}</annotation></semantics></math>
</li>
<li>
<strong>Effective number of sources</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(H_i)</annotation></semantics></math>
— the equivalent number of equal-weight stations</li>
<li>
<strong>Herfindahl-Hirschman Index</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">HHI</mtext><mi>i</mi></msub><mo>=</mo><msub><mo>∑</mo><mi>j</mi></msub><msubsup><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\text{HHI}_i = \sum_j p_{ij}^2</annotation></semantics></math>
— ranges from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">1/m</annotation></semantics></math>
(perfect equality) to 1 (monopoly by one station)</li>
</ul>
</div>
<div class="section level3">
<h3 id="tabular-summary-weight_summary">Tabular summary: <code>weight_summary()</code><a class="anchor" aria-label="anchor" href="#tabular-summary-weight_summary"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/weight_summary.html">weight_summary</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                        tract_id dominant_source dominant_weight top3_weight</span></span>
<span><span class="co">#&gt; 317070105000001 317070105000001              26      0.12332540  0.12762603</span></span>
<span><span class="co">#&gt; 317070105000008 317070105000008              26      0.04936524  0.09158035</span></span>
<span><span class="co">#&gt; 317070105000009 317070105000009              14      0.02734454  0.05627433</span></span>
<span><span class="co">#&gt; 317070105000010 317070105000010              14      0.04499412  0.06566122</span></span>
<span><span class="co">#&gt; 317070105000013 317070105000013              14      0.02663732  0.06874888</span></span>
<span><span class="co">#&gt; 317070105000014 317070105000014              14      0.03383821  0.05306196</span></span>
<span><span class="co">#&gt; 317070105000015 317070105000015              10      0.04758405  0.05321897</span></span>
<span><span class="co">#&gt; 317070105000016 317070105000016              10      0.01432121  0.03074702</span></span>
<span><span class="co">#&gt; 317070105000017 317070105000017              10      0.02586139  0.05960858</span></span>
<span><span class="co">#&gt; 317070105000019 317070105000019               9      0.01163259  0.02450621</span></span>
<span><span class="co">#&gt; 317070105000021 317070105000021               9      0.01779759  0.03381609</span></span>
<span><span class="co">#&gt; 317070105000022 317070105000022              12      0.01063265  0.02620110</span></span>
<span><span class="co">#&gt; 317070105000023 317070105000023              12      0.02707778  0.06592539</span></span>
<span><span class="co">#&gt; 317070105000024 317070105000024              15      0.01728353  0.04931914</span></span>
<span><span class="co">#&gt; 317070105000025 317070105000025               9      0.05604796  0.06651539</span></span>
<span><span class="co">#&gt;                   entropy effective_n_sources herfindahl</span></span>
<span><span class="co">#&gt; 317070105000001 0.2588357            1.295421 0.91311103</span></span>
<span><span class="co">#&gt; 317070105000008 2.7259793           15.271361 0.12433633</span></span>
<span><span class="co">#&gt; 317070105000009 3.2015688           24.571048 0.05991134</span></span>
<span><span class="co">#&gt; 317070105000010 2.4463974           11.546674 0.19727550</span></span>
<span><span class="co">#&gt; 317070105000013 3.0079064           20.244971 0.07363158</span></span>
<span><span class="co">#&gt; 317070105000014 2.9461482           19.032502 0.09822271</span></span>
<span><span class="co">#&gt; 317070105000015 1.2610502            3.529126 0.57872449</span></span>
<span><span class="co">#&gt; 317070105000016 3.1924598           24.348245 0.05897037</span></span>
<span><span class="co">#&gt; 317070105000017 3.2993687           27.095529 0.05022195</span></span>
<span><span class="co">#&gt; 317070105000019 3.3866854           29.567785 0.04226690</span></span>
<span><span class="co">#&gt; 317070105000021 3.3794205           29.353755 0.04259577</span></span>
<span><span class="co">#&gt; 317070105000022 3.2477526           25.732443 0.05030593</span></span>
<span><span class="co">#&gt; 317070105000023 2.9090090           18.338616 0.07530382</span></span>
<span><span class="co">#&gt; 317070105000024 3.0605082           21.338398 0.06206085</span></span>
<span><span class="co">#&gt; 317070105000025 1.9709899            7.177778 0.33450311</span></span>
<span><span class="co">#&gt;                 mean_travel_time_weighted</span></span>
<span><span class="co">#&gt; 317070105000001                 0.1695345</span></span>
<span><span class="co">#&gt; 317070105000008                 2.6686783</span></span>
<span><span class="co">#&gt; 317070105000009                 4.1091487</span></span>
<span><span class="co">#&gt; 317070105000010                 1.5647360</span></span>
<span><span class="co">#&gt; 317070105000013                 2.8161189</span></span>
<span><span class="co">#&gt; 317070105000014                 2.4147949</span></span>
<span><span class="co">#&gt; 317070105000015                 0.4490260</span></span>
<span><span class="co">#&gt; 317070105000016                 2.3227200</span></span>
<span><span class="co">#&gt; 317070105000017                 5.8311386</span></span>
<span><span class="co">#&gt; 317070105000019                 4.1377839</span></span>
<span><span class="co">#&gt; 317070105000021                 6.1142955</span></span>
<span><span class="co">#&gt; 317070105000022                 3.2461322</span></span>
<span><span class="co">#&gt; 317070105000023                 3.3840604</span></span>
<span><span class="co">#&gt; 317070105000024                 3.6533201</span></span>
<span><span class="co">#&gt; 317070105000025                 1.1208944</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ... (279 rows total)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="entropy-map-plot_weightstype-entropy">Entropy map: <code>plot_weights(type = "entropy")</code><a class="anchor" aria-label="anchor" href="#entropy-map-plot_weightstype-entropy"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"entropy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-entropy.png" alt="" width="100%"></p>
<p>Large city comparison:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"entropy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-bh-entropy.png" alt="" width="100%"></p>
<p>Interactive version (click tracts to see weight summary stats):</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"entropy"</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="figures/diag-s5-ent-bh-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
</div>
<div class="section level3">
<h3 id="dominant-station-map-plot_weightstype-dominant">Dominant station map:
<code>plot_weights(type = "dominant")</code><a class="anchor" aria-label="anchor" href="#dominant-station-map-plot_weightstype-dominant"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"dominant"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-dominant.png" alt="" width="100%"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"dominant"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-nit-dominant.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="catchment-mode-plot_weightstype-catchment">Catchment mode: <code>plot_weights(type = "catchment")</code><a class="anchor" aria-label="anchor" href="#catchment-mode-plot_weightstype-catchment"></a>
</h3>
<p>Auto-selects the tract with highest effective number of sources:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"catchment"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-catchment-auto.png" alt="" width="100%"></p>
<p>Filtered view with <code>top_k</code> and <code>threshold</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"catchment"</span>, tract <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             top_k <span class="op">=</span> <span class="fl">3</span>, threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-wt-vga-catchment-filt.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="connections-plot_connections">Connections: <code>plot_connections()</code><a class="anchor" aria-label="anchor" href="#connections-plot_connections"></a>
</h3>
<p>Overview — one spoke per tract to its dominant station:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-conn-vga-overview.png" alt="" width="100%"></p>
<p>Large city:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_bh</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-conn-bh-overview.png" alt="" width="100%"></p>
<p>Interactive version for BH (click tracts and stations for detailed
weight tables):</p>
<iframe src="figures/diag-s5-conn-bh-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
<p>Detail for a specific tract:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_vga</span>, tract <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s5-conn-vga-detail1.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interactive-exploration">Interactive exploration<a class="anchor" aria-label="anchor" href="#interactive-exploration"></a>
</h3>
<p>All weight diagnostics support <code>interactive = TRUE</code>, which
produces leaflet/mapview maps with rich click popups. This is the
recommended way to explore the weight structure for individual tracts
and stations.</p>
<p><strong>Interactive connections</strong> — click any tract to see its
top-5 connected stations (with weights, travel times, and cumulative
weight). Click any station to see which tracts it serves:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_connections.html">plot_connections</a></span><span class="op">(</span><span class="va">result_vga</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="figures/diag-s5-conn-vga-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
<p><strong>Interactive dominant station map</strong> — click any tract
to see weight summary statistics (effective sources, HHI, dominant
weight):</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_weights.html">plot_weights</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"dominant"</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="figures/diag-s5-dom-vga-interactive.html" width="100%" height="600px" style="border: none;">
</iframe>
</div>
<div class="section level3">
<h3 id="interpretation-4">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-4"></a>
</h3>
<ul>
<li>
<strong>Effective number of sources</strong>: This is the
exponential of Shannon entropy on the row-normalized weights. A value of
1 means the tract depends on a single station; a value of 10 means the
weights are equivalent to 10 equal-weight stations. High values (e.g.,
&gt; 50) can indicate that distant stations are receiving non-negligible
weight. The default <code>max_trip_duration = 180</code> (3 hours
walking) and <code>fill_missing = NA</code> policy (see Section 6)
address this by assigning exactly zero weight to unreachable and distant
pairs.</li>
<li>
<strong>Low entropy tracts</strong> (effective N close to 1): The
interpolation for this tract depends almost entirely on a single
station. If that station’s data is atypical, the interpolated values may
be unreliable.</li>
<li>
<strong>Dominant station map</strong>: Produces a Voronoi-like
partition. If catchment areas don’t match geographic intuition, check
the travel time matrix.</li>
<li>
<strong>Connections</strong>: The spoke pattern should make
geographic sense — tracts should connect to nearby stations.
Long-distance connections suggest routing issues.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="travel-time-data-quality-plot_travel_times">6. Travel Time Data Quality: <code>plot_travel_times()</code><a class="anchor" aria-label="anchor" href="#travel-time-data-quality-plot_travel_times"></a>
</h2>
<div class="section level3">
<h3 id="intuition-5">Intuition<a class="anchor" aria-label="anchor" href="#intuition-5"></a>
</h3>
<p>The travel time matrix is the input that drives everything:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
optimization, weight computation, and ultimately the spatial allocation
of voters. Poor travel time data (unreachable pairs, disconnected road
networks) directly degrades interpolation quality.</p>
</div>
<div class="section level3">
<h3 id="applied-examples-1">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-1"></a>
</h3>
<p><strong>Histogram</strong> — distribution of all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \times m</annotation></semantics></math>
travel times:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-vga-hist.png" alt="" width="100%"></p>
<p>Large city:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-bh-hist.png" alt="" width="100%"></p>
<p><strong>Heatmap</strong> — rows = tracts (ordered by latitude),
columns = stations. Block-diagonal structure reveals spatial
locality:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-vga-heatmap.png" alt="" width="100%"></p>
<p><strong>Map</strong> — station points colored by travel time for a
specific tract:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_travel_times.html">plot_travel_times</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"map"</span>, tract <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s6-tt-vga-map.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="unreachable-pairs-and-the-fill_missing-parameter">Unreachable pairs and the <code>fill_missing</code> parameter<a class="anchor" aria-label="anchor" href="#unreachable-pairs-and-the-fill_missing-parameter"></a>
</h3>
<p>When the routing engine cannot find a path between a tract and a
station within <code>max_trip_duration</code> minutes, the travel time
is <code>NA</code>. By default,
<code>routing_control(fill_missing = NULL)</code> resolves to
<code>NA</code>, which means these unreachable pairs remain as
<code>NA</code> in the travel time matrix and receive <strong>exactly
zero weight</strong> — they are completely excluded from both the
optimization and the interpolation.</p>
<p>The default <code>max_trip_duration = 180</code> (3 hours walking)
intentionally cuts distant links. Any tract–station pair beyond this
threshold is treated as unreachable. This prevents distant stations from
creating a uniform background weight that inflates the effective number
of sources.</p>
<p>If a tract has no reachable stations at all (entire row is
<code>NA</code>), it is excluded from optimization and receives
<code>NA</code> interpolated values.</p>
<p>To assign a finite fill value instead (e.g., to ensure every pair has
a travel time):</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/routing_control.html">routing_control</a></span><span class="op">(</span>fill_missing <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>  <span class="co"># fill unreachable with 300 min</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpretation-5">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-5"></a>
</h3>
<ul>
<li>
<strong>NA pairs in histogram</strong>: The subtitle reports how
many pairs are unreachable (NA). A large number suggests poor OSM
network coverage or a restrictive <code>max_trip_duration</code>.</li>
<li>
<strong>Grey cells in heatmap</strong>: Represent <code>NA</code>
(unreachable) pairs. These receive zero weight.</li>
<li>
<strong>Bimodal distribution</strong>: May indicate disconnected
graph components (e.g., separated by a river without bridge in the OSM
network).</li>
<li>
<strong>Block-diagonal heatmap</strong>: Expected — nearby tracts
have similar travel times to the same stations. Absence of block
structure suggests the travel times lack spatial coherence.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="spatial-autocorrelation-plot_residual_autocorrelation-plot_moran">7. Spatial Autocorrelation:
<code>plot_residual_autocorrelation()</code> +
<code>plot_moran()</code><a class="anchor" aria-label="anchor" href="#spatial-autocorrelation-plot_residual_autocorrelation-plot_moran"></a>
</h2>
<div class="section level3">
<h3 id="intuition-6">Intuition<a class="anchor" aria-label="anchor" href="#intuition-6"></a>
</h3>
<p><strong>Residual autocorrelation</strong>: If residuals are spatially
clustered (nearby tracts have similar residuals), the model is missing
spatial structure — a misspecification signal.</p>
<p><strong>Moran’s I on interpolated variables</strong>: If the
interpolated vote shares show expected spatial concentration (e.g., PT
strongholds in low-income areas), the method is preserving realistic
political geography.</p>
</div>
<div class="section level3">
<h3 id="formal-definition-5">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-5"></a>
</h3>
<p><strong>Global Moran’s I</strong>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>=</mo><mfrac><mi>n</mi><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo>⋅</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">I = \frac{n}{\sum_{i,j} w_{ij}} \cdot \frac{\sum_{i,j} w_{ij}(x_i - \bar{x})(x_j - \bar{x})}{\sum_i (x_i - \bar{x})^2}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math>
are spatial weights (queen contiguity). Range:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>−</mi><mn>1</mn><mo>,</mo><mi>+</mi><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[-1, +1]</annotation></semantics></math>.
Positive = clustering,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\approx 0</annotation></semantics></math>
= random, negative = dispersion.</p>
<p><strong>LISA (Local Moran’s I)</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>s</mi><mn>2</mn></msup></mfrac><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I_i = \frac{(x_i - \bar{x})}{s^2} \sum_j w_{ij}(x_j - \bar{x})</annotation></semantics></math>.
Classification: HH (high-high cluster), LL (low-low), HL (high
surrounded by low), LH (low surrounded by high).</p>
</div>
<div class="section level3">
<h3 id="applied-examples-residual-autocorrelation">Applied examples: Residual autocorrelation<a class="anchor" aria-label="anchor" href="#applied-examples-residual-autocorrelation"></a>
</h3>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residual_autocorrelation.html">plot_residual_autocorrelation</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-moran-resid-vga.png" alt="" width="100%"></p>
<p>Pearson residuals:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residual_autocorrelation.html">plot_residual_autocorrelation</a></span><span class="op">(</span><span class="va">result_vga</span>, residual_type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-moran-resid-vga-pear.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="applied-examples-lisa-cluster-maps">Applied examples: LISA cluster maps<a class="anchor" aria-label="anchor" href="#applied-examples-lisa-cluster-maps"></a>
</h3>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"lisa"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-lisa-vga-lula.png" alt="" width="100%"></p>
<p>Moran scatterplot:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"moran"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-moran-vga-lula.png" alt="" width="100%"></p>
<p>Large city:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_bh</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"lisa"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-lisa-bh-lula.png" alt="" width="100%"></p>
<p>By party:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_moran.html">plot_moran</a></span><span class="op">(</span><span class="va">result_nit</span>, variable <span class="op">=</span> <span class="st">"PT"</span>, type <span class="op">=</span> <span class="st">"lisa"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s7-lisa-nit-pt.png" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interpretation-6">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-6"></a>
</h3>
<ul>
<li>
<strong>Significant Moran’s I on residuals</strong> (p &lt; 0.05):
The model has spatially structured error. Consider whether the travel
time data has systematic problems in certain areas.</li>
<li>
<strong>HH clusters of Lula votes</strong>: Expected in low-income
neighborhoods (PT strongholds). Their presence validates that the
interpolation preserves known political geography.</li>
<li>
<strong>HL/LH clusters</strong>: Spatial outliers — tracts with high
vote share surrounded by low (or vice versa). May indicate local effects
or data irregularities.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="baseline-comparisons-compare_baselines-leave_one_out">8. Baseline Comparisons: <code>compare_baselines()</code> +
<code>leave_one_out()</code><a class="anchor" aria-label="anchor" href="#baseline-comparisons-compare_baselines-leave_one_out"></a>
</h2>
<div class="section level3">
<h3 id="intuition-7">Intuition<a class="anchor" aria-label="anchor" href="#intuition-7"></a>
</h3>
<p>Is the optimized IDW actually better than simpler alternatives? And
how robust is the interpolation to removing individual stations?</p>
</div>
<div class="section level3">
<h3 id="formal-definition-6">Formal definition<a class="anchor" aria-label="anchor" href="#formal-definition-6"></a>
</h3>
<p><strong>Baselines</strong>: - <strong>Nearest</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><msup><mi>j</mi><mo>*</mo></msup></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">W_{ij^*} = 1</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>j</mi><mo>*</mo></msup><mo>=</mo><mo>arg</mo><msub><mo>min</mo><mi>j</mi></msub><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">j^* = \arg\min_j t_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">W_{ij} = 0</annotation></semantics></math>
otherwise (binary assignment to closest station) -
<strong>Uniform</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn><mi>/</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">W_{ij} = 1/m</annotation></semantics></math>
(equal weight to all stations, column-normalized) -
<strong>Areal</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
based on spatial intersection areas between tract and station Voronoi
cells</p>
<p><strong>Leave-one-out</strong>: Remove station
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
predict its demographics using remaining
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m-1</annotation></semantics></math>
stations with the full-model alpha values. Compare predicted vs actual.
This is the only form of out-of-sample validation possible (there is no
tract-level ground truth).</p>
</div>
<div class="section level3">
<h3 id="applied-examples-compare_baselines">Applied examples: <code>compare_baselines()</code><a class="anchor" aria-label="anchor" href="#applied-examples-compare_baselines"></a>
</h3>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_baselines.html">compare_baselines</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Baseline comparison</span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt;   Optimized IDW          RMSE=11.33  Deviance=50734.63</span></span>
<span><span class="co">#&gt;   Nearest station        RMSE=36.76  Deviance=189886.50  (IDW 69% better)</span></span>
<span><span class="co">#&gt;   Uniform weights        RMSE=15.81  Deviance=34553.92  (IDW 28% better)</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_baselines.html">compare_baselines</a></span><span class="op">(</span><span class="va">result_bh</span>, methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nearest"</span>, <span class="st">"uniform"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Baseline comparison</span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt;   Optimized IDW          RMSE=7.26  Deviance=147706.41</span></span>
<span><span class="co">#&gt;   Nearest station        RMSE=27.00  Deviance=1393922.64  (IDW 73% better)</span></span>
<span><span class="co">#&gt;   Uniform weights        RMSE=12.96  Deviance=477898.82  (IDW 44% better)</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="applied-examples-leave_one_out">Applied examples: <code>leave_one_out()</code><a class="anchor" aria-label="anchor" href="#applied-examples-leave_one_out"></a>
</h3>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/leave_one_out.html">leave_one_out</a></span><span class="op">(</span><span class="va">result_igr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   LOO: station 1 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 2 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 3 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 4 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 5 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 6 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 7 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 8 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 9 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 10 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 11 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 12 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 13 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 14 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 15 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 16 / 17</span></span>
<span><span class="co">#&gt;   LOO: station 17 / 17</span></span>
<span><span class="co">#&gt; Leave-one-out RMSE: 8.2586 (mean), 7.9144 (median)</span></span>
<span><span class="co">#&gt; Full model RMSE:    7.1584</span></span>
<span><span class="co">#&gt; LOO degradation:    15.4%</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/leave_one_out.html">leave_one_out</a></span><span class="op">(</span><span class="va">result_vga</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   LOO: station 1 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 2 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 3 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 4 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 5 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 6 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 7 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 8 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 9 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 10 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 11 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 12 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 13 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 14 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 15 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 16 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 17 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 18 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 19 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 20 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 21 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 22 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 23 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 24 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 25 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 26 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 27 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 28 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 29 / 30</span></span>
<span><span class="co">#&gt;   LOO: station 30 / 30</span></span>
<span><span class="co">#&gt; Leave-one-out RMSE: 12.6777 (mean), 12.6220 (median)</span></span>
<span><span class="co">#&gt; Full model RMSE:    11.3331</span></span>
<span><span class="co">#&gt; LOO degradation:    11.9%</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="interpretation-7">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-7"></a>
</h3>
<ul>
<li>
<strong>Positive improvement %</strong>: The optimized IDW has lower
RMSE/deviance than the baseline. The optimization adds value.</li>
<li>
<strong>Negative improvement %</strong>: This should not happen. If
it does, the optimization may have overfitted or the data has
issues.</li>
<li>
<strong>LOO degradation</strong>: LOO RMSE should be comparable to
full-model RMSE. If LOO RMSE is much larger, the model may be
overfitting to specific station configurations.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="ecological-validation">9. Ecological Validation<a class="anchor" aria-label="anchor" href="#ecological-validation"></a>
</h2>
<div class="section level3">
<h3 id="a--implied-turnout-rates-plot_turnout_rates">9a. Implied Turnout Rates: <code>plot_turnout_rates()</code><a class="anchor" aria-label="anchor" href="#a--implied-turnout-rates-plot_turnout_rates"></a>
</h3>
<div class="section level4">
<h4 id="intuition-8">Intuition<a class="anchor" aria-label="anchor" href="#intuition-8"></a>
</h4>
<p>For each tract and demographic bracket, the implied turnout rate
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">rate</mtext><mrow><mi>i</mi><mo>,</mo><mi>b</mi></mrow></msub><mo>=</mo><mfrac><msub><mtext mathvariant="normal">fitted voters</mtext><mrow><mi>i</mi><mo>,</mo><mi>b</mi></mrow></msub><msub><mtext mathvariant="normal">census population</mtext><mrow><mi>i</mi><mo>,</mo><mi>b</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">\text{rate}_{i,b} = \frac{\text{fitted voters}_{i,b}}{\text{census population}_{i,b}}</annotation></semantics></math></p>
<p>In Brazil, voting is <strong>compulsory</strong> for ages 18–69, so
expected turnout is ~75–85%. For 16–17 and 70+, voting is optional and
rates should be lower. Rates exceeding 100% indicate tracts where the
model allocates more voters than residents — signaling boundary effects
or registration mismatches.</p>
</div>
<div class="section level4">
<h4 id="applied-examples-2">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-2"></a>
</h4>
<p>Bracket boxplot:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-vga-bracket.png" alt="" width="100%"></p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_nit</span>, type <span class="op">=</span> <span class="st">"bracket"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-nit-bracket.png" alt="" width="100%"></p>
<p>Spatial pattern:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_bh</span>, type <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-bh-map.png" alt="" width="100%"></p>
<p>Faceted histogram:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_turnout_rates.html">plot_turnout_rates</a></span><span class="op">(</span><span class="va">result_vga</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-turnout-vga-hist.png" alt="" width="100%"></p>
</div>
<div class="section level4">
<h4 id="interpretation-8">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-8"></a>
</h4>
<ul>
<li>
<strong>Compulsory brackets clustering around 80%</strong>: Expected
for ages 18–69.</li>
<li>
<strong>Optional brackets lower</strong>: 16–17 and 70+ should show
lower turnout.</li>
<li>
<strong>Rates &gt; 100%</strong>: Voters registered in one
municipality who may actually reside in another (commuters, students).
These boundary effects are a known limitation of the model.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="b--income-vote-correlation-plot_income">9b. Income-Vote Correlation: <code>plot_income()</code><a class="anchor" aria-label="anchor" href="#b--income-vote-correlation-plot_income"></a>
</h3>
<div class="section level4">
<h4 id="intuition-9">Intuition<a class="anchor" aria-label="anchor" href="#intuition-9"></a>
</h4>
<p>The negative correlation between PT vote share and income is one of
the best-documented patterns in Brazilian political science (the
“PT-income gradient”). If the interpolation preserves this gradient, it
builds confidence that the spatial allocation of votes is realistic. If
it destroys it, something is wrong.</p>
<p>Income data comes from censobr (Census Bureau microdata), which
provides mean household head income by tract. No deflation is applied —
within a single census year, the correlation is scale-invariant.</p>
</div>
<div class="section level4">
<h4 id="applied-examples-3">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-3"></a>
</h4>
<p>Lula (PT) vs income — expect negative correlation:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-vga-lula.png" alt="" width="100%"></p>
<p>Bolsonaro (PL) vs income — expect positive correlation:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_vga</span>, variable <span class="op">=</span> <span class="fl">22</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-vga-bolso.png" alt="" width="100%"></p>
<p>Larger city:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_bh</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-bh-lula.png" alt="" width="100%"></p>
<p>Side-by-side maps:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_income.html">plot_income</a></span><span class="op">(</span><span class="va">result_nit</span>, variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-income-nit-map.png" alt="" width="100%"></p>
</div>
</div>
<div class="section level3">
<h3 id="c--cross-round-consistency-plot_ecological">9c. Cross-Round Consistency: <code>plot_ecological()</code><a class="anchor" aria-label="anchor" href="#c--cross-round-consistency-plot_ecological"></a>
</h3>
<div class="section level4">
<h4 id="intuition-10">Intuition<a class="anchor" aria-label="anchor" href="#intuition-10"></a>
</h4>
<p>Political geography is sticky. Neighborhoods that vote strongly for a
candidate in round 1 should vote even more strongly in round 2 (where
only 2 candidates remain). A high correlation between turno 1 and turno
2 tract-level vote shares validates that the interpolation preserves
spatial patterns.</p>
</div>
<div class="section level4">
<h4 id="applied-examples-4">Applied examples<a class="anchor" aria-label="anchor" href="#applied-examples-4"></a>
</h4>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ecological.html">plot_ecological</a></span><span class="op">(</span><span class="va">result_vga</span>, <span class="va">result_vga2</span>,</span>
<span>                variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-ecol-vga-scatter.png" alt="" width="100%"></p>
<p>Side-by-side maps:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ecological.html">plot_ecological</a></span><span class="op">(</span><span class="va">result_vga</span>, <span class="va">result_vga2</span>,</span>
<span>                variable <span class="op">=</span> <span class="st">"Lula"</span>, type <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/diag-s9-ecol-vga-map.png" alt="" width="100%"></p>
</div>
<div class="section level4">
<h4 id="interpretation-9">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation-9"></a>
</h4>
<ul>
<li>
<strong>Strong positive correlation</strong> between rounds: The
spatial patterns are consistent, as expected. The method is recovering
stable partisan geography.</li>
<li>
<strong>Weak or no correlation</strong>: The interpolation may be
injecting noise rather than recovering signal. Investigate whether the
travel time data or optimization is causing problems.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="quick-reference">10. Quick Reference<a class="anchor" aria-label="anchor" href="#quick-reference"></a>
</h2>
<table class="table">
<colgroup>
<col width="16%">
<col width="34%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">Function</th>
<th align="left">Question it answers</th>
<th align="left">Key arguments</th>
<th align="left">When to worry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="../reference/diagnostics.html">diagnostics()</a></code></td>
<td align="left">Is anything obviously wrong?</td>
<td align="left"><code>verbose</code></td>
<td align="left">Any FAIL or multiple WARNs</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_convergence.html">plot_convergence()</a></code></td>
<td align="left">Did the optimizer converge?</td>
<td align="left">
<code>which</code>, <code>log_y</code>
</td>
<td align="left">Oscillating loss, non-shrinking gradient</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_alpha.html">plot_alpha()</a></code></td>
<td align="left">How does distance decay vary?</td>
<td align="left">
<code>type</code>, <code>summary_fn</code>,
<code>brackets</code>
</td>
<td align="left">Many tracts with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 15</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_residuals.html">plot_residuals()</a></code></td>
<td align="left">How well are demographics reproduced?</td>
<td align="left">
<code>type</code>, <code>residual_type</code>,
<code>summary_fn</code>
</td>
<td align="left">Large systematic bias, Pearson &gt; 3</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/residual_summary.html">residual_summary()</a></code></td>
<td align="left">Which brackets/tracts fit worst?</td>
<td align="left"><code>type</code></td>
<td align="left">One bracket much worse than others</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/weight_summary.html">weight_summary()</a></code></td>
<td align="left">How concentrated are the weights?</td>
<td align="left">—</td>
<td align="left">Many tracts with effective N = 1</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_weights.html">plot_weights()</a></code></td>
<td align="left">Where are catchment areas?</td>
<td align="left">
<code>type</code>, <code>tract</code>,
<code>top_k</code>
</td>
<td align="left">Catchments that defy geography</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_connections.html">plot_connections()</a></code></td>
<td align="left">Which stations serve which tracts?</td>
<td align="left">
<code>tract</code>, <code>top_k</code>,
<code>threshold</code>
</td>
<td align="left">Long-distance connections</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_travel_times.html">plot_travel_times()</a></code></td>
<td align="left">Is the travel time matrix clean?</td>
<td align="left">
<code>type</code>, <code>tract</code>
</td>
<td align="left">Large spike at max value</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_residual_autocorrelation.html">plot_residual_autocorrelation()</a></code></td>
<td align="left">Are residuals spatially clustered?</td>
<td align="left">
<code>residual_type</code>,
<code>summary_fn</code>
</td>
<td align="left">Significant Moran’s I (p &lt; 0.05)</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_moran.html">plot_moran()</a></code></td>
<td align="left">Is vote geography realistic?</td>
<td align="left">
<code>variable</code>, <code>type</code>
</td>
<td align="left">No spatial clustering</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/compare_baselines.html">compare_baselines()</a></code></td>
<td align="left">Is IDW better than naive methods?</td>
<td align="left"><code>methods</code></td>
<td align="left">Negative improvement</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/leave_one_out.html">leave_one_out()</a></code></td>
<td align="left">Is the model overfitting?</td>
<td align="left"><code>max_stations</code></td>
<td align="left">LOO RMSE &gt;&gt; full RMSE</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_turnout_rates.html">plot_turnout_rates()</a></code></td>
<td align="left">Are implied turnout rates plausible?</td>
<td align="left"><code>type</code></td>
<td align="left">Many tracts &gt; 100%</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/plot_income.html">plot_income()</a></code></td>
<td align="left">Does the PT-income gradient hold?</td>
<td align="left">
<code>variable</code>, <code>type</code>
</td>
<td align="left">Wrong sign on correlation</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/plot_ecological.html">plot_ecological()</a></code></td>
<td align="left">Are spatial patterns consistent?</td>
<td align="left">
<code>variable</code>, <code>type</code>
</td>
<td align="left">Weak cross-round correlation</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rogerio Barbosa, Lucas Gelape.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
