<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interpolating Brazilian Electoral Data • interpElections</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interpolating Brazilian Electoral Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">interpElections</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/understanding-the-model.html">Understanding the Model</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Use Cases</h6></li>
    <li><a class="dropdown-item" href="../articles/brazilian-elections.html">Brazilian Elections</a></li>
    <li><a class="dropdown-item" href="../articles/custom-data.html">Custom Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/working-with-results.html">Working with Results</a></li>
    <li><a class="dropdown-item" href="../articles/performance-and-configuration.html">Performance &amp; Configuration</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/interpElections/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Interpolating Brazilian Electoral Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antrologos/interpElections/blob/master/vignettes/brazilian-elections.Rmd" class="external-link"><code>vignettes/brazilian-elections.Rmd</code></a></small>
      <div class="d-none name"><code>brazilian-elections.Rmd</code></div>
    </div>

    
    
<p>This vignette walks through the primary use case of
<code>interpElections</code>: disaggregating Brazilian electoral data
from polling locations into census tracts. The package automates census
data download, electoral data retrieval, travel-time computation, and
IDW interpolation – all in a single function call.</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>The Brazilian workflow requires several packages for census data,
shapefiles, and travel-time routing. Install them once:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sf"</span>, <span class="st">"geobr"</span>, <span class="st">"censobr"</span>, <span class="st">"dplyr"</span>, <span class="st">"tidyr"</span>,</span>
<span>                    <span class="st">"data.table"</span>, <span class="st">"stringr"</span>, <span class="st">"arrow"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Travel-time computation requires Java 21+ and the r5r package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"r5r"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install Java 21 (if not already installed)</span></span>
<span><span class="fu"><a href="../reference/setup_java.html">setup_java</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify Java + r5r are properly configured</span></span>
<span><span class="fu"><a href="../reference/check_r5r.html">check_r5r</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For GPU-accelerated optimization (optional, for large
municipalities):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setup_torch.html">setup_torch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/check_torch.html">check_torch</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="one-call-workflow">One-Call Workflow<a class="anchor" aria-label="anchor" href="#one-call-workflow"></a>
</h2>
<p>The simplest way to use the package is
<code><a href="../reference/interpolate_election_br.html">interpolate_election_br()</a></code>, which handles everything
automatically. You only need an IBGE municipality code and an election
year:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/interpElections/">interpElections</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_election_br.html">interpolate_election_br</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">1400100</span>,  <span class="co"># Boa Vista, RR</span></span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this vignette, we load a pre-computed result instead of running
the full pipeline (which requires network access and Java):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/interpElections/">interpElections</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; interpElections: some optional dependencies are missing:</span></span>
<span><span class="co">#&gt; - No OSM clipping tool found (osmium/osmconvert)</span></span>
<span><span class="co">#&gt;   Install with: interpElections::setup_osmium()</span></span>
<span><span class="co">#&gt; These are needed for the full interpolation pipeline.</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/example_br_result.rds"</span>, package <span class="op">=</span> <span class="st">"interpElections"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result is an <code>interpElections_result</code> object with a
rich <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; interpElections result summary</span></span>
<span><span class="co">#&gt; -------------------------------------------------- </span></span>
<span><span class="co">#&gt; Municipality: 1400100 (election 2020, census 2022)</span></span>
<span><span class="co">#&gt; Zones: 506 | Sources: 149 | Variables: 11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration brackets:</span></span>
<span><span class="co">#&gt;   Zones:   pop_15_24, pop_25_29, pop_30_39, pop_40_49, pop_50_59, pop_60_69</span></span>
<span><span class="co">#&gt;   Sources: votantes_15_24, votantes_25_29, votantes_30_39, votantes_40_49, votantes_50_59, votantes_60_69</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization: cpu_lbfgsb | Objective: 5041410.9862 | Convergence: 0</span></span>
<span><span class="co">#&gt;   Alpha: min=0.991, Q1=1.293, median=1.460, Q3=1.645, max=9.541</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interpolated variables:</span></span>
<span><span class="co">#&gt;   QT_COMPARECIMENTO              total=    165428  mean=   326.9  [0.0, 1073.7]</span></span>
<span><span class="co">#&gt;   CAND_18999                     total=      1606  mean=     3.2  [0.0, 11.5]</span></span>
<span><span class="co">#&gt;   CAND_90123                     total=       135  mean=     0.3  [0.0, 1.7]</span></span>
<span><span class="co">#&gt;   CAND_12012                     total=        64  mean=     0.1  [0.0, 0.6]</span></span>
<span><span class="co">#&gt;   CAND_25000                     total=       616  mean=     1.2  [0.0, 3.8]</span></span>
<span><span class="co">#&gt;   CAND_22444                     total=       442  mean=     0.9  [0.0, 3.2]</span></span>
<span><span class="co">#&gt;   CAND_28029                     total=        66  mean=     0.1  [0.0, 1.0]</span></span>
<span><span class="co">#&gt;   CAND_14100                     total=       337  mean=     0.7  [0.0, 2.6]</span></span>
<span><span class="co">#&gt;   CAND_77234                     total=       394  mean=     0.8  [0.0, 3.0]</span></span>
<span><span class="co">#&gt;   CAND_28008                     total=       371  mean=     0.7  [0.0, 3.4]</span></span>
<span><span class="co">#&gt;   CAND_22123                     total=       190  mean=     0.4  [0.0, 1.3]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object size: 0.8 MB (lightweight)</span></span></code></pre></div>
<p>Plot the first interpolated variable as a choropleth map:</p>
<p><img src="brazilian-elections_files/figure-html/plot-result-1.png" class="r-plt" alt="" width="672"></p>
<details><summary>
Show plot code
</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
</details><div class="section level3">
<h3 id="filtering-what-to-interpolate">Filtering what to interpolate<a class="anchor" aria-label="anchor" href="#filtering-what-to-interpolate"></a>
</h3>
<p>The <code>what</code> parameter controls which variables are
interpolated. The <code>candidates</code> and <code>parties</code>
parameters filter specific subsets:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only specific candidates (by ballot number or name)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_election_br.html">interpolate_election_br</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">1400100</span>, year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"candidates"</span>,</span>
<span>  candidates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Party-level vote totals</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_election_br.html">interpolate_election_br</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">1400100</span>, year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"parties"</span>,</span>
<span>  parties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PT"</span>, <span class="st">"PL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Turnout and abstention</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_election_br.html">interpolate_election_br</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">1400100</span>, year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"turnout"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Voter demographics (gender + education level)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_election_br.html">interpolate_election_br</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">1400100</span>, year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"demographics"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-municipality-crosswalk">The Municipality Crosswalk<a class="anchor" aria-label="anchor" href="#the-municipality-crosswalk"></a>
</h2>
<p>Brazilian electoral data uses TSE 5-digit codes, while census data
uses IBGE 7-digit codes. The package includes a crosswalk table mapping
all 5,710 municipalities:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">muni_crosswalk</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">muni_crosswalk</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5710    4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">muni_crosswalk</span><span class="op">)</span></span>
<span><span class="co">#&gt;   code_ibge code_tse uf            nome</span></span>
<span><span class="co">#&gt; 1   1200013    01120 AC      ACRELÂNDIA</span></span>
<span><span class="co">#&gt; 2   1200054    01570 AC    ASSIS BRASIL</span></span>
<span><span class="co">#&gt; 3   1200104    01058 AC       BRASILÉIA</span></span>
<span><span class="co">#&gt; 4   1200138    01007 AC          BUJARI</span></span>
<span><span class="co">#&gt; 5   1200179    01015 AC        CAPIXABA</span></span>
<span><span class="co">#&gt; 6   1200203    01074 AC CRUZEIRO DO SUL</span></span></code></pre></div>
<p>Search by name or state:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find Boa Vista</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">muni_crosswalk</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BOA VISTA"</span>, <span class="va">nome</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      code_ibge code_tse uf                       nome</span></span>
<span><span class="co">#&gt; 136    1300680    02976 AM         BOA VISTA DO RAMOS</span></span>
<span><span class="co">#&gt; 247    2903805    33758 BA         BOA VISTA DO TUPIM</span></span>
<span><span class="co">#&gt; 1160   2101970    07323 MA        BOA VISTA DO GURUPI</span></span>
<span><span class="co">#&gt; 2281   5100359    90042 MT             ALTO BOA VISTA</span></span>
<span><span class="co">#&gt; 2547   1507706    05533 PA SÃO SEBASTIÃO DA BOA VISTA</span></span>
<span><span class="co">#&gt; 2592   2502151    19941 PB                  BOA VISTA</span></span>
<span><span class="co">#&gt; 2930   2612604    25518 PE   SANTA MARIA DA BOA VISTA</span></span>
<span><span class="co">#&gt; 3234   4103057    79812 PR     BOA VISTA DA APARECIDA</span></span>
<span><span class="co">#&gt; 3549   4125407    78832 PR      SÃO JOSÉ DA BOA VISTA</span></span>
<span><span class="co">#&gt; 3908   1400100    03018 RR                  BOA VISTA</span></span>
<span><span class="co">#&gt; 3962   4302154    86428 RS      BOA VISTA DAS MISSÕES</span></span>
<span><span class="co">#&gt; 3963   4302204    85430 RS        BOA VISTA DO BURICÁ</span></span>
<span><span class="co">#&gt; 3964   4302220    89044 RS       BOA VISTA DO CADEADO</span></span>
<span><span class="co">#&gt; 3965   4302238    89060 RS         BOA VISTA DO INCRA</span></span>
<span><span class="co">#&gt; 3966   4302253    88161 RS           BOA VISTA DO SUL</span></span>
<span><span class="co">#&gt; 4191   4312955    87203 RS             NOVA BOA VISTA</span></span>
<span><span class="co">#&gt; 4290   4317004    88439 RS       SANTANA DA BOA VISTA</span></span>
<span><span class="co">#&gt; 4676   4217154    80780 SC    SÃO MIGUEL DA BOA VISTA</span></span>
<span><span class="co">#&gt; 5352   3549102    70831 SP      SÃO JOÃO DA BOA VISTA</span></span>
<span></span>
<span><span class="co"># All municipalities in Roraima</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">muni_crosswalk</span>, <span class="va">uf</span> <span class="op">==</span> <span class="st">"RR"</span><span class="op">)</span></span>
<span><span class="co">#&gt;      code_ibge code_tse uf               nome</span></span>
<span><span class="co">#&gt; 3906   1400050    03050 RR        ALTO ALEGRE</span></span>
<span><span class="co">#&gt; 3907   1400027    03042 RR            AMAJARI</span></span>
<span><span class="co">#&gt; 3908   1400100    03018 RR          BOA VISTA</span></span>
<span><span class="co">#&gt; 3909   1400159    03077 RR             BONFIM</span></span>
<span><span class="co">#&gt; 3910   1400175    03069 RR              CANTÁ</span></span>
<span><span class="co">#&gt; 3911   1400209    03034 RR          CARACARAÍ</span></span>
<span><span class="co">#&gt; 3912   1400233    03000 RR            CAROEBE</span></span>
<span><span class="co">#&gt; 3913   1400282    03026 RR            IRACEMA</span></span>
<span><span class="co">#&gt; 3914   1400308    03093 RR            MUCAJAÍ</span></span>
<span><span class="co">#&gt; 3915   1400407    03115 RR          NORMANDIA</span></span>
<span><span class="co">#&gt; 3916   1400456    03123 RR          PACARAIMA</span></span>
<span><span class="co">#&gt; 3917   1400472    03085 RR       RORAINÓPOLIS</span></span>
<span><span class="co">#&gt; 3918   1400506    03131 RR SÃO JOÃO DA BALIZA</span></span>
<span><span class="co">#&gt; 3919   1400605    03158 RR           SÃO LUIZ</span></span>
<span><span class="co">#&gt; 3920   1400704    03107 RR           UIRAMUTÃ</span></span></code></pre></div>
<p>When you call <code><a href="../reference/interpolate_election_br.html">interpolate_election_br()</a></code>, the TSE code
and state abbreviation are resolved automatically from the IBGE
code.</p>
</div>
<div class="section level2">
<h2 id="step-by-step-workflow">Step-by-Step Workflow<a class="anchor" aria-label="anchor" href="#step-by-step-workflow"></a>
</h2>
<p>Under the hood, <code><a href="../reference/interpolate_election_br.html">interpolate_election_br()</a></code> runs five
preparation steps before calling the core interpolation engine. You can
run each step individually for more control.</p>
<div class="section level3">
<h3 id="step-1-census-population">Step 1 – Census population<a class="anchor" aria-label="anchor" href="#step-1-census-population"></a>
</h3>
<p><code><a href="../reference/br_prepare_population.html">br_prepare_population()</a></code> downloads census population data
(via <code>censobr</code>) and groups ages into brackets that match the
TSE voter profile data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/br_prepare_population.html">br_prepare_population</a></span><span class="op">(</span>code_muni <span class="op">=</span> <span class="fl">1400100</span>, year <span class="op">=</span> <span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/example_pop_data.rds"</span>, package <span class="op">=</span> <span class="st">"interpElections"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pop_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;            code_tract code_muni pop_00_04 pop_05_09 pop_10_14 pop_15_19</span></span>
<span><span class="co">#&gt; 15351 140010005000001   1400100         6        16         9        10</span></span>
<span><span class="co">#&gt; 15352 140010005000002   1400100        20        30        24        22</span></span>
<span><span class="co">#&gt; 15353 140010005000003   1400100        22        19        23        15</span></span>
<span><span class="co">#&gt; 15354 140010005000004   1400100        20        17        15        18</span></span>
<span><span class="co">#&gt; 15355 140010005000007   1400100        21        36        24        31</span></span>
<span><span class="co">#&gt; 15356 140010005000009   1400100        23        20        17        26</span></span>
<span><span class="co">#&gt;       pop_20_24 pop_25_29 pop_30_39 pop_40_49 pop_50_59 pop_60_69 pop_70mais</span></span>
<span><span class="co">#&gt; 15351        16        14        38        25        30        14          7</span></span>
<span><span class="co">#&gt; 15352        38        41        62        54        37        38         17</span></span>
<span><span class="co">#&gt; 15353        31        23        42        30        25        19          8</span></span>
<span><span class="co">#&gt; 15354        28        27        28        31        26        11         27</span></span>
<span><span class="co">#&gt; 15355        33        36        93        71        58        42         30</span></span>
<span><span class="co">#&gt; 15356        23        30        59        58        41        39         27</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pop_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    528 obs. of  13 variables:</span></span>
<span><span class="co">#&gt;  $ code_tract: chr  "140010005000001" "140010005000002" "140010005000003" "140010005000004" ...</span></span>
<span><span class="co">#&gt;  $ code_muni : num  1400100 1400100 1400100 1400100 1400100 ...</span></span>
<span><span class="co">#&gt;  $ pop_00_04 : num  6 20 22 20 21 23 18 21 31 10 ...</span></span>
<span><span class="co">#&gt;  $ pop_05_09 : num  16 30 19 17 36 20 13 16 18 13 ...</span></span>
<span><span class="co">#&gt;  $ pop_10_14 : num  9 24 23 15 24 17 8 22 25 21 ...</span></span>
<span><span class="co">#&gt;  $ pop_15_19 : num  10 22 15 18 31 26 13 16 36 13 ...</span></span>
<span><span class="co">#&gt;  $ pop_20_24 : num  16 38 31 28 33 23 21 23 26 23 ...</span></span>
<span><span class="co">#&gt;  $ pop_25_29 : num  14 41 23 27 36 30 18 25 25 21 ...</span></span>
<span><span class="co">#&gt;  $ pop_30_39 : num  38 62 42 28 93 59 36 38 69 45 ...</span></span>
<span><span class="co">#&gt;  $ pop_40_49 : num  25 54 30 31 71 58 36 39 41 41 ...</span></span>
<span><span class="co">#&gt;  $ pop_50_59 : num  30 37 25 26 58 41 26 30 49 30 ...</span></span>
<span><span class="co">#&gt;  $ pop_60_69 : num  14 38 19 11 42 39 29 31 27 30 ...</span></span>
<span><span class="co">#&gt;  $ pop_70mais: num  7 17 8 27 30 27 28 33 31 33 ...</span></span></code></pre></div>
<p>The census year is auto-selected based on the election year:</p>
<table class="table">
<thead><tr class="header">
<th>Election years</th>
<th>Census year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>2000–2004</td>
<td>2000</td>
</tr>
<tr class="even">
<td>2008–2016</td>
<td>2010</td>
</tr>
<tr class="odd">
<td>2020+</td>
<td>2022</td>
</tr>
</tbody>
</table>
<p>You can override this with the <code>census_year</code>
parameter.</p>
</div>
<div class="section level3">
<h3 id="step-2-tract-geometries">Step 2 – Tract geometries<a class="anchor" aria-label="anchor" href="#step-2-tract-geometries"></a>
</h3>
<p><code><a href="../reference/br_prepare_tracts.html">br_prepare_tracts()</a></code> downloads census tract shapefiles
via <code>geobr</code>, joins the population data, and optionally
removes unpopulated tracts:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/br_prepare_tracts.html">br_prepare_tracts</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">1400100</span>,</span>
<span>  pop_data <span class="op">=</span> <span class="va">pop_data</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/example_tracts_sf.rds"</span>, package <span class="op">=</span> <span class="st">"interpElections"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">tracts_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 506  14</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tracts_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "code_tract" "pop_00_04"  "pop_05_09"  "pop_10_14"  "pop_15_19" </span></span>
<span><span class="co">#&gt;  [6] "pop_20_24"  "pop_25_29"  "pop_30_39"  "pop_40_49"  "pop_50_59" </span></span>
<span><span class="co">#&gt; [11] "pop_60_69"  "pop_70mais" "pop_total"  "geom"</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span></code></pre>
<p><img src="brazilian-elections_files/figure-html/plot-tracts-1.png" class="r-plt" alt="" width="672"></p>
<details><summary>
Show plot code
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">tracts_sf</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Census tracts"</span><span class="op">)</span></span></code></pre></div>
</details><p>Additional options:</p>
<ul>
<li>
<code>remove_unpopulated = TRUE</code> (default): drops tracts with
zero population.</li>
<li>
<code>clip_sf</code>: pass an <code>sf</code> polygon to clip tracts
to an urban boundary, removing parks, forests, or water bodies.</li>
</ul>
</div>
<div class="section level3">
<h3 id="step-3-electoral-data">Step 3 – Electoral data<a class="anchor" aria-label="anchor" href="#step-3-electoral-data"></a>
</h3>
<p><code><a href="../reference/br_prepare_electoral.html">br_prepare_electoral()</a></code> downloads TSE voting data, merges
geocoded polling station coordinates, and aggregates to the
polling-location level:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">electoral_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/br_prepare_electoral.html">br_prepare_electoral</a></span><span class="op">(</span></span>
<span>  code_muni_ibge <span class="op">=</span> <span class="st">"1400100"</span>,</span>
<span>  code_muni_tse <span class="op">=</span> <span class="st">"03018"</span>,</span>
<span>  uf <span class="op">=</span> <span class="st">"RR"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">electoral_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/example_electoral_data.rds"</span>, package <span class="op">=</span> <span class="st">"interpElections"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">electoral_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;      id   lat  long votantes_18_20 votantes_21_24 votantes_25_29 votantes_30_34</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  2.76 -<span style="color: #BB0000;">60.7</span>            125            180            212            239</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2  2.76 -<span style="color: #BB0000;">60.7</span>             23             90            126            113</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3  2.76 -<span style="color: #BB0000;">60.7</span>              9             69             17             15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4  2.76 -<span style="color: #BB0000;">60.7</span>            192            153             86            110</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5  2.76 -<span style="color: #BB0000;">60.7</span>             18             26             30             23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6  2.76 -<span style="color: #BB0000;">60.7</span>              8             76             93             84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: votantes_35_39 &lt;int&gt;</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">electoral_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id"                "lat"               "long"             </span></span>
<span><span class="co">#&gt;  [4] "votantes_18_20"    "votantes_21_24"    "votantes_25_29"   </span></span>
<span><span class="co">#&gt;  [7] "votantes_30_34"    "votantes_35_39"    "votantes_40_44"   </span></span>
<span><span class="co">#&gt; [10] "votantes_45_49"    "votantes_50_54"    "votantes_55_59"   </span></span>
<span><span class="co">#&gt; [13] "votantes_60_64"    "votantes_65_69"    "QT_COMPARECIMENTO"</span></span>
<span><span class="co">#&gt; [16] "CAND_18999"        "CAND_90123"        "CAND_12012"       </span></span>
<span><span class="co">#&gt; [19] "CAND_25000"        "CAND_22444"        "CAND_28029"       </span></span>
<span><span class="co">#&gt; [22] "CAND_14100"        "CAND_77234"        "CAND_28008"       </span></span>
<span><span class="co">#&gt; [25] "CAND_22123"</span></span></code></pre></div>
<p>The <code>what</code>, <code>candidates</code>, and
<code>parties</code> parameters work the same way as in
<code><a href="../reference/interpolate_election_br.html">interpolate_election_br()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="step-4-travel-times">Step 4 – Travel times<a class="anchor" aria-label="anchor" href="#step-4-travel-times"></a>
</h3>
<p>Travel-time computation requires r5r and a Java runtime. The package
can download the OSM road network automatically:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download OSM road network for the municipality</span></span>
<span><span class="va">r5r_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_r5r_data.html">download_r5r_data</a></span><span class="op">(</span></span>
<span>  area_sf    <span class="op">=</span> <span class="va">tracts_sf</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"r5r_network/boa_vista"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert electoral data to sf points</span></span>
<span><span class="va">electoral_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">electoral_data</span>,</span>
<span>                              coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute travel-time matrix (tract centroids -&gt; polling locations)</span></span>
<span><span class="va">tt_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_travel_times.html">compute_travel_times</a></span><span class="op">(</span></span>
<span>  zones_sf     <span class="op">=</span> <span class="va">tracts_sf</span>,</span>
<span>  points_sf    <span class="op">=</span> <span class="va">electoral_sf</span>,</span>
<span>  network_path <span class="op">=</span> <span class="va">r5r_data</span><span class="op">$</span><span class="va">output_dir</span>,</span>
<span>  mode         <span class="op">=</span> <span class="st">"WALK"</span>,</span>
<span>  max_trip_duration <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you already have a travel-time matrix from another source, skip
this step entirely by passing it via the <code>time_matrix</code>
parameter in <code><a href="../reference/interpolate_election_br.html">interpolate_election_br()</a></code> or
<code><a href="../reference/interpolate_election.html">interpolate_election()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="step-5-optimize-and-interpolate">Step 5 – Optimize and interpolate<a class="anchor" aria-label="anchor" href="#step-5-optimize-and-interpolate"></a>
</h3>
<p>The final step finds optimal decay parameters (alpha) and applies the
IDW interpolation:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find optimal alpha (one per tract)</span></span>
<span><span class="va">optim_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_alpha.html">optimize_alpha</a></span><span class="op">(</span></span>
<span>  time_matrix <span class="op">=</span> <span class="va">tt_matrix</span>,</span>
<span>  pop_matrix <span class="op">=</span> <span class="va">pop_matrix</span>,</span>
<span>  source_matrix <span class="op">=</span> <span class="va">source_matrix</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply interpolation with the optimized alpha</span></span>
<span><span class="va">interpolated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/idw_interpolate.html">idw_interpolate</a></span><span class="op">(</span></span>
<span>  time_matrix <span class="op">=</span> <span class="va">tt_matrix</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">optim_result</span><span class="op">$</span><span class="va">alpha</span>,</span>
<span>  source_matrix <span class="op">=</span> <span class="va">electoral_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="downloading-raw-tse-data">Downloading Raw TSE Data<a class="anchor" aria-label="anchor" href="#downloading-raw-tse-data"></a>
</h2>
<p>The package provides direct access to TSE open data for custom
analyses:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Candidate vote data (votacao por secao eleitoral)</span></span>
<span><span class="va">votes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/br_download_votes.html">br_download_votes</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>, uf <span class="op">=</span> <span class="st">"RR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Turnout/attendance data (comparecimento e abstencao)</span></span>
<span><span class="va">turnout</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/br_download_turnout.html">br_download_turnout</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>, uf <span class="op">=</span> <span class="st">"RR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Polling station geocodes (latitude/longitude)</span></span>
<span><span class="va">geocodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/br_download_geocode.html">br_download_geocode</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>, uf <span class="op">=</span> <span class="st">"RR"</span><span class="op">)</span></span></code></pre></div>
<p>Note: geocoding data is not available from TSE for elections before
approximately 2014.</p>
</div>
<div class="section level2">
<h2 id="supported-elections">Supported Elections<a class="anchor" aria-label="anchor" href="#supported-elections"></a>
</h2>
<p>Brazil holds elections every two years, alternating between municipal
and general (federal/state) elections:</p>
<p><strong>Municipal elections</strong> (2000, 2004, 2008, 2012, 2016,
2020, 2024):</p>
<table class="table">
<thead><tr class="header">
<th>Cargo</th>
<th>TSE code</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Prefeito</td>
<td>11</td>
<td>Mayor</td>
</tr>
<tr class="even">
<td>Vereador</td>
<td>13</td>
<td>City councilor</td>
</tr>
</tbody>
</table>
<p><strong>General elections</strong> (2002, 2006, 2010, 2014, 2018,
2022):</p>
<table class="table">
<thead><tr class="header">
<th>Cargo</th>
<th>TSE code</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Presidente</td>
<td>1</td>
<td>President</td>
</tr>
<tr class="even">
<td>Governador</td>
<td>3</td>
<td>State governor</td>
</tr>
<tr class="odd">
<td>Senador</td>
<td>5</td>
<td>Senator</td>
</tr>
<tr class="even">
<td>Deputado Federal</td>
<td>6</td>
<td>Federal representative</td>
</tr>
<tr class="odd">
<td>Deputado Estadual</td>
<td>7</td>
<td>State representative</td>
</tr>
<tr class="even">
<td>Deputado Distrital</td>
<td>8</td>
<td>District representative (DF only)</td>
</tr>
</tbody>
</table>
<p>Use the <code>turno</code> parameter to select the election round:
<code>1</code> (first round, always available) or <code>2</code>
(runoff, only for executive offices when no candidate wins
outright).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rogerio Barbosa, Lucas Gelape.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
