% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sinkhorn.R
\name{sinkhorn_balance}
\alias{sinkhorn_balance}
\title{Balance a weight matrix using Sinkhorn/IPF iterations}
\usage{
sinkhorn_balance(
  W,
  row_targets = NULL,
  col_targets = NULL,
  max_iter = 1000L,
  tol = 1e-10
)
}
\arguments{
\item{W}{Numeric matrix [n x m]. Raw non-negative weight matrix.}

\item{row_targets}{Numeric vector of length n. Desired row sums.
Default: \code{NULL} (uniform: \code{rep(sum(col_targets) / n, n)}).}

\item{col_targets}{Numeric vector of length m. Desired column sums.
Default: \code{NULL} (\code{rep(1, m)}, preserving source totals).}

\item{max_iter}{Integer. Maximum Sinkhorn iterations. Default: 1000.}

\item{tol}{Numeric. Convergence tolerance on maximum marginal error.
Default: 1e-10.}
}
\value{
Numeric matrix [n x m] with row sums approximately equal to
\code{row_targets} and column sums approximately equal to \code{col_targets}.
Attributes:
\describe{
\item{iterations}{Integer. Number of iterations performed.}
\item{converged}{Logical. Whether convergence tolerance was met.}
\item{unreachable}{Integer vector. Indices of all-zero rows (skipped).}
}
}
\description{
Applies alternating row and column scaling to enforce both row and column
marginal constraints simultaneously. Also known as Iterative Proportional
Fitting (IPF) or the RAS algorithm.
}
\details{
At each iteration:
\enumerate{
\item Row scaling: multiply each row by \code{row_targets[i] / rowSums(W)[i]}
\item Column scaling: multiply each column by \code{col_targets[j] / colSums(W)[j]}
}

Rows that are all-zero (unreachable targets) are skipped during scaling
and remain zero. A warning is issued listing these rows.

The algorithm requires \code{sum(row_targets)} approximately equal to
\code{sum(col_targets)} for feasibility. A warning is issued if they
differ by more than 1\\%.
}
\examples{
W <- matrix(c(3, 1, 0.5, 2, 4, 1.5), nrow = 2)
balanced <- sinkhorn_balance(W, row_targets = c(1, 2), col_targets = c(1, 1, 1))
rowSums(balanced)  # approx c(1, 2)
colSums(balanced)  # approx c(1, 1, 1)

}
\seealso{
Other Sinkhorn: 
\code{\link{sinkhorn_objective}()},
\code{\link{sinkhorn_weights}()}
}
\concept{Sinkhorn}
