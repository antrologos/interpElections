[{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Get Started with interpElections","text":"interpElections interpolates data source points (polling stations, schools, hospitals) target polygons (census tracts, districts, neighborhoods) using travel-time-based inverse distance weighting Sinkhorn-balanced weights. decay parameter zone calibrated known demographic totals, ensuring source totals population proportions conserved. start, install optional dependencies:","code":"setup_torch()     # GPU optimization (CUDA, MPS, or CPU fallback) setup_java()      # Java 21+ for r5r travel-time routing setup_osmium()    # OSM data clipping (recommended)"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"example-1-varginha-mg","dir":"Articles","previous_headings":"","what":"Example 1: Varginha (MG)","title":"Get Started with interpElections","text":"simplest way use interpElections Brazilian data interpolate_election_br() wrapper. downloads census data, electoral results, road networks automatically. console output shows progress: Three lines downloaded data, computed travel times, optimized parameters, interpolated vote counts 131 census tracts.  Compare two candidates side side:","code":"result_vga <- interpolate_election_br(   \"Varginha\", year = 2022,   cargo = \"presidente\",   what = c(\"candidates\", \"turnout\"),   keep = c(\"weights\", \"sources_sf\") ) [1/9] Resolving municipality identifiers...   Varginha (MG) - IBGE: 3170701, TSE: 70700   Census year: 2010 (election 2022) [2/9] Preparing census population data... [3/9] Preparing census tract geometries... [4/9] Preparing electoral data... [5/9] Matching calibration brackets... [6/9] Downloading OSM road network... [7/9] Computing travel times... [8/9] Optimizing alpha... [9/9] Interpolating...   Interpolated 15 variables into 131 census tracts Done. result_vga interpElections result -- Brazilian election   Municipality: Varginha (MG)   IBGE: 3170701 | TSE: 70700 | Election: 2022 | Census: 2010   Census tracts: 131 | Sources: 21    Variables: 15     Candidates:    13 (CAND_13, CAND_22, CAND_80, CAND_12, ...)     Turnout:       1 (QT_COMPARECIMENTO)     Calibration:   7 (votantes_18_20, votantes_21_24, ...)    Optimizer: torch_adam_sinkhorn_cpu (obj = ...)   Alpha:     [0.000, ...] (mean ...)    Contents:     result$tracts_sf       sf with census tracts + interpolated columns     result$interpolated    numeric matrix [131 x 15]     ... plot(result_vga, variable = \"Lula\") plot(result_vga, variable = c(\"Lula\", \"Bolsonaro\"), type = \"pct_tract\")"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"example-2-igrejinha-rs","dir":"Articles","previous_headings":"","what":"Example 2: Igrejinha (RS)","title":"Get Started with interpElections","text":"smaller city, workflow:  Different city, different spatial patterns, three-line workflow.","code":"result_igr <- interpolate_election_br(   \"Igrejinha\", year = 2022,   cargo = \"presidente\",   what = c(\"candidates\", \"turnout\") ) result_igr interpElections result -- Brazilian election   Municipality: Igrejinha (RS)   ...   Census tracts: ~50 | Sources: ~10   ... plot(result_igr, variable = \"Lula\")"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"exploring-the-results","dir":"Articles","previous_headings":"","what":"Exploring the Results","title":"Get Started with interpElections","text":"result object several S3 methods inspection: See vignette(\"working--results\") full reference S3 methods, plot types, residual analysis, areal aggregation.","code":"# Detailed summary with per-variable statistics summary(result_vga)  # Alpha decay parameters (one per tract) head(coef(result_vga))  # Export as plain data frame (drops geometry) df <- as.data.frame(result_vga) head(df[, 1:5])  # Interactive map (opens in browser) plot_interactive(result_vga, variable = \"Lula\")"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"controlling-what-gets-interpolated","dir":"Articles","previous_headings":"","what":"Controlling What Gets Interpolated","title":"Get Started with interpElections","text":"parameter controls variables interpolated: Filter specific candidates parties: useful parameters: cargo: \"presidente\", \"governador\", \"senador\", \"deputado_federal\", \"deputado_estadual\", \"prefeito\", \"vereador\" turno: 1 (first round, default) 2 (runoff) census_year: auto-selected election year, override manually data(muni_crosswalk): lookup table 5,710 municipalities","code":"# Just candidates (default) result <- interpolate_election_br(\"Varginha\", year = 2022,   what = \"candidates\")  # Parties (aggregated by party abbreviation) result <- interpolate_election_br(\"Varginha\", year = 2022,   what = \"parties\")  # Turnout and abstention result <- interpolate_election_br(\"Varginha\", year = 2022,   what = \"turnout\")  # Voter demographics (gender, education) result <- interpolate_election_br(\"Varginha\", year = 2022,   what = \"demographics\")  # Everything at once result <- interpolate_election_br(\"Varginha\", year = 2022,   what = c(\"candidates\", \"parties\", \"turnout\", \"demographics\")) # By ballot number result <- interpolate_election_br(\"Varginha\", year = 2022,   cargo = \"presidente\", candidates = c(13, 22))  # By name (accent-insensitive substring matching) result <- interpolate_election_br(\"Varginha\", year = 2022,   cargo = \"presidente\", candidates = \"LULA\")  # Specific parties result <- interpolate_election_br(\"Varginha\", year = 2022,   what = \"parties\", parties = c(\"PT\", \"PL\"))"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"whats-happening-under-the-hood","dir":"Articles","previous_headings":"","what":"What’s Happening Under the Hood","title":"Get Started with interpElections","text":"wrapper interpolate_election_br() calls steps sequence: See vignette(\"methodology\") full technical treatment equations, visualizations, worked examples using real data.","code":"# 1. Census population by age bracket pop_data <- br_prepare_population(\"Varginha\", year = 2010)  # 2. Census tract geometries with population columns tracts_sf <- br_prepare_tracts(3170701, pop_data)  # 3. Electoral data at polling stations electoral <- br_prepare_electoral(   code_muni_ibge = \"3170701\", code_muni_tse = \"70700\",   uf = \"MG\", year = 2022, cargo = \"presidente\",   what = c(\"candidates\", \"turnout\") )  # 4. Travel times via r5r walking routes time_matrix <- compute_travel_times(tracts_sf, electoral_sf)  # 5. Optimize per-tract decay parameters optim_result <- optimize_alpha(time_matrix, pop_matrix, source_matrix)  # 6. Build Sinkhorn-balanced weight matrix and interpolate W <- sinkhorn_weights(time_matrix, optim_result$alpha,   row_targets = pop_total / sum(pop_total) * ncol(time_matrix)) interpolated <- W %*% electoral_data"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"custom-data-any-point-to-polygon-problem","dir":"Articles","previous_headings":"","what":"Custom Data: Any Point-to-Polygon Problem","title":"Get Started with interpElections","text":"interpElections works point--polygon disaggregation, just Brazilian elections. synthetic example: Conservation: interpolated total matches source total exactly.","code":"library(interpElections)  # Synthetic data: 5 zones, 3 sources, 2 calibration variables set.seed(42) tt <- matrix(   c(5, 15, 30, 25, 40,     20, 8, 12, 35, 45,     35, 30, 18, 10, 7),   nrow = 5, ncol = 3,   dimnames = list(paste0(\"zone_\", 1:5), paste0(\"src_\", 1:3)) )  # Calibration: population counts known at both levels pop_matrix <- matrix(   c(100, 300, 150, 200, 250,   # young population per zone     80, 250, 120, 180, 220),   # old population per zone   nrow = 5, ncol = 2,   dimnames = list(NULL, c(\"pop_young\", \"pop_old\")) )  source_matrix <- matrix(   c(250, 400, 350,    # young counts at sources     210, 350, 290),   # old counts at sources   nrow = 3, ncol = 2,   dimnames = list(NULL, c(\"count_young\", \"count_old\")) )  # Optimize alpha (uses torch ADAM) optim_result <- optimize_alpha(   time_matrix = tt + 1,   # offset already applied   pop_matrix = pop_matrix,   source_matrix = source_matrix,   offset = 0,             # offset already in tt   verbose = FALSE )  cat(\"Optimized alpha:\", round(optim_result$alpha, 2), \"\\n\")  # Build balanced weights and interpolate pop_total <- rowSums(pop_matrix) row_targets <- pop_total / sum(pop_total) * ncol(tt) W <- sinkhorn_weights(tt + 1, optim_result$alpha, offset = 0,                        row_targets = row_targets)  # Interpolate a variable measured at sources revenue <- c(5000, 8000, 6500) interpolated_revenue <- as.numeric(W %*% revenue)  cat(\"Source total:\", sum(revenue), \"\\n\") cat(\"Interpolated total:\", round(sum(interpolated_revenue)), \"\\n\") cat(\"Per-zone:\", round(interpolated_revenue), \"\\n\")"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"core-functions-maximum-flexibility","dir":"Articles","previous_headings":"","what":"Core Functions: Maximum Flexibility","title":"Get Started with interpElections","text":"full control, use core functions directly:","code":"# Load bundled example data tt  <- readRDS(system.file(\"extdata/example_tt_matrix.rds\",                             package = \"interpElections\")) pop <- readRDS(system.file(\"extdata/example_pop_matrix.rds\",                             package = \"interpElections\")) src <- readRDS(system.file(\"extdata/example_source_matrix.rds\",                             package = \"interpElections\"))  # Optimize result <- optimize_alpha(tt, pop, src, verbose = FALSE) result  # Build final weight matrix with full Sinkhorn convergence pop_total <- rowSums(pop) row_targets <- pop_total / sum(pop_total) * ncol(tt) W <- sinkhorn_weights(tt, result$alpha, offset = 1,                        row_targets = row_targets)  # Verify conservation cat(\"Column sums (should be ~1):\", round(colSums(W), 4), \"\\n\") cat(\"Row sum range:\", round(range(rowSums(W)), 4), \"\\n\")"},{"path":"https://antrologos.github.io/interpElections/articles/get-started.html","id":"next-steps","dir":"Articles","previous_headings":"","what":"Next Steps","title":"Get Started with interpElections","text":"vignette(\"methodology\"): full pipeline walkthrough equations, visualizations, real-data examples Varginha (MG) vignette(\"working--results\"): S3 methods, plot types, residual analysis, areal aggregation Niteroi Belo Horizonte examples","code":""},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-problem-many-to-many-spatial-disaggregation","dir":"Articles","previous_headings":"","what":"1. The Problem: Many-to-Many Spatial Disaggregation","title":"Methodology","text":"city N census tracts M polling stations. station, votes tallied: many votes candidate received, many voters showed , age profile registered voters. tract, census records population counts age, gender, education, income — voted . want tract-level vote estimates. direct mapping tracts stations. relationship many--many: one station serves voters multiple tracts, one tract’s voters may go multiple stations. administrative boundary “seção eleitoral” — polling section location, zone. differs standard areal interpolation (source target polygons): sources points. Area-weighted interpolation apply. solution: use travel time proxy tract-station relationship. Voters tend go nearby stations. can estimate much station “serves” tract, can disaggregate station totals tract-level estimates. pipeline: Data: Census population + tract geometries + electoral data polling stations Travel times: Walking routes tract representative points stations (r5r OpenStreetMap) IDW kernel: Convert travel times raw weights per-tract decay parameters Sinkhorn balancing: Enforce population conservation (row sums) source conservation (column sums) Optimization: Find alpha minimizes mismatch interpolated census demographics Interpolation: Apply optimized weights station-level variable","code":""},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-data-census-population","dir":"Articles","previous_headings":"","what":"2. The Data: Census Population","title":"Methodology","text":"pop_* columns contain census population counts age bracket. brackets chosen match TSE voter registration age groups — calibration variables bridge census tracts polling stations. 7 matched brackets key insight: observed levels, enabling calibration.","code":"pop_data <- br_prepare_population(\"Varginha\", year = 2010) head(pop_data) code_tract    code_muni pop_18_20 pop_21_24 pop_25_29 pop_30_39 pop_40_49 pop_50_59 pop_60_69 1 3170701xxxxx  3170701      82       103       125       258       220       178       142 2 3170701xxxxx  3170701      45        62        71       130       115        93        80 ..."},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-data-census-tract-geometries","dir":"Articles","previous_headings":"","what":"3. The Data: Census Tract Geometries","title":"Methodology","text":"downloads tract geometries geobr, removes green areas (parks, water bodies zero population), transforms EPSG:5880 (equal-area projection accurate spatial operations), joins population columns.  Note urban-rural gradient: small, densely populated tracts city center; large, sparsely populated tracts periphery.","code":"tracts_sf <- br_prepare_tracts(3170701, pop_data)"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-data-electoral-data-at-polling-stations","dir":"Articles","previous_headings":"","what":"4. The Data: Electoral Data at Polling Stations","title":"Methodology","text":"result contains one row per polling station : Vote columns (CAND_13, CAND_22, …): votes per candidate (ballot number suffix; 95 = blank, 96 = null) Turnout (QT_COMPARECIMENTO): total voters showed Voter age profiles (votantes_18_19, votantes_20, …, votantes_65_69): TSE’s fine-grained age registration brackets (12 groups), aggregated match 7 census brackets Coordinates (lat, long): geocoded polling station locations Column dictionary: attr(electoral, \"column_dictionary\") contains metadata column (type, cargo, candidate name, party) parameter controls gets included: \"candidates\": one column per candidate \"parties\": aggregated party (PARTY_PT, PARTY_PL, …) \"turnout\": QT_COMPARECIMENTO, QT_APTOS, QT_ABSTENCOES \"demographics\": GENERO_* EDUC_* columns","code":"electoral <- br_prepare_electoral(   code_muni_ibge = \"3170701\",   code_muni_tse  = \"70700\",   uf = \"MG\", year = 2022,   cargo = \"presidente\", turno = 1,   what = c(\"candidates\", \"turnout\") )"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"calibration-variables-comparing-source-and-target","dir":"Articles","previous_headings":"","what":"5. Calibration Variables: Comparing Source and Target","title":"Methodology","text":"calibration variables bridge census tracts polling stations. age brackets observed levels: Census: “many people aged 18–20 live tract?” (IBGE) Electoral: “many registered voters aged 18–20 voted station?” (TSE)  shapes similar totals differ: census counts residents, TSE counts registered voters. everyone voting age registered, registration rates vary age bracket. optimization finds alpha values interpolated voter age profiles match census age profiles tract. weights correct demographics, also correct vote counts.","code":""},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"representative-points-from-tracts-to-routable-origins","dir":"Articles","previous_headings":"","what":"6. Representative Points: From Tracts to Routable Origins","title":"Methodology","text":"Routing engines need point--point queries, tracts polygons. need single representative point per tract. Three methods available: pop_weighted method downloads WorldPop Brazil Constrained 2020 raster (~48 MB, cached) finds raster cell highest population density within tract. matters large peripheral tracts geometric center may uninhabited area. pop_min_area parameter (default: 1 km2) controls threshold: tracts smaller use point_on_surface regardless chosen method.","code":"pts_pos <- compute_representative_points(tracts_sf, method = \"point_on_surface\") pts_pop <- compute_representative_points(tracts_sf, method = \"pop_weighted\")"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"travel-times-building-the-distance-matrix","dir":"Articles","previous_headings":"","what":"7. Travel Times: Building the Distance Matrix","title":"Methodology","text":"builds [N tracts x M stations] matrix walking travel times minutes, using r5r routing engine OpenStreetMap data. Origins: representative points (section 6) Destinations: polling station coordinates Mode: walking (default), configurable Max trip duration: 300 minutes; unreachable pairs get value travel time instead straight-line distance? tract across river may 500m away crow flies 30 minutes foot. Travel times actual road network capture geographic barriers. OSM data downloaded via download_r5r_data(), fetches state-level .pbf files clips municipality bounding box using osmium.  heatmap shows spatial structure: block-diagonal pattern nearby tract-station pairs short travel times.  Tracts center short travel times nearest station; peripheral tracts farther away. offset: applying IDW kernel, add 1 travel times (time_matrix + 1) avoid singularity t=0t = 0.","code":"time_matrix <- compute_travel_times(   tracts_sf = tracts_sf,   points_sf = electoral_sf,   tract_id = \"id\",   point_id = \"id\" )"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-idw-kernel-turning-distance-into-influence","dir":"Articles","previous_headings":"","what":"8. The IDW Kernel: Turning Distance into Influence","title":"Methodology","text":"core formula raw weight tract ii station jj: Wijraw=(tij+1)−αiW^{\\text{raw}}_{ij} = (t_{ij} + 1)^{-\\alpha_i} : tijt_{ij}: travel time tract ii station jj (minutes) αi\\alpha_i: decay parameter tract ii (optimized) Closer stations get weight. decay rate α\\alpha controls quickly influence drops distance.  α=0.5\\alpha = 0.5: nearly flat — stations contribute almost equally α=2\\alpha = 2: moderate — stations within 10 minutes dominate α=10\\alpha = 10: steep cliff — nearest station matters per-tract alpha? Urban centers overlapping station catchments need low alpha (spread weight). Isolated periphery one nearby station needs high alpha (concentrate weight). single global alpha capture heterogeneity.","code":"tt_range <- 0:60 alphas <- c(0.5, 1, 2, 5, 10) decay_df <- do.call(rbind, lapply(alphas, function(a) {   data.frame(time = tt_range, weight = (tt_range + 1)^(-a),              alpha = paste0(\"alpha = \", a)) })) decay_df$alpha <- factor(decay_df$alpha,                           levels = paste0(\"alpha = \", alphas))  library(ggplot2) ggplot(decay_df, aes(x = time, y = weight, color = alpha)) +   geom_line(linewidth = 0.8) +   scale_y_log10() +   labs(title = \"Weight Decay Curves\",        subtitle = \"Higher alpha = steeper decay = more concentrated weights\",        x = \"Travel time (minutes)\", y = \"Weight (log scale)\",        color = \"\") +   theme_minimal() +   theme(plot.title = element_text(face = \"bold\"),         legend.position = \"right\")"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"why-column-standardization-is-not-enough","dir":"Articles","previous_headings":"","what":"9. Why Column Standardization Is Not Enough","title":"Methodology","text":"naive approach: divide column sum station distributes 100% data: Wijstd=Wijraw∑iWijrawW^{\\text{std}}_{ij} = \\frac{W^{\\text{raw}}_{ij}}{\\sum_i W^{\\text{raw}}_{ij}} Column sums = 1 (source conservation: every vote distributed exactly ). constraint row sums. Tract 1 10% population receives disproportionate share total weight close station 1. row sums don’t match population shares — downstream estimates biased toward well-connected tracts.","code":"# Toy example: 5 tracts, 3 stations tt_toy <- matrix(   c(2,  10, 25, 30, 50,   # station 1: close to tract 1     15,  3, 12, 28, 45,   # station 2: close to tract 2     40, 35, 20,  5,  8),  # station 3: close to tracts 4-5   nrow = 5, ncol = 3 ) pop_toy <- c(100, 300, 150, 200, 250)  # population per tract  alpha_toy <- rep(2, 5) W_raw <- (tt_toy + 1)^(-alpha_toy)  # Column standardize W_std <- t(t(W_raw) / colSums(W_raw))  cat(\"Column sums (source conservation):\\n\") #> Column sums (source conservation): round(colSums(W_std), 4) #> [1] 1 1 1  cat(\"\\nRow sums (NO population constraint):\\n\") #>  #> Row sums (NO population constraint): round(rowSums(W_std), 4) #> [1] 0.9751 0.9300 0.1439 0.6594 0.2917  cat(\"\\nPopulation shares:\\n\") #>  #> Population shares: round(pop_toy / sum(pop_toy), 4) #> [1] 0.10 0.30 0.15 0.20 0.25"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"sinkhorn-balancing-double-conservation","dir":"Articles","previous_headings":"","what":"10. Sinkhorn Balancing: Double Conservation","title":"Methodology","text":"Sinkhorn algorithm (also known Iterative Proportional Fitting, RAS algorithm) iteratively scales rows columns enforce marginal constraints simultaneously: Row targets: ri=popi∑pop×mr_i = \\frac{\\text{pop}_i}{\\sum \\text{pop}} \\times m (population-proportional) Column targets: cj=1c_j = 1 jj (source conservation) Row scaling pulls tract’s total weight toward population share. Column scaling readjusts station still distributes 100%. Repeat constraints satisfied.  Compare Sinkhorn:  Sinkhorn redistributes weight: -weighted tracts (near many stations) get less, -weighted tracts get . geographic “shape” row preserved, “scale” changes match population. Key properties: balanced matrix unique given row/column targets Non-negative: input non-negative, output non-negative Convergence guaranteed sum(row_targets) = sum(col_targets) Unreachable tracts (-zero rows) remain zero flagged","code":"W <- W_raw for iter in 1..max_iter:   W <- W * (row_targets / rowSums(W))        # scale rows   W <- t(t(W) * (col_targets / colSums(W)))  # scale columns   if max marginal error < tol: break # Continue from the toy example m <- ncol(tt_toy) row_targets <- pop_toy / sum(pop_toy) * m col_targets <- rep(1, m)  # Run Sinkhorn step by step, tracking convergence W <- W_raw max_err_history <- numeric(50) for (k in 1:50) {   rs <- rowSums(W); rs[rs == 0] <- 1   W <- W * (row_targets / rs)   cs <- colSums(W); cs[cs == 0] <- 1   W <- t(t(W) * (col_targets / cs))   max_err_history[k] <- max(     abs(rowSums(W) - row_targets),     abs(colSums(W) - col_targets)   ) }  # Plot convergence conv_df <- data.frame(iteration = 1:50, max_error = max_err_history) ggplot(conv_df, aes(x = iteration, y = max_error)) +   geom_line(color = \"#4575b4\", linewidth = 0.8) +   geom_point(color = \"#4575b4\", size = 1) +   scale_y_log10() +   labs(title = \"Sinkhorn Convergence\",        subtitle = \"Marginal error converges to machine precision in ~15 iterations\",        x = \"Iteration\", y = \"Max marginal error (log scale)\") +   theme_minimal() +   theme(plot.title = element_text(face = \"bold\")) # Verify the balanced matrix W_balanced <- sinkhorn_balance(W_raw,   row_targets = row_targets,   col_targets = col_targets )  cat(\"Row sums (should match targets):\\n\") #> Row sums (should match targets): cbind(target = round(row_targets, 4),       actual = round(rowSums(W_balanced), 4)) #>      target actual #> [1,]   0.30   0.30 #> [2,]   0.90   0.90 #> [3,]   0.45   0.45 #> [4,]   0.60   0.60 #> [5,]   0.75   0.75  cat(\"\\nColumn sums (should be 1):\\n\") #>  #> Column sums (should be 1): round(colSums(W_balanced), 4) #> [1] 1 1 1 # Heatmap comparison W_std_long <- expand.grid(tract = 1:5, station = 1:3) W_std_long$weight <- as.vector(W_std) W_std_long$method <- \"Column standardized\"  W_bal_long <- expand.grid(tract = 1:5, station = 1:3) W_bal_long$weight <- as.vector(W_balanced) W_bal_long$method <- \"Sinkhorn balanced\"  both <- rbind(W_std_long, W_bal_long) both$method <- factor(both$method,   levels = c(\"Column standardized\", \"Sinkhorn balanced\"))  ggplot(both, aes(x = station, y = tract, fill = weight)) +   geom_tile(color = \"white\") +   geom_text(aes(label = round(weight, 3)), size = 3) +   facet_wrap(~method) +   scale_fill_viridis_c(option = \"viridis\", direction = -1) +   labs(title = \"Weight Matrix: Before and After Sinkhorn\",        x = \"Station\", y = \"Tract\") +   theme_minimal() +   theme(plot.title = element_text(face = \"bold\"))"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-calibration-objective","dir":"Articles","previous_headings":"","what":"11. The Calibration Objective","title":"Methodology","text":"travel times, IDW kernel parametrized α\\alpha, Sinkhorn balancing. need find optimal α\\alpha. Objective function: f(α)=∑∑k(V̂ik−Pik)2f(\\alpha) = \\sum_i \\sum_k \\left( \\hat{V}_{ik} - P_{ik} \\right)^2 : V̂=Wsinkhorn(α)×S\\hat{V} = W_{\\text{sinkhorn}}(\\alpha) \\times S — interpolated voter demographics per tract PP — census demographics per tract kk = age bracket index (7 brackets) Intuition: weights correct, interpolating voter age profiles stations recover census age profiles tracts. optimal alpha minimizes mismatch. forward pass given alpha vector: Build raw kernel: Wijraw=(tij+1)−αiW^{\\text{raw}}_{ij} = (t_{ij} + 1)^{-\\alpha_i} Run KK Sinkhorn iterations (K = 5 optimization) Compute: V̂=Wbalanced×S\\hat{V} = W_{\\text{balanced}} \\times S Compute: loss=∑(V̂−P)2\\text{loss} = \\sum(\\hat{V} - P)^2 K = 5 optimization? Full Sinkhorn convergence (K = 1000) expensive. K = 5 gives approximate balance produces gradient pointing right direction. final weight computation (optimization) uses full convergence.  landscape clear minimum. practice, tract alpha, creating high-dimensional optimization problem.","code":"# Simplified: all tracts share the same alpha tt_adj <- tt_toy + 1 pop_matrix_toy <- matrix(pop_toy, ncol = 1) src_matrix_toy <- matrix(c(250, 400, 350), ncol = 1)  alpha_range <- seq(0.1, 8, by = 0.1) sse_values <- sapply(alpha_range, function(a) {   sinkhorn_objective(     alpha = rep(a, 5),     time_matrix = tt_adj,     pop_matrix = pop_matrix_toy,     source_matrix = src_matrix_toy,     row_targets = pop_toy / sum(pop_toy) * 3,     sinkhorn_iter = 50   ) })  ggplot(data.frame(alpha = alpha_range, sse = sse_values),        aes(x = alpha, y = sse)) +   geom_line(color = \"#4575b4\", linewidth = 0.8) +   geom_vline(xintercept = alpha_range[which.min(sse_values)],              linetype = \"dashed\", color = \"#d73027\") +   labs(title = \"Objective Function Landscape\",        subtitle = sprintf(\"Minimum at alpha = %.1f (shared across all tracts)\",                            alpha_range[which.min(sse_values)]),        x = expression(alpha), y = \"SSE\") +   theme_minimal() +   theme(plot.title = element_text(face = \"bold\")) # Varginha: objective before and after optimization sse_init <- sinkhorn_objective(   rep(1, nrow(time_matrix)), time_matrix + 1,   pop_matrix, source_matrix, row_targets, sinkhorn_iter = 50 ) sse_opt <- sinkhorn_objective(   optim_result$alpha, time_matrix + 1,   pop_matrix, source_matrix, row_targets, sinkhorn_iter = 50 ) cat(\"SSE at alpha = 1 (initial):\", format(sse_init, big.mark = \",\"), \"\\n\") cat(\"SSE at optimal alpha:      \", format(sse_opt, big.mark = \",\"), \"\\n\")"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"optimization-torch-adam-with-log-domain-sinkhorn","dir":"Articles","previous_headings":"","what":"12. Optimization: Torch ADAM with Log-Domain Sinkhorn","title":"Methodology","text":"objective function involves KK iterations Sinkhorn scaling, differentiable writing analytical gradient KK unrolled iterations impractical. Torch’s automatic differentiation handles : define forward pass, get gradients free. Log-domain Sinkhorn: Standard Sinkhorn multiplies small numbers (weights near zero distant pairs) can underflow float32. log-domain reformulation uses logsumexp: logKij=−αi⋅log(tij+1)\\log K_{ij} = -\\alpha_i \\cdot \\log(t_{ij} + 1) Alternating updates (KK iterations): logui←logri−logsumexpj(logKij+logvj)\\log u_i \\leftarrow \\log r_i - \\text{logsumexp}_j(\\log K_{ij} + \\log v_j)logvj←logcj−logsumexpi(logKij+logui)\\log v_j \\leftarrow \\log c_j - \\text{logsumexp}_i(\\log K_{ij} + \\log u_i) Balanced weights: Wij=exp(logui+logKij+logvj)W_{ij} = \\exp(\\log u_i + \\log K_{ij} + \\log v_j) operations (log, exp, logsumexp, matmul) differentiable torch. ADAM optimizer multi-phase learning rate annealing: Phase 1: linear warmup (10 steps LR = 0 gpu_lr_init) Subsequent phases: runs inner iterations decreasing LR LR decays gpu_lr_decay (default 0.6) phases Gradient clipping norm 1.0 Alpha clamped [lower_bound, upper_bound] (default [0, 20])  Rapid descent first phases, fine-tuning learning rate decays. Key tuning parameters:","code":"optim_result <- optimize_alpha(   time_matrix   = time_matrix,   pop_matrix    = pop_matrix,   source_matrix = source_matrix,   row_targets   = row_targets,   sinkhorn_iter = 5,       # K=5 inside ADAM (fast, approximate)   use_gpu       = FALSE,   # CPU for Varginha (small: ~130 tracts)   gpu_iterations = 20,     # 20 outer LR phases   gpu_lr_init   = 0.1,     # initial learning rate   gpu_lr_decay  = 0.6      # LR multiplier between phases )"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-effect-of-alpha-spatial-interpretation","dir":"Articles","previous_headings":"","what":"13. The Effect of Alpha: Spatial Interpretation","title":"Methodology","text":"alphas cluster moderate range, tails extending toward 0 (uniform allocation) upper bound (nearest-station-).  Low alpha (blue, urban core): weight spread across many nearby stations. Multiple stations overlap, optimizer distributes influence broadly. High alpha (red, periphery): weight concentrated nearest station. Isolated tracts one dominant station.  α=1\\alpha = 1, weights nearly uniform. α=10\\alpha = 10, nearest station dominates ~85% weight. Interpretation guide: α<1\\alpha < 1: draws information almost equally stations. Unusual — check data issues. α∈[1,3]\\alpha \\[1, 3]: several nearby stations contribute. Typical dense urban areas. α∈[3,6]\\alpha \\[3, 6]: stations dominate. Typical suburban areas. α>6\\alpha > 6: one station dominates almost entirely. Typical isolated peripheral tracts. α→0\\alpha \\0: uniform allocation (ignores geography). α=20\\alpha = 20 (upper bound): nearest station . May indicate optimizer hit bound.","code":"# How alpha changes the weight distribution for a fixed tract tt_one_tract <- c(3, 8, 15, 25, 40)  # travel times to 5 stations alphas_demo <- c(1, 3, 5, 10) wt_df <- do.call(rbind, lapply(alphas_demo, function(a) {   w <- (tt_one_tract + 1)^(-a)   w <- w / sum(w)  # normalize for display   data.frame(station = 1:5, weight = w,              alpha = paste0(\"alpha = \", a)) })) wt_df$alpha <- factor(wt_df$alpha,                         levels = paste0(\"alpha = \", alphas_demo))  ggplot(wt_df, aes(x = factor(station), y = weight, fill = alpha)) +   geom_col(position = \"dodge\") +   labs(title = \"Weight Distribution as Alpha Increases\",        subtitle = \"Fixed tract with 5 stations at distances 3, 8, 15, 25, 40 min\",        x = \"Station (sorted by distance)\", y = \"Normalized weight\",        fill = \"\") +   theme_minimal() +   theme(plot.title = element_text(face = \"bold\"))"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"the-interpolation-from-weights-to-tract-level-estimates","dir":"Articles","previous_headings":"","what":"14. The Interpolation: From Weights to Tract-Level Estimates","title":"Methodology","text":"weight matrix WW encodes geographic relationship tracts stations. Multiplying station-level variable produces tract-level estimates: X̂=W×V\\hat{X} = W \\times V : WW [N x M]: Sinkhorn-balanced weight matrix VV [M x 1]: variable measured stations X̂\\hat{X} [N x 1]: estimated value tract multiple variables simultaneously: X̂=W×Vmatrix[N×M]⋅[M×P]→[N×P]\\hat{X} = W \\times V_{\\text{matrix}} \\quad [N \\times M] \\cdot [M \\times P] \\[N \\times P]   Geographic polarization becomes visible tract level — spatial pattern previously impossible observe station-level data alone. Calibration validation: interpolated demographics match census demographics (optimization objective).  Points cluster tightly around 45-degree line, confirming optimization found good weights. reuse principle: weight matrix WW property geography calibration. computed, can interpolate variable measured polling stations — candidates, parties, turnout, gender composition, education level — without re-optimizing alpha.","code":"# Practical example with Varginha data W <- sinkhorn_weights(time_matrix, optim_result$alpha, offset = 1,   row_targets = row_targets)  electoral_data <- as.matrix(   sources[, c(\"CAND_13\", \"CAND_22\", \"QT_COMPARECIMENTO\")] ) interpolated <- W %*% electoral_data  # Derived quantities pct_lula <- interpolated[, \"CAND_13\"] /   interpolated[, \"QT_COMPARECIMENTO\"] * 100"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"conservation-properties-and-validation","dir":"Articles","previous_headings":"","what":"15. Conservation Properties and Validation","title":"Methodology","text":"Column conservation (source conservation): ∑iWij=1∀j\\sum_i W_{ij} = 1 \\quad \\forall j station distributes exactly 100% data. Consequence: municipal totals preserved exactly. Row conservation (population proportionality): ∑jWij=ri=popi∑pop×m\\sum_j W_{ij} = r_i = \\frac{\\text{pop}_i}{\\sum \\text{pop}} \\times m Tracts receive weight proportional population share. Calibration residuals: residualik=∑jWij⋅Sjk−Pik\\text{residual}_{ik} = \\sum_j W_{ij} \\cdot S_{jk} - P_{ik} SS source demographic matrix PP census population matrix.  Residuals centered near zero small magnitude. Outliers may indicate boundary effects (voters crossing municipality borders), data quality issues, model limitations.","code":"# Using our toy example votes <- c(500, 800, 700)   # votes at 3 stations interpolated_votes <- as.numeric(W_balanced %*% votes)  cat(\"Source total:\", sum(votes), \"\\n\") #> Source total: 2000 cat(\"Interpolated total:\", round(sum(interpolated_votes)), \"\\n\") #> Interpolated total: 2000 cat(\"Per-tract:\", round(interpolated_votes), \"\\n\") #> Per-tract: 151 644 304 399 502"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"performance-and-tuning","dir":"Articles","previous_headings":"","what":"16. Performance and Tuning","title":"Methodology","text":"Practical runtimes: Varginha (~130 tracts, ~20 stations): 2–4s CPU Igrejinha (~50 tracts, ~10 stations): 1–2s CPU Niteroi (~500 tracts, ~100 stations): 5–15s GPU Belo Horizonte (~4,000 tracts, ~800 stations): 30–60s GPU Sao Paulo capital (~18,000 tracts, ~3,000 stations): 5–10 min GPU Memory: approximately 3 * sinkhorn_iter + 10 copies N x M matrix GPU memory. RStudio: torch inside RStudio IDE requires subprocess execution via callr (automatic transparent user). Standalone R scripts run directly.","code":""},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"setup-torch-java-and-r5r","dir":"Articles","previous_headings":"","what":"17. Setup: Torch, Java, and r5r","title":"Methodology","text":"Torch (required optimization): GPU support: Windows (CUDA), macOS (MPS Apple Silicon), Linux (CUDA). CPU always works fallback. Java + r5r (required travel time computation): Memory: options(java.parameters = \"-Xmx8g\") loading r5r large municipalities. Cache management:","code":"setup_torch()    # installs torch + libtorch/lantern binaries check_torch()    # diagnoses installation (R package, binaries, GPU) setup_java()     # downloads and installs Java 21+ check_r5r()      # checks Java version and r5r readiness setup_osmium()   # installs osmium-tool for OSM clipping get_interpElections_cache_dir()    # where downloads are stored interpElections_cache()            # list cached files by category interpElections_cache_clean()      # clear cache (all or by category)"},{"path":"https://antrologos.github.io/interpElections/articles/methodology.html","id":"mathematical-appendix","dir":"Articles","previous_headings":"","what":"18. Mathematical Appendix","title":"Methodology","text":"Notation: NN = number census tracts, MM = number polling stations KK = number calibration age brackets (7) t∈ℝN×Mt \\\\mathbb{R}^{N \\times M}: travel time matrix (minutes) α∈ℝN\\alpha \\\\mathbb{R}^N: per-tract decay parameters P∈ℝN×KP \\\\mathbb{R}^{N \\times K}: census population age bracket S∈ℝM×KS \\\\mathbb{R}^{M \\times K}: voter counts age bracket r∈ℝNr \\\\mathbb{R}^N: row targets (population-proportional) c∈ℝMc \\\\mathbb{R}^M: column targets (= 1) IDW kernel: Kij=(tij+1)−αiK_{ij} = (t_{ij} + 1)^{-\\alpha_i} Log-domain kernel: logKij=−αi⋅log(tij+1)\\log K_{ij} = -\\alpha_i \\cdot \\log(t_{ij} + 1) Sinkhorn iterations (log-domain): Initialize: logu=0\\log u = 0, logv=0\\log v = 0 k=1k = 1 KsinkK_{\\text{sink}}: logui←logri−logsumexpj(logKij+logvj)\\log u_i \\leftarrow \\log r_i - \\text{logsumexp}_j(\\log K_{ij} + \\log v_j)logvj←logcj−logsumexpi(logKij+logui)\\log v_j \\leftarrow \\log c_j - \\text{logsumexp}_i(\\log K_{ij} + \\log u_i) Balanced weight matrix: Wij=exp(logui+logKij+logvj)W_{ij} = \\exp(\\log u_i + \\log K_{ij} + \\log v_j) Objective function: f(α)=∥W(α)⋅S−P∥F2=∑,k(∑jWijSjk−Pik)2f(\\alpha) = \\| W(\\alpha) \\cdot S - P \\|_F^2 = \\sum_{,k} \\left( \\sum_j W_{ij} S_{jk} - P_{ik} \\right)^2 Gradient: computed torch autograd KK unrolled Sinkhorn iterations. operation forward pass (log, exp, logsumexp, matrix multiply, subtraction, squaring) defined backward pass torch. gradient flows backward KK Sinkhorn iterations automatically: ∇αf=∂∂α∥sinkhornK(kernel(α))⋅S−P∥F2\\nabla_\\alpha f = \\frac{\\partial}{\\partial \\alpha} \\| \\text{sinkhorn}_K(\\text{kernel}(\\alpha)) \\cdot S - P \\|_F^2","code":""},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"loading-results","dir":"Articles","previous_headings":"","what":"Loading Results","title":"Working with Results","text":"","code":"# Run the pipeline (these were computed with GPU) result_nit <- interpolate_election_br(   \"Niteroi\", year = 2022, cargo = \"presidente\",   what = c(\"candidates\", \"parties\", \"turnout\", \"demographics\"),   keep = c(\"weights\", \"sources_sf\", \"time_matrix\"),   use_gpu = TRUE )  result_bh <- interpolate_election_br(   \"Belo Horizonte\", year = 2022, cargo = \"presidente\",   what = c(\"candidates\", \"turnout\"),   keep = c(\"weights\", \"sources_sf\"),   use_gpu = TRUE )"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"print-and-summary","dir":"Articles","previous_headings":"","what":"Print and Summary","title":"Working with Results","text":"print() method gives compact overview: summary() method adds per-variable statistics grouped type: dictionary groups columns type (candidate, party, turnout, demographics, calibration) metadata like candidate name, party abbreviation, ballot number:","code":"result_nit interpElections result -- Brazilian election   Municipality: Niteroi (RJ)   IBGE: 3303302 | TSE: 58718 | Election: 2022 | Census: 2010   Census tracts: ~500 | Sources: ~100    Variables: ~50     Candidates:    13 (CAND_13, CAND_22, ...)     Parties:       ~10 (PARTY_PT, PARTY_PL, ...)     Turnout:       3 (QT_COMPARECIMENTO, QT_APTOS, QT_ABSTENCOES)     Demographics:  ~15 (GENERO_FEMININO, EDUC_SUP_COMP, ...)     Calibration:   7 (votantes_18_20, ...) summary(result_nit) View(result_nit$dictionary)"},{"path":[]},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"single-variable","dir":"Articles","previous_headings":"Plotting","what":"Single variable","title":"Working with Results","text":"Variables can referenced : Column name: \"CAND_13\", \"PARTY_PT\", \"QT_COMPARECIMENTO\" Ballot number: 13, 22 Candidate name (substring, case-insensitive): \"Lula\", \"Bolsonaro\" Party abbreviation: \"PT\", \"PL\"","code":"plot(result_nit, variable = \"Lula\")"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"absolute-counts","dir":"Articles","previous_headings":"Plotting","what":"Absolute counts","title":"Working with Results","text":"","code":"plot(result_nit, variable = \"Lula\", type = \"absolute\")"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"faceted-comparison","dir":"Articles","previous_headings":"Plotting","what":"Faceted comparison","title":"Working with Results","text":"","code":"plot(result_nit, variable = c(\"Lula\", \"Bolsonaro\"), type = \"pct_tract\")"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"plot-types","dir":"Articles","previous_headings":"Plotting","what":"Plot types","title":"Working with Results","text":"type parameter controls quantity mapped:","code":""},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"break-methods","dir":"Articles","previous_headings":"Plotting","what":"Break methods","title":"Working with Results","text":"breaks parameter controls color scale: \"quantile\" (default): equal-count bins \"continuous\": smooth gradient \"jenks\": natural breaks (requires classInt package) Custom numeric vector: breaks = c(0, 20, 40, 60, 80, 100)","code":"plot(result_nit, variable = \"Lula\", breaks = \"continuous\") plot(result_nit, variable = \"Lula\", breaks = \"jenks\")"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"additional-options","dir":"Articles","previous_headings":"Plotting","what":"Additional options","title":"Working with Results","text":"","code":"# Overlay polling stations plot(result_nit, variable = \"Lula\", show_sources = TRUE)  # Zoom into a region (lon/lat bounding box) plot(result_nit, variable = \"Lula\",      limits = c(-43.15, -43.05, -22.92, -22.86))  # Custom palette plot(result_nit, variable = \"Lula\", palette = \"viridis\") plot(result_nit, variable = \"Lula\", palette = \"Spectral\")  # Composable with ggplot2 library(ggplot2) plot(result_nit, variable = \"Lula\") + theme_dark()"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"interactive-maps","dir":"Articles","previous_headings":"Plotting","what":"Interactive maps","title":"Working with Results","text":"","code":"# Opens in browser with hover tooltips and zoom plot_interactive(result_nit, variable = \"Lula\")"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"large-scale-example-belo-horizonte","dir":"Articles","previous_headings":"Plotting","what":"Large-scale example (Belo Horizonte)","title":"Working with Results","text":"","code":"plot(result_bh, variable = \"Lula\")"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"extracting-alpha","dir":"Articles","previous_headings":"","what":"Extracting Alpha","title":"Working with Results","text":"coef() method returns optimized decay parameters:  Map alpha values spatially see urban/peripheral gradient:  Interpretation: Low alpha (blue) = weight spread across many stations (dense urban areas). High alpha (red) = weight concentrated nearest station (periphery).","code":"alpha <- coef(result_nit) summary(alpha) result_nit$tracts_sf$alpha <- coef(result_nit) ggplot(result_nit$tracts_sf) +   geom_sf(aes(fill = alpha), color = \"white\", linewidth = 0.05) +   scale_fill_distiller(palette = \"RdYlBu\", direction = -1) +   theme_void()"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"residual-analysis","dir":"Articles","previous_headings":"","what":"Residual Analysis","title":"Working with Results","text":"residuals() method computes calibration residuals (fitted minus observed) tract age bracket. Requires keep = \"weights\" keep = \"time_matrix\".  Residuals centered near zero. Large residuals may indicate boundary effects (voters crossing municipality borders), data quality issues, census/election year mismatches.","code":"resid <- residuals(result_nit) str(resid) #> num [1:~500, 1:7] ...  # Per-bracket summary colMeans(resid)                        # mean residual per bracket sqrt(colMeans(resid^2))                # RMSE per bracket"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"validation-checklist","dir":"Articles","previous_headings":"","what":"Validation Checklist","title":"Working with Results","text":"Five checks apply result:","code":"# 1. Total conservation: interpolated totals match source totals colSums(result_nit$interpolated)[1:3] colSums(result_nit$sources[, result_nit$interp_cols[1:3]])  # 2. Residual magnitude resid <- residuals(result_nit) sqrt(mean(resid^2))   # overall RMSE  # 3. Alpha distribution (no extreme piling at bounds) summary(coef(result_nit))  # 4. Non-negative values all(result_nit$interpolated >= -1e-10)  # 5. Convergence result_nit$optimization$convergence   # 0 = success"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"exporting-results","dir":"Articles","previous_headings":"","what":"Exporting Results","title":"Working with Results","text":"","code":"# Plain data frame (no geometry) df <- as.data.frame(result_nit) write.csv(df, \"niteroi_2022.csv\", row.names = FALSE)  # GeoPackage with geometry (for GIS) sf::st_write(result_nit$tracts_sf, \"niteroi_2022.gpkg\")  # Column metadata result_nit$dictionary  # Source-level data (without geometry) head(result_nit$sources)"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"areal-aggregation-from-tracts-to-neighborhoods","dir":"Articles","previous_headings":"","what":"Areal Aggregation: From Tracts to Neighborhoods","title":"Working with Results","text":"Tract-level results can reaggregated larger zones (neighborhoods, administrative regions, custom polygons) using areal_weights() areal_interpolate(). Example: Belo Horizonte tracts neighborhoods weight matrix W_areal [n_neighborhoods x n_tracts]. column sums 1 (tract’s data distributed proportionally area overlap). areal_interpolate() simply W_areal %*% data. approach preserves total conservation: neighborhood-level totals equal tract-level totals, equal original municipality totals.","code":"library(sf) library(geobr)  # Download BH neighborhood boundaries bairros <- read_neighborhood(year = 2010) bairros <- bairros[bairros$code_muni == 3106200, ]  # Compute area-weighted intersection matrix W_areal <- areal_weights(   target_sf = bairros,   source_sf = result_bh$tracts_sf,   target_id = \"code_neighborhood\",   source_id = \"code_tract\" )  # Aggregate interpolated data vote_data <- result_bh$interpolated aggregated <- areal_interpolate(vote_data, W_areal)  # Conservation check colSums(aggregated)[1:3] colSums(vote_data)[1:3]   # should match"},{"path":"https://antrologos.github.io/interpElections/articles/working-with-results.html","id":"the-keep-parameter","dir":"Articles","previous_headings":"","what":"The keep Parameter","title":"Working with Results","text":"Control intermediate objects retained result: Default: NULL (lightweight, nothing kept). Recommended: enables residual analysis source point overlays without excessive memory use.","code":"result <- interpolate_election_br(\"Niteroi\", year = 2022,   keep = c(\"weights\", \"sources_sf\"))"},{"path":"https://antrologos.github.io/interpElections/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Rogerio Barbosa. Author, maintainer. Lucas Gelape. Author.","code":""},{"path":"https://antrologos.github.io/interpElections/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Barbosa R, Gelape L (2026). interpElections: Spatial Interpolation Electoral Data via Inverse Distance Weighting. R package version 0.1.0, https://antrologos.github.io/interpElections/.","code":"@Manual{,   title = {interpElections: Spatial Interpolation of Electoral Data via Inverse Distance Weighting},   author = {Rogerio Barbosa and Lucas Gelape},   year = {2026},   note = {R package version 0.1.0},   url = {https://antrologos.github.io/interpElections/}, }"},{"path":"https://antrologos.github.io/interpElections/index.html","id":"interpelections","dir":"","previous_headings":"","what":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"Spatial interpolation electoral data via Sinkhorn-balanced inverse distance weighting. Disaggregates point-level data (e.g., polling station vote counts) polygon-level estimates (e.g., census tracts) using travel-time-based IDW per-zone decay parameters calibrated demographic totals. Sinkhorn balancing enforces population conservation source conservation simultaneously.","code":""},{"path":"https://antrologos.github.io/interpElections/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"Optional: setup_torch() GPU optimization, setup_java() r5r travel-time routing, setup_osmium() OSM data clipping.","code":"# install.packages(\"remotes\") remotes::install_github(\"antrologos/interpElections\")"},{"path":"https://antrologos.github.io/interpElections/index.html","id":"quick-example-brazilian-election","dir":"","previous_headings":"","what":"Quick example: Brazilian election","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"Three lines: downloads census data, electoral results, road networks; computes travel times; optimizes per-tract decay; interpolates variables census tracts.","code":"library(interpElections)  result <- interpolate_election_br(\"Varginha\", year = 2022,   cargo = \"presidente\", what = c(\"candidates\", \"turnout\"))  summary(result) plot(result, variable = \"Lula\")"},{"path":"https://antrologos.github.io/interpElections/index.html","id":"quick-example-custom-data","dir":"","previous_headings":"","what":"Quick example: Custom data","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"","code":"result <- interpolate_election(   tracts_sf     = my_zones,   electoral_sf  = my_sources,   tract_id      = \"zone_id\",   point_id      = \"source_id\",   calib_tracts  = c(\"pop_young\", \"pop_old\"),   calib_sources = c(\"count_young\", \"count_old\"),   time_matrix   = my_travel_times )"},{"path":"https://antrologos.github.io/interpElections/index.html","id":"how-it-works","dir":"","previous_headings":"","what":"How it works","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"tract source j, IDW kernel : Wij=(tij+1)−αiW_{ij} = (t_{ij} + 1)^{-\\alpha_i} Sinkhorn balancing iteratively scales rows columns row sums proportional population column sums equal 1 (source distributes exactly 100% data). optimal alpha found minimizing squared error interpolated census demographics via torch ADAM log-domain Sinkhorn differentiation.","code":""},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/interpElections/index.html","id":"gpu-acceleration","dir":"","previous_headings":"","what":"GPU acceleration","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"GPU (CUDA/MPS) recommended municipalities >1,000 census tracts. CPU works problem sizes.","code":"setup_torch()     # one-time installation use_gpu(TRUE)     # enable globally"},{"path":"https://antrologos.github.io/interpElections/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"Barbosa, R. & Gelape, L. (2025). interpElections: Spatial Interpolation Electoral Data via Sinkhorn-Balanced Inverse Distance Weighting. R package version 0.1.0. https://github.com/antrologos/interpElections","code":""},{"path":"https://antrologos.github.io/interpElections/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Spatial Interpolation of Electoral Data via Inverse Distance Weighting","text":"MIT","code":""},{"path":"https://antrologos.github.io/interpElections/reference/areal_interpolate.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregate data from source zones to target polygons using areal weights — areal_interpolate","title":"Aggregate data from source zones to target polygons using areal weights — areal_interpolate","text":"Applies precomputed areal weight matrix (areal_weights()) transfer data source zones target polygons.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/areal_interpolate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregate data from source zones to target polygons using areal weights — areal_interpolate","text":"","code":"areal_interpolate(data, weights)"},{"path":"https://antrologos.github.io/interpElections/reference/areal_interpolate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregate data from source zones to target polygons using areal weights — areal_interpolate","text":"data Numeric matrix data.frame [n_source x p]. Data source zones. Rows must correspond columns weights. weights Numeric matrix [n_target x n_source]. Output areal_weights().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/areal_interpolate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregate data from source zones to target polygons using areal weights — areal_interpolate","text":"Numeric matrix [n_target x p]. Aggregated values target polygons.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/areal_interpolate.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Aggregate data from source zones to target polygons using areal weights — areal_interpolate","text":"","code":"W <- matrix(c(0.7, 0.3, 0.2, 0.8), nrow = 2)  # 2 targets x 2 sources src_data <- matrix(c(100, 200), nrow = 2)        # 2 sources x 1 variable areal_interpolate(src_data, W) #>      [,1] #> [1,]  110 #> [2,]  190"},{"path":"https://antrologos.github.io/interpElections/reference/areal_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute area-weighted intersection matrix between two polygon layers — areal_weights","title":"Compute area-weighted intersection matrix between two polygon layers — areal_weights","text":"Builds weight matrix maps values source polygons (e.g., census tracts) target polygons (e.g., custom analysis zones) based fraction area shared .","code":""},{"path":"https://antrologos.github.io/interpElections/reference/areal_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute area-weighted intersection matrix between two polygon layers — areal_weights","text":"","code":"areal_weights(target_sf, source_sf, target_id = \"id\", source_id = \"id\")"},{"path":"https://antrologos.github.io/interpElections/reference/areal_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute area-weighted intersection matrix between two polygon layers — areal_weights","text":"target_sf sf object polygon geometries. target zones aggregate . source_sf sf object polygon geometries. source zones (e.g., census tracts interpolated data). target_id Character. Name ID column target_sf. source_id Character. Name ID column source_sf.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/areal_weights.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute area-weighted intersection matrix between two polygon layers — areal_weights","text":"numeric matrix [n_target x n_source]. column standardized weights target zones sum 1 (0 source zone overlap). Row names = target IDs, column names = source IDs.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/areal_weights.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute area-weighted intersection matrix between two polygon layers — areal_weights","text":"Requires sf package. Geometries made valid sf::st_make_valid() computing intersections.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/as.data.frame.interpElections_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert result to data frame — as.data.frame.interpElections_result","title":"Convert result to data frame — as.data.frame.interpElections_result","text":"Drops geometry tracts_sf returns plain data frame census tract IDs interpolated values.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/as.data.frame.interpElections_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert result to data frame — as.data.frame.interpElections_result","text":"","code":"# S3 method for class 'interpElections_result' as.data.frame(x, ...)"},{"path":"https://antrologos.github.io/interpElections/reference/as.data.frame.interpElections_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert result to data frame — as.data.frame.interpElections_result","text":"x interpElections_result object. ... Ignored.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/as.data.frame.interpElections_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert result to data frame — as.data.frame.interpElections_result","text":"data frame.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_geocode.html","id":null,"dir":"Reference","previous_headings":"","what":"Download geocoded polling station data from TSE — br_download_geocode","title":"Download geocoded polling station data from TSE — br_download_geocode","text":"Downloads official polling station location data (eleitorado por local de votação) TSE open data portal. file includes geographic coordinates (NR_LATITUDE, NR_LONGITUDE) polling locations, along voter counts addresses.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_geocode.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download geocoded polling station data from TSE — br_download_geocode","text":"","code":"br_download_geocode(   year,   uf = NULL,   code_muni_tse = NULL,   force = FALSE,   cache = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/br_download_geocode.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download geocoded polling station data from TSE — br_download_geocode","text":"year Integer. Election year (e.g., 2010, 2012, 2016, 2020). uf Character NULL. Two-letter state abbreviation. provided, filters results state. code_muni_tse Character NULL. 5-digit TSE municipality code. provided, filters results municipality . force Logical. Re-download even cached file exists. Default: FALSE. cache Logical. TRUE (default), downloaded files stored persistently. See get_interpElections_cache_dir(). verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_geocode.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download geocoded polling station data from TSE — br_download_geocode","text":"data frame one row per section per round, using original TSE column names. Returns NULL data available given year (e.g., 2010). Key columns: CD_MUNICIPIO TSE municipality code (5-digit) NR_ZONA Electoral zone number NR_LOCAL_VOTACAO Polling location number NR_SECAO Section number NR_LATITUDE Latitude polling location (-1 missing) NR_LONGITUDE Longitude polling location (-1 missing) NM_LOCAL_VOTACAO Name polling location DS_ENDERECO Address polling location","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_geocode.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download geocoded polling station data from TSE — br_download_geocode","text":"TSE data available 2010 onward. years 2010 (e.g., 2008), function returns NULL caller can fall back alternative sources. Data downloaded https://cdn.tse.jus.br/estatistica/sead/odsele/eleitorado_locais_votacao/. Files cached persistently default reused subsequent calls unless force = TRUE. Use interpElections_cache() manage cached files. CSV files use semicolon (;) delimiter Latin-1 encoding. Missing coordinates stored -1 TSE data.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_download_party_legends.html","id":null,"dir":"Reference","previous_headings":"","what":"Download party legends from TSE — br_download_party_legends","title":"Download party legends from TSE — br_download_party_legends","text":"Downloads official party legend data (consulta de legendas) TSE open data portal given election year. file maps party numbers (NR_PARTIDO) abbreviations (SG_PARTIDO) full names (NM_PARTIDO).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_party_legends.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download party legends from TSE — br_download_party_legends","text":"","code":"br_download_party_legends(year, force = FALSE, cache = TRUE, verbose = TRUE)"},{"path":"https://antrologos.github.io/interpElections/reference/br_download_party_legends.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download party legends from TSE — br_download_party_legends","text":"year Integer. Election year (e.g., 2008, 2012, 2016, 2020, 2022). force Logical. Re-download even cached file exists. Default: FALSE. cache Logical. TRUE (default), downloaded files stored persistently. See get_interpElections_cache_dir(). verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_party_legends.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download party legends from TSE — br_download_party_legends","text":"data frame TSE party/coalition data. Key columns: NR_PARTIDO Party number (2-digit) SG_PARTIDO Party abbreviation (e.g., \"PT\", \"MDB\") NM_PARTIDO Full party name","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_party_legends.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download party legends from TSE — br_download_party_legends","text":"Data downloaded https://cdn.tse.jus.br/estatistica/sead/odsele/consulta_coligacao/. file contains coalition/party records election year, unique party number--abbreviation mapping extracted. Files cached persistently default reused subsequent calls unless force = TRUE.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_download_turnout.html","id":null,"dir":"Reference","previous_headings":"","what":"Download turnout/attendance data from TSE — br_download_turnout","title":"Download turnout/attendance data from TSE — br_download_turnout","text":"Downloads official turnout detail data (detalhe da votação por seção) TSE open data portal. file provides attendance counts, abstentions, vote type breakdowns per polling section.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_turnout.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download turnout/attendance data from TSE — br_download_turnout","text":"","code":"br_download_turnout(   year,   uf = NULL,   code_muni_tse = NULL,   cargo = NULL,   turno = 1L,   force = FALSE,   cache = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/br_download_turnout.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download turnout/attendance data from TSE — br_download_turnout","text":"year Integer. Election year (e.g., 2008, 2012, 2016, 2020). uf Character NULL. Two-letter state abbreviation. Used filter nationwide file single state. code_muni_tse Character NULL. 5-digit TSE municipality code. provided, filters results municipality . cargo Integer NULL. Electoral office code filter. NULL, uses office (turnout across offices). turno Integer. Election round (1 2). Default: 1. force Logical. Re-download even cached file exists. Default: FALSE. cache Logical. TRUE (default), downloaded files stored persistently. See get_interpElections_cache_dir(). verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_turnout.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download turnout/attendance data from TSE — br_download_turnout","text":"data frame one row per section per office, using original TSE column names. Key columns: ANO_ELEICAO Election year CD_MUNICIPIO TSE municipality code (5-digit) NR_ZONA Electoral zone number NR_SECAO Section number CD_CARGO Office code QT_COMPARECIMENTO Number voters attended QT_APTOS Number eligible voters QT_ABSTENCOES Number abstentions","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_turnout.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download turnout/attendance data from TSE — br_download_turnout","text":"TSE publishes data single nationwide file https://cdn.tse.jus.br/estatistica/sead/odsele/detalhe_votacao_secao/. file can large (hundreds MB). Results filtered municipality /state immediately reading.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_download_votes.html","id":null,"dir":"Reference","previous_headings":"","what":"Download candidate vote data from TSE — br_download_votes","title":"Download candidate vote data from TSE — br_download_votes","text":"Downloads official candidate vote data (votação por seção eleitoral) TSE open data portal given election year state. data downloaded ZIP file containing semicolon-delimited CSV.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_votes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download candidate vote data from TSE — br_download_votes","text":"","code":"br_download_votes(   year,   uf,   code_muni_tse = NULL,   cargo = NULL,   turno = 1L,   force = FALSE,   cache = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/br_download_votes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download candidate vote data from TSE — br_download_votes","text":"year Integer. Election year (e.g., 2008, 2012, 2016, 2020). uf Character. Two-letter state abbreviation (e.g., \"SP\", \"RJ\"), \"BR\" download national file (used presidential data). code_muni_tse Character NULL. 5-digit TSE municipality code. provided, filters results municipality . cargo Integer NULL. Electoral office code filter (e.g., 13 = Vereador, 11 = Prefeito). NULL, returns offices. turno Integer. Election round (1 2). Default: 1. force Logical. Re-download even cached file exists. Default: FALSE. cache Logical. TRUE (default), downloaded files stored persistent cross-session cache directory (see get_interpElections_cache_dir()). FALSE, files stored temporary directory lost R restarts. verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_votes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download candidate vote data from TSE — br_download_votes","text":"data frame one row per candidate per polling section, using original TSE column names. Key columns: ANO_ELEICAO Election year CD_MUNICIPIO TSE municipality code (5-digit) NR_ZONA Electoral zone number NR_SECAO Section number NR_LOCAL_VOTACAO Polling location number CD_CARGO Office code NR_VOTAVEL Candidate number (95 = blank, 96 = null) NM_VOTAVEL Candidate name QT_VOTOS Number votes","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_download_votes.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download candidate vote data from TSE — br_download_votes","text":"Data downloaded https://cdn.tse.jus.br/estatistica/sead/odsele/votacao_secao/. Files cached persistently default reused subsequent calls unless force = TRUE. Use interpElections_cache() manage cached files. CSV files use semicolon (;) delimiter Latin-1 encoding. Note: general elections, presidential vote data (cargo 1) published national file (uf = \"BR\") rather per-state files. br_prepare_electoral() handles automatically.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":null,"dir":"Reference","previous_headings":"","what":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"Downloads TSE voter profile, attendance, candidate vote data, merges geocoded polling station coordinates, aggregates voting-location level. Returns data frame ready interpolation.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"","code":"br_prepare_electoral(   code_muni_ibge,   code_muni_tse,   uf,   year,   cargo = NULL,   turno = 1L,   what = \"candidates\",   candidates = NULL,   parties = NULL,   perfil_path = NULL,   comparecimento_path = NULL,   votacao_path = NULL,   geocode_path = NULL,   cache = TRUE,   force = FALSE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"code_muni_ibge Character. 7-digit IBGE municipality code (e.g., \"3550308\" Sao Paulo). code_muni_tse Character. 5-digit TSE municipality code (e.g., \"71072\" Sao Paulo). Typically obtained via interpolate_election_br(), resolves automatically. uf Character. Two-letter state abbreviation (e.g., \"SP\", \"RJ\", \"MG\"). year Integer. Election year. See interpolate_election_br() distinction municipal general election years. cargo Integer, character, NULL. electoral office(s) include. Accepts human-readable aliases (case-insensitive), TSE numeric codes, vector either: NULL (default), offices present data file included. general election years, automatically downloads national file presidential data. multiple cargos selected, output columns prefixed (e.g., PREFEITO_CAND_*, VEREADOR_CAND_*). turno Integer. Election round: 1 (first round, default) 2 (runoff). runoff exists presidente, governador, prefeito (cities >200k voters), candidate wins outright first round. Character vector. Controls data columns produced output. One : \"candidates\" (default): One column per candidate vote counts, named CAND_<ballot_number>. Also includes QT_COMPARECIMENTO (total turnout). Special ballot numbers: 95 = blank votes (em branco), 96 = null votes (nulo). \"parties\": One column per party total votes, named PARTY_<abbreviation> (e.g., PARTY_PT, PARTY_MDB). Also includes QT_COMPARECIMENTO. \"turnout\": Turnout statistics: QT_COMPARECIMENTO (voters showed ), QT_APTOS (eligible voters), QT_ABSTENCOES (abstentions), available data. \"demographics\": Voter profile gender (GENERO_FEMININO, GENERO_MASCULINO, GENERO_NAO_INFORMADO) education level (EDUC_ANALFABETO, EDUC_LE_ESCREVE, EDUC_FUND_INCOMP, EDUC_FUND_COMP, EDUC_MEDIO_INCOMP, EDUC_MEDIO_COMP, EDUC_SUP_INCOMP, EDUC_SUP_COMP, EDUC_NAO_INFORMADO). Note: demographics come voter registration profile, vote data, cargo filter applies. Values can combined: = c(\"candidates\", \"parties\", \"turnout\", \"demographics\"). candidates Character numeric vector, NULL. Filter specific candidates (applies \"candidates\" %% ): Numeric values match candidate's ballot number exactly. Example: candidates = c(13, 22). Character values perform accent-normalized, case-insensitive substring matching candidate's registered name. Example: candidates = \"LULA\" matches \"LUIZ INACIO LULA DA SILVA\". NULL (default): candidates kept. parties Character vector NULL. Filter specific parties (applies \"parties\" %% ). Uses official TSE party abbreviations, matched case-insensitively. Example: parties = c(\"PT\", \"PL\", \"MDB\"). NULL (default): parties kept. perfil_path Character NULL. Path local voter profile CSV file. NULL (default), downloads TSE. comparecimento_path Character NULL. Path attendance parquet file. NULL (default), turnout computed vote data . votacao_path Character NULL. Path candidate votes parquet file. NULL (default), downloads TSE. geocode_path Character NULL. Path CSV geocoded polling station coordinates (columns: nr_zona, nr_local_votacao, lat, long). NULL, coordinates obtained TSE Danny Hidalgo's geocoding project. cache Logical. TRUE (default), downloaded files stored persistently. See get_interpElections_cache_dir(). force Logical. Re-download even cached file exists. Default: FALSE. verbose Logical. Print progress messages. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"data frame one row per voting location (per polling section). Contains following column groups: Always present: lat, long: Coordinates voting location. id: Sequential integer ID. votantes_18_20, ..., votantes_65_69: Registered voters per age bracket location (used calibration data). Conditional : \"candidates\": CAND_<number> columns + QT_COMPARECIMENTO. \"parties\": PARTY_<abbrev> columns + QT_COMPARECIMENTO. \"turnout\": QT_COMPARECIMENTO, QT_APTOS, QT_ABSTENCOES. \"demographics\": GENERO_* EDUC_* columns. multiple cargo values selected, candidate party columns prefixed (e.g., PREFEITO_CAND_45, VEREADOR_PARTY_PT).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"users use interpolate_election_br() instead, calls function internally runs full interpolation pipeline. Use br_prepare_electoral() directly need raw polling-location data without interpolation. votacao_path comparecimento_path NULL, data auto-downloaded official TSE open data portal using br_download_votes() br_download_turnout().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"data-sources","dir":"Reference","previous_headings":"","what":"Data sources","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"data downloaded TSE open data portal https://cdn.tse.jus.br/estatistica/sead/odsele/. Presidential vote data (cargo 1) published separate national file (votacao_secao_<year>_BR.zip, ~250 MB) rather per-state files. function detects presidential data needed downloads national file automatically. Geocoded polling station coordinates come two sources: official TSE data (available ~2020 onwards, missing coordinates) Danny Hidalgo's geocoding project (https://github.com/fdhidalgo/geocode_br_polling_stations), covers earlier years. TSE coordinates take priority available.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"dependencies","dir":"Reference","previous_headings":"","what":"Dependencies","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"Requires dplyr, tidyr, data.table, stringr packages. reading local parquet files, arrow package also required.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_electoral.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Prepare Brazilian electoral data at the polling-location level — br_prepare_electoral","text":"","code":"if (FALSE) { # \\dontrun{ # ── Basic usage ──────────────────────────────────────────────── # All candidates in the 2020 municipal election for Boa Vista elec <- br_prepare_electoral(   code_muni_ibge = \"1400100\",   code_muni_tse  = \"01120\",   uf = \"RR\",   year = 2020,   what = c(\"candidates\", \"turnout\") )  # ── Specific cargo ───────────────────────────────────────────── # Only the presidential race in 2022 elec <- br_prepare_electoral(   code_muni_ibge = \"3170701\",   code_muni_tse  = \"54135\",   uf = \"MG\",   year = 2022,   cargo = \"presidente\" )  # ── Filter specific candidates ───────────────────────────────── # Only Lula and Bolsonaro in the 2022 presidential race elec <- br_prepare_electoral(   code_muni_ibge = \"3170701\",   code_muni_tse  = \"54135\",   uf = \"MG\",   year = 2022,   cargo = \"presidente\",   candidates = c(13, 22) )  # ── Party vote totals ────────────────────────────────────────── elec <- br_prepare_electoral(   code_muni_ibge = \"3170701\",   code_muni_tse  = \"54135\",   uf = \"MG\",   year = 2020,   cargo = \"vereador\",   what = \"parties\",   parties = c(\"PT\", \"MDB\", \"PL\") )  # ── Voter demographics ───────────────────────────────────────── elec <- br_prepare_electoral(   code_muni_ibge = \"3170701\",   code_muni_tse  = \"54135\",   uf = \"MG\",   year = 2022,   what = \"demographics\" ) # -> GENERO_FEMININO, GENERO_MASCULINO, EDUC_SUP_COMP, ... } # }"},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_population.html","id":null,"dir":"Reference","previous_headings":"","what":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","title":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","text":"Downloads census population data IBGE (via censobr package), groups ages brackets, returns data frame one row per census tract. Supports census years 2000, 2010, 2022.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_population.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","text":"","code":"br_prepare_population(code_muni, year = 2010)"},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_population.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","text":"code_muni Numeric character vector. IBGE municipality codes. year Integer. Census year: 2000, 2010, 2022. Default: 2010.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_population.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","text":"data frame columns: code_muni, code_tract, population bracket columns (pop_*). exact brackets depend census year (see Details).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_population.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","text":"Requires censobr, dplyr, tidyr, data.table packages. Census 2000 2010 produce following voting-age brackets: pop_18_20, pop_21_24, pop_25_29, pop_30_39, pop_40_49, pop_50_59, pop_60_69. Census 2022 produces: pop_15_19, pop_20_24, pop_25_29, pop_30_39, pop_40_49, pop_50_59, pop_60_69. years also produce: pop_00_04, pop_05_09, pop_10_14, pop_15_17 (pop_15_19 2022), pop_70mais.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_population.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Prepare Brazilian census population data by age bracket per census tract — br_prepare_population","text":"","code":"if (FALSE) { # \\dontrun{ # Census 2010 population for Sao Paulo pop <- br_prepare_population(code_muni = \"3550308\", year = 2010) head(pop) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_tracts.html","id":null,"dir":"Reference","previous_headings":"","what":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","title":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","text":"Downloads census tract geometries via geobr, joins population data br_prepare_population(), optionally clips urban area mask, removes unpopulated tracts.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_tracts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","text":"","code":"br_prepare_tracts(   code_muni,   pop_data,   remove_unpopulated = TRUE,   clip_sf = NULL,   year = 2010,   crs = \"EPSG:5880\",   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_tracts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","text":"code_muni Numeric character. IBGE municipality code. pop_data Data frame. Output br_prepare_population(). Must contain code_tract population bracket columns. remove_unpopulated Logical. Remove tracts pop_total == 0. Default: TRUE. clip_sf Optional sf polygon object. provided, census tracts clipped geometry (e.g., remove non-urban areas like parks, forests, water bodies). Population proportionally adjusted based fraction area retained. year Integer. Census tract geometry year. Default: 2010. crs Character integer. CRS output. Default: SIRGAS 2000 / Brazil Polyconic (EPSG:5880). verbose Logical. Print progress messages. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_tracts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","text":"sf object census tract polygons columns: code_tract, pop_* bracket columns pop_data, pop_total (sum brackets).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_tracts.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","text":"Requires geobr, sf, dplyr packages.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/br_prepare_tracts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Prepare census tract shapefiles with population data for a Brazilian municipality — br_prepare_tracts","text":"","code":"if (FALSE) { # \\dontrun{ pop <- br_prepare_population(\"3550308\", year = 2010) tracts <- br_prepare_tracts(\"3550308\", pop) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/check_r5r.html","id":null,"dir":"Reference","previous_headings":"","what":"Check r5r and Java 21 setup — check_r5r","title":"Check r5r and Java 21 setup — check_r5r","text":"Runs diagnostic check r5r dependency chain: whether r5r package installed whether suitable Java/JDK (version 21+) available system.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/check_r5r.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check r5r and Java 21 setup — check_r5r","text":"","code":"check_r5r()"},{"path":"https://antrologos.github.io/interpElections/reference/check_r5r.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check r5r and Java 21 setup — check_r5r","text":"Invisibly, list components: r5r_installed Logical. java_found Logical. java_version Integer major version, NA. java_sufficient Logical. TRUE version >= 21. java_memory Character NULL. Configured JVM max heap (e.g. \"4g\"). system_ram Character NULL. Total system RAM (e.g. \"16 GB\"). ready Logical. TRUE checks pass.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/check_r5r.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check r5r and Java 21 setup — check_r5r","text":"","code":"check_r5r() #> [ok] r5r package installed (v2.3.0) #> [!!] Java 17 found, but r5r requires >= 21 #> [--] Java max heap: not configured (JVM default, typically 256m) #>      Set with: interpElections::set_java_memory(\"4g\") #>      System RAM: 15.6 GB #>  #> Some checks failed. #> Run interpElections::setup_java() to download and install Java 21."},{"path":"https://antrologos.github.io/interpElections/reference/check_torch.html","id":null,"dir":"Reference","previous_headings":"","what":"Check torch and GPU setup — check_torch","title":"Check torch and GPU setup — check_torch","text":"Runs comprehensive diagnostic torch dependency chain: whether torch R package installed, whether libtorch/lantern binaries present, GPU hardware available, whether CUDA MPS acceleration actually working.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/check_torch.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check torch and GPU setup — check_torch","text":"","code":"check_torch(verbose = TRUE)"},{"path":"https://antrologos.github.io/interpElections/reference/check_torch.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check torch and GPU setup — check_torch","text":"verbose Logical. Print diagnostic messages. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/check_torch.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check torch and GPU setup — check_torch","text":"Invisibly, list components: torch_installed Logical. torch R package installed? torch_version Character NA. torch package version. binaries_installed Logical. libtorch/lantern binaries present? gpu_hardware Character. \"nvidia\", \"apple_silicon\", \"none\". gpu_name Character NA. GPU name hardware detection. gpu_vram Character NA. VRAM MB (NVIDIA ). cuda_available Logical. torch report CUDA available? cuda_runtime Character NA. CUDA runtime version. cuda_compute Character NA. GPU compute capability. cudnn_available Logical. mps_available Logical. MPS available (Apple Silicon)? tensor_test Logical. Can tensor created GPU? device Character. Best available device: \"cuda\", \"mps\", \"cpu\". ready Logical. TRUE GPU acceleration fully working.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/check_torch.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check torch and GPU setup — check_torch","text":"","code":"if (FALSE) { # \\dontrun{ check_torch() } # }"},{"path":"https://antrologos.github.io/interpElections/reference/coef.interpElections_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract alpha coefficients — coef.interpElections_result","title":"Extract alpha coefficients — coef.interpElections_result","text":"Returns alpha decay parameter vector, plays role \"coefficients\" IDW model.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/coef.interpElections_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract alpha coefficients — coef.interpElections_result","text":"","code":"# S3 method for class 'interpElections_result' coef(object, ...)"},{"path":"https://antrologos.github.io/interpElections/reference/coef.interpElections_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract alpha coefficients — coef.interpElections_result","text":"object interpElections_result object. ... Ignored.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/coef.interpElections_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract alpha coefficients — coef.interpElections_result","text":"Numeric vector length n (one alpha per census tract).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_representative_points.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute representative points for census tracts — compute_representative_points","title":"Compute representative points for census tracts — compute_representative_points","text":"Computes single representative point census tract polygon. Three methods available: geometric point--surface (default), centroid, population-density-weighted using WorldPop raster data.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_representative_points.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute representative points for census tracts — compute_representative_points","text":"","code":"compute_representative_points(   tracts_sf,   method = c(\"point_on_surface\", \"centroid\", \"pop_weighted\"),   pop_raster = NULL,   pop_min_area = 1,   tract_id = \"id\",   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/compute_representative_points.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute representative points for census tracts — compute_representative_points","text":"tracts_sf sf polygon object containing census tract geometries. method Character. Method computing representative points: \"point_on_surface\" (Default) Uses sf::st_point_on_surface(). Guarantees point falls inside polygon, unlike centroids can fall outside concave shapes. \"centroid\" Uses sf::st_centroid(). Classic geometric centroid. May fall outside concave polygons. \"pop_weighted\" Uses population density raster (WorldPop Constrained 2020 default) find populated cell within tract. applied tracts area >= pop_min_area; smaller tracts use point_on_surface. Requires terra package. pop_raster terra::SpatRaster object, file path GeoTIFF, NULL. Population density raster method = \"pop_weighted\". NULL (default), WorldPop Brazil Constrained 2020 raster (~48 MB) downloaded automatically cached. Ignored methods. pop_min_area Numeric. Minimum tract area km² applying population-weighted method. Tracts smaller threshold use point_on_surface instead. Default: 1 (km²). used method = \"pop_weighted\". tract_id Character. Name ID column tracts_sf. Default: \"id\". verbose Logical. Print progress messages? Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_representative_points.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute representative points for census tracts — compute_representative_points","text":"sf POINT object WGS84 (EPSG:4326) one row per tract, preserving tract_id column. Carries attribute \"point_method\" recording method used.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_representative_points.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute representative points for census tracts — compute_representative_points","text":"","code":"if (FALSE) { # \\dontrun{ tracts <- br_prepare_tracts(code_muni = 3170701) tracts$id <- tracts$code_tract  # Default: point on surface pts <- compute_representative_points(tracts)  # Population-weighted for large tracts pts_pop <- compute_representative_points(tracts, method = \"pop_weighted\") } # }"},{"path":"https://antrologos.github.io/interpElections/reference/compute_travel_times.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","title":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","text":"Builds travel-time matrix using r5r routing engine. Computes travel times representative points target census tracts geolocated source points (e.g., polling locations).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_travel_times.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","text":"","code":"compute_travel_times(   tracts_sf,   points_sf,   network_path,   tract_id = \"id\",   point_id = \"id\",   point_method = \"point_on_surface\",   pop_raster = NULL,   pop_min_area = 1,   mode = \"WALK\",   max_trip_duration = 300L,   fill_missing = max_trip_duration,   n_threads = 4L,   departure_datetime = NULL,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/compute_travel_times.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","text":"tracts_sf sf object polygon geometries. Target census tracts. points_sf sf object point geometries. Source points. network_path Character. Path directory containing OSM .pbf file building r5r network. tract_id Character. Name ID column tracts_sf. Default: \"id\". point_id Character. Name ID column points_sf. Default: \"id\". point_method Character. Method computing representative points census tracts. One \"point_on_surface\" (default), \"centroid\", \"pop_weighted\". See compute_representative_points() details. pop_raster terra::SpatRaster object, file path GeoTIFF, NULL. Population density raster point_method = \"pop_weighted\". NULL, WorldPop data auto-downloaded. Ignored methods. pop_min_area Numeric. Minimum tract area km² applying population-weighted method. Default: 1. mode Character. Routing mode. Default: \"WALK\". max_trip_duration Integer. Maximum trip duration minutes. Default: 300. fill_missing Numeric. Value fill unreachable origin-destination pairs. Default: max_trip_duration. n_threads Integer. Number r5r routing threads. Default: 4. departure_datetime POSIXct NULL. Departure time transit-based routing. Required mode includes transit components. Default: NULL (ignored WALK/BICYCLE modes). verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_travel_times.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","text":"numeric matrix [n_tracts x n_points]. Travel times minutes. Row names = census tract IDs, column names = point IDs. Unreachable pairs filled fill_missing.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/compute_travel_times.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","text":"Requires r5r sf packages. r5r requires Java/JDK 21+. Use download_r5r_data() obtain OSM data needed network_path.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/compute_travel_times.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute a travel-time matrix from census tract representative points to source points — compute_travel_times","text":"","code":"if (FALSE) { # \\dontrun{ tt <- compute_travel_times(   tracts_sf = tracts, points_sf = stations,   network_path = \"path/to/osm_data\",   tract_id = \"code_tract\", point_id = \"id\" ) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/download_r5r_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Download OSM and elevation data for r5r routing — download_r5r_data","title":"Download OSM and elevation data for r5r routing — download_r5r_data","text":"Downloads OpenStreetMap road network (.pbf file) optionally satellite elevation data needed build r5r routing network. output directory can passed directly compute_travel_times() network_path.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/download_r5r_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download OSM and elevation data for r5r routing — download_r5r_data","text":"","code":"download_r5r_data(   area_sf,   output_dir,   osm = TRUE,   elevation = FALSE,   osm_provider = \"geofabrik\",   force = FALSE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/download_r5r_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download OSM and elevation data for r5r routing — download_r5r_data","text":"area_sf sf object defining area interest. bounding box used select appropriate OSM extract clip downloaded file. output_dir Character. Directory save downloaded files. Created exist. osm Logical. Download OpenStreetMap road network. Default: TRUE. elevation Logical. Download elevation raster accurate walking/cycling routing hilly terrain. Default: FALSE. osm_provider Character. OSM extract provider osmextract. Default: \"geofabrik\". Alternatives: \"bbbike\", \"openstreetmap_fr\". force Logical. Re-download even files already exist. Default: FALSE. verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/download_r5r_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download OSM and elevation data for r5r routing — download_r5r_data","text":"list paths downloaded files: osm_pbf Character. Path OSM .pbf file (NULL osm = FALSE). elevation_tif Character. Path elevation .tif file (NULL elevation = FALSE). output_dir Character. output directory path.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/download_r5r_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download OSM and elevation data for r5r routing — download_r5r_data","text":"downloading provider extract (may cover whole state), .pbf file clipped bounding box area_sf using osmium osmconvert (available system). avoids r5r's geographic extent limit (~975,000 km2). Requires osmextract package OSM downloads optionally elevatr package elevation data. suggested dependencies package. clipping large OSM extracts, osmium-tool (recommended) osmconvert must installed. neither found, function interactively offer install one via setup_osmium() proceeding. non-interactive mode, stops actionable error message. dependency checks (R packages clipping tools) run start, downloads begin.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/get_interpElections_cache_dir.html","id":null,"dir":"Reference","previous_headings":"","what":"Get the interpElections cache directory — get_interpElections_cache_dir","title":"Get the interpElections cache directory — get_interpElections_cache_dir","text":"Returns path directory interpElections stores cached downloaded files (TSE data, Hidalgo geocoding, travel time matrices, etc.). default location OS-appropriate (via tools::R_user_dir()). custom path can set set_interpElections_cache_dir().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/get_interpElections_cache_dir.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get the interpElections cache directory — get_interpElections_cache_dir","text":"","code":"get_interpElections_cache_dir()"},{"path":"https://antrologos.github.io/interpElections/reference/get_interpElections_cache_dir.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get the interpElections cache directory — get_interpElections_cache_dir","text":"Character. Path cache directory.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/interpElections-package.html","id":null,"dir":"Reference","previous_headings":"","what":"interpElections: Spatial Interpolation of Electoral Data via Inverse Distance Weighting — interpElections-package","title":"interpElections: Spatial Interpolation of Electoral Data via Inverse Distance Weighting — interpElections-package","text":"Spatial interpolation electoral data via inverse distance weighting Sinkhorn-balanced weights per-census-tract optimized decay parameters. Designed disaggregating voting results polling locations census tracts using travel-time-based IDW. Optimization uses torch autograd (ADAM) CPU GPU.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/interpElections-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"interpElections: Spatial Interpolation of Electoral Data via Inverse Distance Weighting — interpElections-package","text":"Maintainer: Rogerio Barbosa rogerio.barbosa@iesp.uerj.br Authors: Lucas Gelape","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache.html","id":null,"dir":"Reference","previous_headings":"","what":"Manage the interpElections download cache — interpElections_cache","title":"Manage the interpElections download cache — interpElections_cache","text":"Lists deletes cached files. default shows per-category size breakdown. Use details = TRUE see individual files. Use delete_file = \"\" clear entire cache.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Manage the interpElections download cache — interpElections_cache","text":"","code":"interpElections_cache(   list_files = TRUE,   delete_file = NULL,   details = FALSE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Manage the interpElections download cache — interpElections_cache","text":"list_files Logical. TRUE (default), prints per-category summary returns cached file paths. delete_file Character NULL. pattern match files deletion (matched relative paths via grepl()), \"\" delete entire cache. targeted deletion category, see interpElections_cache_clean(). details Logical. TRUE, also prints individual filenames within category. Default: FALSE. verbose Logical. Print messages. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Manage the interpElections download cache — interpElections_cache","text":"Invisibly returns character vector cached file paths (deletion).","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Manage the interpElections download cache — interpElections_cache","text":"","code":"if (FALSE) { # \\dontrun{ # Per-category summary interpElections_cache()  # Detailed listing (every file) interpElections_cache(details = TRUE)  # Delete files matching a pattern interpElections_cache(delete_file = \"2020\")  # Delete everything interpElections_cache(delete_file = \"all\") } # }"},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache_clean.html","id":null,"dir":"Reference","previous_headings":"","what":"Delete cached files by category — interpElections_cache_clean","title":"Delete cached files by category — interpElections_cache_clean","text":"Convenience function clearing specific categories cached data. discoverable interpElections_cache() delete_file.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache_clean.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Delete cached files by category — interpElections_cache_clean","text":"","code":"interpElections_cache_clean(   category = c(\"all\", \"downloads\", \"processed\", \"networks\", \"travel_times\", \"pop_raster\",     \"votes\", \"turnout\", \"geocode\", \"profile\", \"hidalgo\", \"osm\", \"electoral\", \"tracts\",     \"r5r\"),   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache_clean.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Delete cached files by category — interpElections_cache_clean","text":"category Character. category clear. One : \"\" Delete entire cache \"downloads\" raw downloads (votes, turnout, geocode, profile, hidalgo, osm) \"processed\" processed/cached results (electoral, tracts) \"networks\" r5r network indices \"travel_times\" Cached travel time matrices \"votes\" TSE vote data ZIPs \"turnout\" TSE turnout data ZIPs \"geocode\" TSE polling station location ZIPs \"profile\" TSE voter profile ZIPs \"hidalgo\" Hidalgo geocoding fallback data \"osm\" OpenStreetMap road network extracts \"electoral\" Processed electoral data (br_prepare_electoral output) \"tracts\" Cached census tract geometries \"r5r\" r5r routing network indices verbose Logical. Print messages. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache_clean.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Delete cached files by category — interpElections_cache_clean","text":"Invisibly returns path(s) deleted.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/interpElections_cache_clean.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Delete cached files by category — interpElections_cache_clean","text":"","code":"if (FALSE) { # \\dontrun{ # Clear only processed electoral data (forces re-computation next run) interpElections_cache_clean(\"electoral\")  # Clear all raw downloads interpElections_cache_clean(\"downloads\")  # Clear everything interpElections_cache_clean(\"all\") } # }"},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election.html","id":null,"dir":"Reference","previous_headings":"","what":"One-step IDW interpolation from source points to census tracts — interpolate_election","title":"One-step IDW interpolation from source points to census tracts — interpolate_election","text":"High-level wrapper combines travel-time computation (optional), alpha optimization, interpolation single call. travel time matrix provided, OSM road network data automatically downloaded travel times computed via r5r.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"One-step IDW interpolation from source points to census tracts — interpolate_election","text":"","code":"interpolate_election(   tracts_sf,   electoral_sf,   tract_id,   point_id,   calib_tracts,   calib_sources,   interp_sources = NULL,   time_matrix = NULL,   network_path = NULL,   elevation_path = NULL,   osm_buffer_km = 10,   min_pop = 1,   alpha = NULL,   offset = 1,   keep = NULL,   use_gpu = NULL,   verbose = TRUE,   ...,   .step_offset = 0L,   .step_total = NULL )"},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"One-step IDW interpolation from source points to census tracts — interpolate_election","text":"tracts_sf sf polygon object. Target census tracts. electoral_sf sf point object. Source points (e.g., voting locations). tract_id Character. Name ID column tracts_sf. point_id Character. Name ID column electoral_sf. calib_tracts Character vector. Column names tracts_sf use calibration population matrix. Must match calib_sources length. calib_sources Character vector. Column names electoral_sf use source calibration matrix. Must match calib_tracts length. interp_sources Character vector NULL. Column names electoral_sf interpolate. Default NULL means numeric columns calib_sources. time_matrix Numeric matrix [n x m] NULL. Pre-computed travel times. provided, skips travel time computation. network_path Character NULL. Path directory OSM .pbf file. provided (time_matrix NULL), travel times computed directly without downloading OSM data. elevation_path Character NULL. Path elevation .tif file r5r routing. osm_buffer_km Numeric. Buffer kilometers expand bounding box auto-downloading OSM data. Default: 10. min_pop Numeric. Minimum total population calib_tracts census tract included. Default: 1. alpha Numeric vector length n, NULL. Pre-computed decay parameters. provided, optimization skipped. offset Numeric. Travel time offset. Default: 1. keep Character vector NULL. Names heavy intermediate objects include result. Default NULL (lightweight). Options: \"weights\" (column-standardized weight matrix [n x m]), \"time_matrix\" (travel time matrix [n x m]), \"sources_sf\" (source points sf object geometry), \"pop_raster\" (population density raster, point_method = \"pop_weighted\"), \"rep_points\" (representative points sf object used routing). can large big municipalities. Travel times cached disk can reloaded without keeping memory. use_gpu Logical NULL. Passed optimize_alpha(). verbose Logical. Print progress. Default: TRUE. ... Additional arguments forwarded optimize_alpha(), compute_travel_times(), /download_r5r_data(). Notable forwarded arguments: point_method (representative point method), pop_raster (population density raster), pop_min_area (area threshold pop-weighted points). See compute_travel_times() details. .step_offset Integer. Internal: offset added step numbers called interpolate_election_br(). set manually. .step_total Integer NULL. Internal: total step count unified progress display. set manually.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"One-step IDW interpolation from source points to census tracts — interpolate_election","text":"list class \"interpElections_result\" components: interpolated Numeric matrix [n x p]. Interpolated values. alpha Numeric vector length n. Decay parameters used. tracts_sf sf object interpolated columns joined census tracts. sources Data frame (geometry) source point data. optimization interpElections_optim object, NULL alpha pre-supplied. offset Numeric. Offset value used. call matched call. tract_id Character. Name census tract ID column. point_id Character. Name ID column sources. interp_cols Character vector. Names interpolated columns. calib_cols List $tracts $sources calibration columns. weights Numeric matrix [n x m] NULL. Present keep includes \"weights\". time_matrix Numeric matrix [n x m] NULL. Present keep includes \"time_matrix\". sources_sf sf point object NULL. Source points geometry. Present keep includes \"sources_sf\". pop_raster terra::SpatRaster NULL. Population density raster (cropped municipality). Present keep includes \"pop_raster\" point_method = \"pop_weighted\" used. rep_points sf POINT object NULL. Representative points used travel time routing. Present keep includes \"rep_points\".","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"One-step IDW interpolation from source points to census tracts — interpolate_election","text":"","code":"if (FALSE) { # \\dontrun{ # Minimal: sf objects + column names (auto-downloads OSM) result <- interpolate_election(   tracts_sf    = census_tracts,   electoral_sf = voting_stations,   tract_id     = \"code_tract\",   point_id     = \"id\",   calib_tracts  = c(\"pop_18_24\", \"pop_25_34\"),   calib_sources = c(\"voters_18_24\", \"voters_25_34\") )  # With pre-computed travel times (skip r5r) result <- interpolate_election(   tracts_sf    = census_tracts,   electoral_sf = voting_stations,   tract_id     = \"code_tract\",   point_id     = \"id\",   calib_tracts  = c(\"pop_young\", \"pop_old\"),   calib_sources = c(\"voters_young\", \"voters_old\"),   time_matrix  = my_tt_matrix ) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":null,"dir":"Reference","previous_headings":"","what":"One-step interpolation for Brazilian elections — interpolate_election_br","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"High-level wrapper auto-downloads census data, electoral data, tract geometries, OSM road networks, runs full optimization interpolation pipeline. user needs provide IBGE municipality code (name) election year.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"","code":"interpolate_election_br(   code_muni,   uf = NULL,   year,   comparecimento_path = NULL,   votacao_path = NULL,   network_path = NULL,   time_matrix = NULL,   cargo = NULL,   turno = 1L,   what = \"candidates\",   candidates = NULL,   parties = NULL,   interp_sources = NULL,   census_year = NULL,   clip_sf = NULL,   remove_unpopulated = TRUE,   osm_buffer_km = 10,   osm_provider = \"openstreetmap_fr\",   point_method = \"point_on_surface\",   pop_raster = NULL,   pop_min_area = 1,   keep = NULL,   alpha = NULL,   offset = 1,   use_gpu = NULL,   cache = TRUE,   force = FALSE,   verbose = TRUE,   ... )"},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"code_muni Numeric character. Either 7-digit IBGE municipality code (e.g., 3550308 Sao Paulo) municipality name (e.g., \"Sao Paulo\", \"SAO PAULO\", \"São Paulo\"). Name matching case-insensitive, accent-insensitive, whitespace-trimmed. name exists multiple states, use uf parameter disambiguate. TSE code state abbreviation resolved automatically bundled muni_crosswalk table. uf Character NULL. Two-letter state abbreviation (e.g., \"SP\", \"RJ\") disambiguation code_muni municipality name exists multiple states. Case-insensitive. Ignored (message) code_muni numeric IBGE code. Default: NULL. year Integer. Election year. Brazil holds two types elections: Municipal (even years divisible 4): 2000, 2004, 2008, 2012, 2016, 2020, 2024. Offices: prefeito, vereador. General/federal (even years divisible 4): 2002, 2006, 2010, 2014, 2018, 2022. Offices: presidente, governador, senador, deputado federal, deputado estadual. comparecimento_path Character NULL. Path attendance/turnout parquet file. NULL (default), turnout computed vote data . votacao_path Character NULL. Path candidate votes parquet file. NULL (default), vote data auto-downloaded TSE open data portal. network_path Character NULL. Path directory containing OSM .pbf file r5r routing. NULL time_matrix also NULL, OSM data auto-downloaded via download_r5r_data(). time_matrix Numeric matrix NULL. Pre-computed travel time matrix [n x m]. provided, skips travel time computation (r5r, OSM download). Useful re-running different parameters municipality. cargo Integer, character, NULL. electoral office(s) include. Accepts one human-readable aliases (case-insensitive) TSE numeric codes: NULL (default), offices available election year included. multiple cargos selected, output columns prefixed office name (e.g., PRESIDENTE_CAND_13, GOVERNADOR_CAND_22). turno Integer. Election round: 1 (first round, default) 2 (runoff). first round always exists. second round (turno 2) held presidente, governador, prefeito (cities >200k voters), candidate wins outright majority. turno 2 occur, result contain zero vote rows offices. Character vector. Controls information interpolated census tracts. One : \"candidates\" (default): Vote counts per candidate. Creates one column per candidate, named CAND_<number> (e.g., CAND_13, CAND_22). Also includes QT_COMPARECIMENTO (total turnout). \"parties\": Vote counts aggregated party. Creates one column per party, named PARTY_<abbreviation> (e.g., PARTY_PT, PARTY_PL). Also includes QT_COMPARECIMENTO. \"turnout\": Turnout abstention. Creates QT_COMPARECIMENTO (voters showed ), QT_APTOS (eligible voters), QT_ABSTENCOES (abstentions), available. \"demographics\": Voter profile demographics. Creates GENERO_* columns (e.g., GENERO_FEMININO, GENERO_MASCULINO) EDUC_* columns (e.g., EDUC_SUP_COMP, EDUC_FUND_INCOMP). Multiple values can combined: = c(\"candidates\", \"parties\", \"turnout\", \"demographics\"). candidates Character numeric vector, NULL. Filter specific candidates (used \"candidates\" %% ): number (numeric): Matches candidate's ballot number exactly. Example: candidates = c(13, 22) keeps candidates 13 (Lula) 22 (Bolsonaro) 2022. name (character): Performs accent-normalized, case-insensitive substring matching candidate's registered name. Example: candidates = \"LULA\" matches \"LUIZ INACIO LULA DA SILVA\". NULL (default): candidates included (including special codes 95 = votos em branco, 96 = votos nulos). parties Character vector NULL. Filter specific parties (used \"parties\" %% ). Uses official TSE party abbreviations, matched case-insensitively: Example: parties = c(\"PT\", \"PL\") keeps PT PL. NULL (default): parties included. interp_sources Character vector NULL. Column names electoral data interpolate. Default NULL auto-selects based . Override need fine-grained control columns interpolated. census_year Integer NULL. Census year population data (2000, 2010, 2022). NULL (default), auto-selected based election year: Elections 2000-2004 use Census 2000 Elections 2008-2016 use Census 2010 Elections 2020+ use Census 2022 clip_sf sf polygon NULL. Optional geometry clip tracts (e.g., urban area boundary). Tracts outside polygon removed interpolation. remove_unpopulated Logical. Remove zero-population tracts. Default: TRUE. osm_buffer_km Numeric. Buffer km OSM bounding box expansion. Default: 10. osm_provider Character. OSM extract provider osmextract. Default: \"openstreetmap_fr\" (state-level extracts Brazil). Alternatives: \"geofabrik\", \"bbbike\". used OSM data auto-downloaded (network_path time_matrix provided). point_method Character. Method computing representative points census tracts. One \"point_on_surface\" (default, guaranteed inside polygon), \"centroid\", \"pop_weighted\" (uses WorldPop raster large tracts). See compute_representative_points(). pop_raster terra::SpatRaster, file path, NULL. Population density raster point_method = \"pop_weighted\". NULL, WorldPop Brazil Constrained 2020 (~48 MB) auto-downloaded. pop_min_area Numeric. Minimum tract area (km²) applying population-weighted method. Smaller tracts use point_on_surface. Default: 1. keep Character vector NULL. Names heavy intermediate objects include result. Default NULL (lightweight). Options: \"weights\", \"time_matrix\", \"sources_sf\", \"pop_raster\", \"rep_points\". See interpolate_election() details. alpha Numeric vector NULL. Pre-computed decay parameters (one per tract). provided, optimization step skipped entirely. Useful re-interpolating previously optimized alpha. offset Numeric. Travel time offset. Default: 1. use_gpu Logical NULL. Passed optimize_alpha(). cache Logical. TRUE (default), downloaded files (TSE data, OSM networks, census tracts) stored persistently across R sessions. See get_interpElections_cache_dir(). Subsequent calls reuse cached files, making re-runs much faster. force Logical. Re-download even cached file exists. Default: FALSE. verbose Logical. Default: TRUE. ... Additional arguments forwarded interpolate_election(), optimize_alpha(), compute_travel_times(), /download_r5r_data().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"list class \"interpElections_result\" components: interpolated Numeric matrix [n x p]. Rows = census tracts, columns = interpolated variables. alpha Numeric vector length n. Optimized decay parameters. tracts_sf sf object interpolated columns joined , ready mapping plot() ggplot2. sources Data frame prepared electoral data (one row per voting location), without geometry. optimization interpElections_optim NULL (alpha pre-supplied). offset Numeric. Offset value used. call matched call. tract_id Character. Name census tract ID column. point_id Character. Name source point ID column. interp_cols Character vector. Names interpolated columns. calib_cols List $tracts $sources calibration columns. weights Numeric matrix NULL. Present keep includes \"weights\". time_matrix Numeric matrix NULL. Present keep includes \"time_matrix\". sources_sf sf point object NULL. Present keep includes \"sources_sf\". code_muni IBGE municipality code. year Election year. census_year Census year. Character vector data types interpolated. pop_data Data frame census population tract.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"Internally calls interpolate_election() preparing inputs.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"election-types","dir":"Reference","previous_headings":"","what":"Election types","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"Brazil holds elections every two years, alternating municipal general (federal/state) elections: Municipal elections (2000, 2004, 2008, 2012, 2016, 2020, 2024): elect prefeito (mayor) vereador (city councilor). General elections (2002, 2006, 2010, 2014, 2018, 2022): elect presidente, governador, senador, deputado federal, deputado estadual. Presidential vote data published TSE separate national file (~250 MB). function handles download automatically cargo includes \"presidente\" cargo = NULL general election year.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"output-columns","dir":"Reference","previous_headings":"","what":"Output columns","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"tracts_sf output contains original census tract geometry plus interpolated columns. Column names follow patterns: CAND_<number> Interpolated vote count candidate ballot number <number>. Special numbers: 95 = blank votes (em branco), 96 = null votes (nulo). PARTY_<abbrev> Interpolated total votes party <abbrev> (e.g., PARTY_PT, PARTY_PL). GENERO_<category> Interpolated voter count gender (e.g., GENERO_FEMININO, GENERO_MASCULINO). EDUC_<level> Interpolated voter count education level (e.g., EDUC_SUP_COMP, EDUC_FUND_INCOMP). QT_COMPARECIMENTO Total voters showed . QT_APTOS Total eligible voters (available). QT_ABSTENCOES Total abstentions (available). multiple cargo values selected, candidate party columns prefixed: PRESIDENTE_CAND_13, GOVERNADOR_PARTY_PT, etc.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/interpolate_election_br.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"One-step interpolation for Brazilian elections — interpolate_election_br","text":"","code":"if (FALSE) { # \\dontrun{ # ── Minimal usage ─────────────────────────────────────────────── # Just an IBGE code + year. Everything else is auto-downloaded. result <- interpolate_election_br(   code_muni = 3550308,   # Sao Paulo   year = 2020 )  # The result includes an sf object ready for mapping plot(result$tracts_sf[\"CAND_13\"])   # ── Choosing a specific cargo ─────────────────────────────────── # Municipal election: only city councilors (vereador) result <- interpolate_election_br(   code_muni = 3170701, year = 2020,   cargo = \"vereador\" )  # General election: only the presidential race result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"presidente\" )  # Multiple offices at once (columns are prefixed) result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = c(\"presidente\", \"governador\") ) # -> columns: PRESIDENTE_CAND_13, GOVERNADOR_CAND_30, ...   # ── Turno (election round) ───────────────────────────────────── # First round (default) r1 <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"presidente\", turno = 1 )  # Runoff (second round) -- only 2 candidates r2 <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"presidente\", turno = 2 )   # ── Choosing what to interpolate ─────────────────────────────── # Party vote totals instead of individual candidates result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"governador\",   what = \"parties\" ) # -> columns: PARTY_PT, PARTY_PL, PARTY_MDB, ...  # Voter demographics (gender + education) result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   what = \"demographics\" ) # -> columns: GENERO_FEMININO, EDUC_SUP_COMP, ...  # Turnout and abstention result <- interpolate_election_br(   code_muni = 3170701, year = 2020,   cargo = \"prefeito\",   what = \"turnout\" ) # -> columns: QT_COMPARECIMENTO, QT_APTOS, QT_ABSTENCOES  # Everything at once result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"governador\",   what = c(\"candidates\", \"parties\", \"turnout\", \"demographics\") )   # ── Filtering candidates ─────────────────────────────────────── # By ballot number result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"presidente\",   candidates = c(13, 22) ) # -> only CAND_13 (Lula) and CAND_22 (Bolsonaro)  # By name (accent-insensitive substring search) result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"presidente\",   candidates = \"LULA\" ) # -> matches \"LUIZ INACIO LULA DA SILVA\"   # ── Filtering parties ────────────────────────────────────────── result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"presidente\",   what = \"parties\",   parties = c(\"PT\", \"PL\") ) # -> only PARTY_PT and PARTY_PL   # ── Re-using a previous result ───────────────────────────────── # Keep the time_matrix for reuse (opt-in via keep) result <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"governador\",   keep = \"time_matrix\" )  # Then reuse the alpha and travel time matrix result2 <- interpolate_election_br(   code_muni = 3170701, year = 2022,   cargo = \"governador\",   what = \"parties\",   time_matrix = result$time_matrix,   alpha = result$alpha )   # ── Pre-computed travel times (skip r5r) ─────────────────────── result <- interpolate_election_br(   code_muni = 3550308, year = 2020,   time_matrix = my_tt_matrix ) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/muni_crosswalk.html","id":null,"dir":"Reference","previous_headings":"","what":"IBGE-TSE Municipality Code Crosswalk — muni_crosswalk","title":"IBGE-TSE Municipality Code Crosswalk — muni_crosswalk","text":"Official crosswalk table mapping IBGE 7-digit municipality codes TSE 5-digit electoral codes 5,710 Brazilian municipalities. Sourced GV-CEPESP.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/muni_crosswalk.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"IBGE-TSE Municipality Code Crosswalk — muni_crosswalk","text":"","code":"muni_crosswalk"},{"path":"https://antrologos.github.io/interpElections/reference/muni_crosswalk.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"IBGE-TSE Municipality Code Crosswalk — muni_crosswalk","text":"data frame 5,710 rows 4 columns: code_ibge Character. IBGE 7-digit municipality code. code_tse Character. TSE 5-digit municipality code. uf Character. Two-letter state abbreviation (e.g., \"SP\", \"RJ\"). nome Character. Municipality name uppercase.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/muni_crosswalk.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"IBGE-TSE Municipality Code Crosswalk — muni_crosswalk","text":"GV-CEPESP, FGV: https://github.com/GV-CEPESP/cepespdata/blob/main/tabelas_auxiliares/dados/codigo_municipio_ibge_tse.csv","code":""},{"path":"https://antrologos.github.io/interpElections/reference/muni_crosswalk.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"IBGE-TSE Municipality Code Crosswalk — muni_crosswalk","text":"","code":"data(muni_crosswalk) # Look up TSE code for Sao Paulo (IBGE 3550308) muni_crosswalk[muni_crosswalk$code_ibge == \"3550308\", ] #>      code_ibge code_tse uf      nome #> 5360   3550308    71072 SP SÃO PAULO"},{"path":"https://antrologos.github.io/interpElections/reference/optimize_alpha.html","id":null,"dir":"Reference","previous_headings":"","what":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","title":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","text":"Optimizes per-zone decay parameters minimize squared error Sinkhorn-balanced interpolated values known population counts. Uses torch autograd gradient computation ADAM optimizer CPU GPU.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/optimize_alpha.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","text":"","code":"optimize_alpha(   time_matrix,   pop_matrix,   source_matrix,   row_targets = NULL,   alpha_init = NULL,   sinkhorn_iter = 5L,   use_gpu = NULL,   device = NULL,   dtype = \"float32\",   gpu_iterations = 20L,   gpu_lr_init = 0.1,   gpu_lr_decay = 0.6,   gpu_grad_tol = 1e-04,   gpu_grad_clip = 1,   gpu_warmup_steps = 10L,   lower_bound = 0,   upper_bound = 20,   offset = 1,   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/optimize_alpha.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","text":"time_matrix Numeric matrix [n x m]. Raw travel times. Rows = target zones, columns = source points. pop_matrix Numeric matrix [n x k]. Known population per zone, k demographic groups columns. source_matrix Numeric matrix [m x k]. Known counts source points (e.g., registered voters age group). row_targets Numeric vector length n, NULL. Target row sums Sinkhorn balancing. element specifies much weight zone attract, proportional share total population. NULL (default), auto-computed rowSums(pop_matrix) / sum(pop_matrix) * m. alpha_init Numeric vector length n, single value recycled. Initial guess alpha. Default: rep(1, n). sinkhorn_iter Integer. Number Sinkhorn iterations per objective evaluation optimization. Higher values give accurate balancing slower. Default: 5 (sufficient optimization; final weights use full convergence via sinkhorn_weights()). use_gpu Logical NULL. TRUE, use GPU (CUDA MPS). FALSE, use CPU. NULL (default), reads package option interpElections.use_gpu (set via use_gpu()). device Character NULL. Torch device: \"cuda\", \"mps\", \"cpu\". used GPU enabled. Default: NULL (auto-detect). dtype Character. Torch dtype: \"float32\" \"float64\". Default: \"float32\". Float32 halves memory usage negligible precision loss. gpu_iterations Integer. Number outer ADAM phases learning rate decay. Default: 20. gpu_lr_init Numeric. Initial ADAM learning rate. Default: 0.1. gpu_lr_decay Numeric. Learning rate decay factor per phase. Default: 0.6. gpu_grad_tol Numeric. Gradient norm threshold convergence. Default: 1e-4. gpu_grad_clip Numeric NULL. Maximum gradient norm clipping. NULL disables clipping. Default: 1.0. gpu_warmup_steps Integer. Linear learning rate warmup steps start phase 1. Default: 10. lower_bound Numeric. Lower bound alpha values. Default: 0. upper_bound Numeric. Upper bound alpha values. Default: 20. offset Numeric. Value added travel times exponentiation. Default: 1. verbose Logical. Print progress messages? Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/optimize_alpha.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","text":"list class \"interpElections_optim\" components: alpha Numeric vector. Optimal alpha values. value Numeric. Objective function value optimum. method Character. Method used (e.g., \"torch_adam_sinkhorn_cpu\", \"torch_adam_sinkhorn_cuda\"). convergence Integer. 0 = success. iterations Number ADAM steps taken. elapsed difftime object. Wall-clock time. message Character. Additional information. history Numeric vector. Objective values step. grad_norm_final Numeric. Final gradient norm. row_targets Numeric vector. Row targets used Sinkhorn. sinkhorn_iter Integer. Sinkhorn iterations used.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/optimize_alpha.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","text":"weight matrix balanced via log-domain Sinkhorn iterations (row sums proportional population, column sums = 1) computing calibration loss. Gradients obtained differentiating unrolled Sinkhorn iterations via torch autograd. optimization requires torch R package. Install setup_torch() already available. Two execution paths: CPU (default): use_gpu = FALSE NULL. Uses torch CPU device. Fast small/medium problems (< 2000 tracts). GPU: use_gpu = TRUE. Uses CUDA MPS. Faster large problems (> 2000 tracts). paths use ADAM optimizer log-domain Sinkhorn. Gradients computed via torch autograd unrolled Sinkhorn iterations.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/optimize_alpha.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Find optimal decay parameters (alpha) for spatial interpolation — optimize_alpha","text":"","code":"if (FALSE) { # \\dontrun{ tt <- matrix(c(2, 5, 3, 4, 6, 2), nrow = 2) pop <- matrix(c(100, 200), nrow = 2) src <- matrix(c(80, 120, 100), nrow = 3) result <- optimize_alpha(tt, pop, src, verbose = FALSE) result$alpha } # }"},{"path":"https://antrologos.github.io/interpElections/reference/plot.interpElections_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot an interpolated variable as a choropleth map — plot.interpElections_result","title":"Plot an interpolated variable as a choropleth map — plot.interpElections_result","text":"Produces ggplot2 choropleth map interpolated variable. Variables can referenced column name, ballot number, candidate name, party abbreviation.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/plot.interpElections_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot an interpolated variable as a choropleth map — plot.interpElections_result","text":"","code":"# S3 method for class 'interpElections_result' plot(   x,   variable = NULL,   type = \"pct_tract\",   palette = \"RdYlBu\",   breaks = \"quantile\",   n_breaks = 5L,   title = NULL,   subtitle = NULL,   legend_title = NULL,   caption = NULL,   show_sources = FALSE,   border_color = \"white\",   border_width = 0.05,   limits = NULL,   scale_bar = TRUE,   ... )  # S3 method for class 'interpElections_result' autoplot(object, ...)"},{"path":"https://antrologos.github.io/interpElections/reference/plot.interpElections_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot an interpolated variable as a choropleth map — plot.interpElections_result","text":"x interpElections_result object. variable Variable plot. Accepts column name (e.g., \"CAND_13\"), ballot number (numeric, e.g. 13), candidate name substring (e.g., \"Lula\"), party abbreviation (e.g., \"PT\"). Multiple values produce faceted comparison. NULL, auto-selects first candidate variable. type Quantity map: \"pct_tract\" (default), \"absolute\", \"pct_muni\", \"pct_valid\", \"pct_eligible\", \"density\". palette Color palette name. RColorBrewer palettes (e.g., \"RdYlBu\", \"YlGnBu\", \"Spectral\") viridis palettes (e.g., \"viridis\", \"magma\", \"plasma\"). Default: \"RdYlBu\" (diverging, colorblind-friendly). breaks Scale breaks: \"quantile\" (default), \"continuous\", \"jenks\" (requires classInt), numeric vector custom break points. n_breaks Number breaks \"quantile\" \"jenks\". Default: 5. title Plot title. NULL = auto-generated dictionary (title-cased candidate name party). subtitle Plot subtitle. NULL = auto-generated municipality/year/quantity metadata. legend_title Legend title. NULL = auto-generated quantity type. caption Plot caption. NULL = auto-generated source note. Use \"\" suppress. show_sources Overlay source points (polling stations) map. Requires sources_sf result (use keep = \"sources_sf\" interpolating). Default: FALSE. border_color Tract border color. Default: \"white\". border_width Tract border width. Default: 0.05. limits Bounding box map extent c(xmin, xmax, ymin, ymax) CRS data (typically longitude/latitude). NULL (default) shows full extent. Use zoom region interest. scale_bar Add scale bar (requires ggspatial). Default: TRUE. ... Ignored. object interpElections_result object.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/plot.interpElections_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot an interpolated variable as a choropleth map — plot.interpElections_result","text":"ggplot object (invisibly). Can customized ggplot2 + syntax.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/plot.interpElections_result.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot an interpolated variable as a choropleth map — plot.interpElections_result","text":"","code":"if (FALSE) { # \\dontrun{ result <- interpolate_election_br(3304557, 2020, 2022)  # By candidate name (default: % of tract votes, quantile breaks) plot(result, variable = \"Lula\")  # By ballot number plot(result, variable = 13)  # Absolute counts with continuous scale plot(result, variable = \"PT\", type = \"absolute\",      breaks = \"continuous\")  # Faceted comparison plot(result, variable = c(\"Lula\", \"Bolsonaro\"))  # Zoom into a region plot(result, variable = \"Lula\",      limits = c(-43.2, -43.1, -22.95, -22.85))  # Composable with ggplot2 library(ggplot2) plot(result, variable = \"PT\") + theme_dark() } # }"},{"path":"https://antrologos.github.io/interpElections/reference/plot_interactive.html","id":null,"dir":"Reference","previous_headings":"","what":"Interactive map of interpolated results — plot_interactive","title":"Interactive map of interpolated results — plot_interactive","text":"Creates interactive leaflet/mapview map interpolated variable. Variables can referenced column name, ballot number, candidate name, party abbreviation. multiple variables provided, creates synchronized side--side panels via leafsync::sync().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/plot_interactive.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Interactive map of interpolated results — plot_interactive","text":"","code":"plot_interactive(   result,   variable = NULL,   type = \"pct_tract\",   palette = \"RdYlBu\",   breaks = \"quantile\",   n_breaks = 5L,   popup_vars = NULL,   alpha = 0.7,   legend = TRUE,   layer_name = NULL,   basemap = \"OpenStreetMap\",   ... )"},{"path":"https://antrologos.github.io/interpElections/reference/plot_interactive.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Interactive map of interpolated results — plot_interactive","text":"result interpElections_result object. variable Variable map. Accepts column name, ballot number (numeric), candidate name substring, party abbreviation. Multiple values create synchronized comparison panels. NULL, auto-selects first candidate variable. type Quantity map: \"pct_tract\" (default), \"absolute\", \"pct_muni\", \"pct_valid\", \"pct_eligible\", \"density\". palette Color palette name. Default: \"RdYlBu\" (diverging, colorblind-friendly). breaks Scale breaks: \"quantile\" (default), \"continuous\", \"jenks\" (requires classInt), numeric vector custom break points. n_breaks Number breaks \"quantile\" \"jenks\". Default: 5. popup_vars Character vector column names show click popups. NULL, auto-selects census tract ID, plotted variable, turnout, calibration columns (capped 8). alpha Fill opacity (0 1). Default: 0.7. legend Show legend. Default: TRUE. layer_name Layer name map. NULL = auto-generated dictionary metadata. basemap Base map tile provider. Default: \"OpenStreetMap\". ... Additional arguments passed mapview::mapview().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/plot_interactive.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Interactive map of interpolated results — plot_interactive","text":"mapview object (single variable) leafsync object (multiple variables synchronized panels).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/plot_interactive.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Interactive map of interpolated results — plot_interactive","text":"","code":"if (FALSE) { # \\dontrun{ result <- interpolate_election_br(3304557, 2020, 2022,                                    keep = \"sources_sf\")  # Interactive map by candidate name plot_interactive(result, variable = \"Lula\", type = \"pct_tract\")  # Side-by-side comparison (synced panels) plot_interactive(result, variable = c(\"Lula\", \"Bolsonaro\"),                  type = \"pct_tract\")  # Custom popup plot_interactive(result, variable = \"PT\",                  popup_vars = c(\"code_tract\", \"PARTY_PT\",                                 \"QT_COMPARECIMENTO\")) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/residuals.interpElections_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute calibration residuals — residuals.interpElections_result","title":"Compute calibration residuals — residuals.interpElections_result","text":"Returns matrix calibration residuals (fitted minus observed) census tract calibration bracket. Requires weight matrix travel time matrix present result (use keep = \"weights\" keep = \"time_matrix\" running interpolation).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/residuals.interpElections_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute calibration residuals — residuals.interpElections_result","text":"","code":"# S3 method for class 'interpElections_result' residuals(object, ...)"},{"path":"https://antrologos.github.io/interpElections/reference/residuals.interpElections_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute calibration residuals — residuals.interpElections_result","text":"object interpElections_result object. ... Ignored.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/residuals.interpElections_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute calibration residuals — residuals.interpElections_result","text":"Numeric matrix [n x k] residuals (fitted - observed), k number calibration brackets. Returns NULL (message) required data available.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/set_interpElections_cache_dir.html","id":null,"dir":"Reference","previous_headings":"","what":"Set a custom interpElections cache directory — set_interpElections_cache_dir","title":"Set a custom interpElections cache directory — set_interpElections_cache_dir","text":"Persists custom cache directory path across R sessions. path NULL, resets default OS-appropriate location.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/set_interpElections_cache_dir.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set a custom interpElections cache directory — set_interpElections_cache_dir","text":"","code":"set_interpElections_cache_dir(path = NULL, verbose = TRUE)"},{"path":"https://antrologos.github.io/interpElections/reference/set_interpElections_cache_dir.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set a custom interpElections cache directory — set_interpElections_cache_dir","text":"path Character NULL. Directory path cached files. Created exist. NULL resets default. verbose Logical. Print confirmation. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/set_interpElections_cache_dir.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Set a custom interpElections cache directory — set_interpElections_cache_dir","text":"Invisibly returns cache directory path.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/set_java_memory.html","id":null,"dir":"Reference","previous_headings":"","what":"Set Java heap memory for r5r — set_java_memory","title":"Set Java heap memory for r5r — set_java_memory","text":"Configures maximum heap size Java Virtual Machine used r5r. Large travel-time matrices can require several gigabytes JVM heap.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/set_java_memory.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set Java heap memory for r5r — set_java_memory","text":"","code":"set_java_memory(size, persist = interactive())"},{"path":"https://antrologos.github.io/interpElections/reference/set_java_memory.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set Java heap memory for r5r — set_java_memory","text":"size Character. Memory size unit suffix, e.g. \"4g\" 4 GB, \"512m\" 512 MB, \"8g\" 8 GB. persist Logical. Also write ~/.Renviron setting persists across R sessions. Default: TRUE interactive sessions.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/set_java_memory.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Set Java heap memory for r5r — set_java_memory","text":"Invisibly, previous value getOption(\"java.parameters\").","code":""},{"path":"https://antrologos.github.io/interpElections/reference/set_java_memory.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Set Java heap memory for r5r — set_java_memory","text":"sets options(java.parameters = \"-Xmx{size}\"). must called r5r (rJava) loaded — JVM starts, heap size changed without restarting R. rule thumb: allocate \\(\\ge 2\\) GB per million OD pairs expect travel-time matrix. municipality 5,000 census tracts 200 polling locations, 1 million pairs — 2-4 GB usually enough. Larger cities (e.g. Sao Paulo) may need 8-16 GB.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/set_java_memory.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Set Java heap memory for r5r — set_java_memory","text":"","code":"if (FALSE) { # \\dontrun{ set_java_memory(\"4g\") set_java_memory(\"8g\", persist = TRUE) } # }"},{"path":"https://antrologos.github.io/interpElections/reference/setup_java.html","id":null,"dir":"Reference","previous_headings":"","what":"Download and configure Java 21 for r5r — setup_java","title":"Download and configure Java 21 for r5r — setup_java","text":"Downloads Adoptium Temurin JDK 21 current platform, extracts local directory, configures R session r5r can find . Optionally persists configuration ~/.Renviron.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_java.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download and configure Java 21 for r5r — setup_java","text":"","code":"setup_java(   install_dir = file.path(tools::R_user_dir(\"interpElections\", \"data\"), \"java\"),   persist = interactive(),   verbose = TRUE )"},{"path":"https://antrologos.github.io/interpElections/reference/setup_java.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download and configure Java 21 for r5r — setup_java","text":"install_dir Character. install Java. Default uses tools::R_user_dir() Java lives alongside R user data. persist Logical. Write JAVA_HOME ~/.Renviron persists across R sessions. Default: TRUE interactive sessions. verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_java.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download and configure Java 21 for r5r — setup_java","text":"Invisibly, path installed JDK.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_java.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download and configure Java 21 for r5r — setup_java","text":"JDK downloaded Eclipse Adoptium project (https://adoptium.net). archive extracted install_dir/jdk-21 JAVA_HOME set current session. persist = TRUE, function appends (updates) JAVA_HOME line ~/.Renviron future R sessions find Java automatically.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_java.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Download and configure Java 21 for r5r — setup_java","text":"","code":"if (FALSE) { # \\dontrun{ setup_java() check_r5r() } # }"},{"path":"https://antrologos.github.io/interpElections/reference/setup_osmium.html","id":null,"dir":"Reference","previous_headings":"","what":"Install osmium-tool for OSM file clipping — setup_osmium","title":"Install osmium-tool for OSM file clipping — setup_osmium","text":"Attempts install osmium-tool (osmconvert fallback) using system package manager. required clip large state-level OSM extracts municipality-level bounding boxes r5r routing.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_osmium.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Install osmium-tool for OSM file clipping — setup_osmium","text":"","code":"setup_osmium(method = NULL, verbose = TRUE)"},{"path":"https://antrologos.github.io/interpElections/reference/setup_osmium.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Install osmium-tool for OSM file clipping — setup_osmium","text":"method Character NULL. Installation method use. NULL (default), auto-detects. Options: \"conda\": conda install (platforms) \"brew\": Homebrew (macOS) \"apt\": apt-get (Debian/Ubuntu) \"dnf\": dnf (Fedora/RHEL) \"download\": Download osmconvert binary (Windows ) verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_osmium.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Install osmium-tool for OSM file clipping — setup_osmium","text":"Invisibly, path installed tool, NULL installation failed.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_osmium.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Install osmium-tool for OSM file clipping — setup_osmium","text":"preferred tool osmium-tool, faster reliable. osmconvert used fallback osmium available. Windows, \"download\" method fetches pre-compiled osmconvert.exe binary saves interpElections cache. require conda package manager.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/setup_osmium.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Install osmium-tool for OSM file clipping — setup_osmium","text":"","code":"if (FALSE) { # \\dontrun{ setup_osmium() setup_osmium(method = \"conda\") setup_osmium(method = \"download\")  # Windows only } # }"},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":null,"dir":"Reference","previous_headings":"","what":"Install and configure torch with GPU support — setup_torch","title":"Install and configure torch with GPU support — setup_torch","text":"Installs torch R package (missing) downloads platform-appropriate libtorch + lantern binaries GPU support. installation, verifies GPU acceleration works via check_torch().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Install and configure torch with GPU support — setup_torch","text":"","code":"setup_torch(reinstall = FALSE, type = NULL, verbose = TRUE)"},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Install and configure torch with GPU support — setup_torch","text":"reinstall Logical. Force re-download libtorch/lantern binaries even already exist. Use fix broken CUDA installations (e.g., CPU-lantern accidentally installed). Default: FALSE. type Character NULL. Installation type, passed torch::install_torch(). Common values: NULL (auto-detect), \"cuda\" (force CUDA Windows/Linux), \"cpu\" (force CPU-). Default: NULL (auto-detect based available GPU). verbose Logical. Default: TRUE.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Install and configure torch with GPU support — setup_torch","text":"Invisibly, result check_torch() installation, partial list needs_restart = TRUE R must restarted.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Install and configure torch with GPU support — setup_torch","text":"installation proceeds stages: torch R package installed, installed CRAN. torch::install_torch() downloads libtorch lantern binaries. Windows/Linux NVIDIA GPU CUDA toolkit, automatically selects CUDA-enabled binaries. verification step runs check_torch() confirm GPU works. Important: torch package already loaded current R session calling setup_torch(), must restart R new binaries take effect. function detects warns accordingly.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":"cuda-auto-detection","dir":"Reference","previous_headings":"","what":"CUDA auto-detection","title":"Install and configure torch with GPU support — setup_torch","text":"torch::install_torch() detects CUDA version : CUDA environment variable (set, forces version) CUDA_PATH (Windows) CUDA_HOME (Linux) nvcc --version PATH","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/setup_torch.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Install and configure torch with GPU support — setup_torch","text":"","code":"if (FALSE) { # \\dontrun{ setup_torch()                    # auto-detect GPU setup_torch(type = \"cuda\")       # force CUDA setup_torch(reinstall = TRUE)    # fix broken install } # }"},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_balance.html","id":null,"dir":"Reference","previous_headings":"","what":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","title":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","text":"Applies alternating row column scaling enforce row column marginal constraints simultaneously. Also known Iterative Proportional Fitting (IPF) RAS algorithm.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_balance.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","text":"","code":"sinkhorn_balance(   W,   row_targets = NULL,   col_targets = NULL,   max_iter = 1000L,   tol = 1e-10 )"},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_balance.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","text":"W Numeric matrix [n x m]. Raw non-negative weight matrix. row_targets Numeric vector length n. Desired row sums. Default: NULL (uniform: rep(sum(col_targets) / n, n)). col_targets Numeric vector length m. Desired column sums. Default: NULL (rep(1, m), preserving source totals). max_iter Integer. Maximum Sinkhorn iterations. Default: 1000. tol Numeric. Convergence tolerance maximum marginal error. Default: 1e-10.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_balance.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","text":"Numeric matrix [n x m] row sums approximately equal row_targets column sums approximately equal col_targets. Attributes: iterations Integer. Number iterations performed. converged Logical. Whether convergence tolerance met. unreachable Integer vector. Indices -zero rows (skipped).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_balance.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","text":"iteration: Row scaling: multiply row row_targets[] / rowSums(W)[] Column scaling: multiply column col_targets[j] / colSums(W)[j] Rows -zero (unreachable targets) skipped scaling remain zero. warning issued listing rows. algorithm requires sum(row_targets) approximately equal sum(col_targets) feasibility. warning issued differ 1\\","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_balance.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Balance a weight matrix using Sinkhorn/IPF iterations — sinkhorn_balance","text":"","code":"W <- matrix(c(3, 1, 0.5, 2, 4, 1.5), nrow = 2) balanced <- sinkhorn_balance(W, row_targets = c(1, 2), col_targets = c(1, 1, 1)) rowSums(balanced)  # approx c(1, 2) #> [1] 1 2 colSums(balanced)  # approx c(1, 1, 1) #> [1] 1 1 1"},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_objective.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute the Sinkhorn-balanced interpolation objective — sinkhorn_objective","title":"Compute the Sinkhorn-balanced interpolation objective — sinkhorn_objective","text":"Calculates sum squared errors Sinkhorn-balanced IDW-interpolated values known population. R-level version loss function used optimize_alpha().","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_objective.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute the Sinkhorn-balanced interpolation objective — sinkhorn_objective","text":"","code":"sinkhorn_objective(   alpha,   time_matrix,   pop_matrix,   source_matrix,   row_targets,   sinkhorn_iter = 50L )"},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_objective.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute the Sinkhorn-balanced interpolation objective — sinkhorn_objective","text":"alpha Numeric vector length n. Decay parameters. time_matrix Numeric matrix [n x m]. Adjusted travel times (offset already applied). Must strictly positive. pop_matrix Numeric matrix [n x k]. Known population per zone. source_matrix Numeric matrix [m x k]. Known counts source points. row_targets Numeric vector length n. Desired row sums Sinkhorn balancing. sinkhorn_iter Integer. Number Sinkhorn iterations. Default: 50.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_objective.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute the Sinkhorn-balanced interpolation objective — sinkhorn_objective","text":"Single numeric value: sum((W_balanced %*% source_matrix - pop_matrix)^2).","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_objective.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute the Sinkhorn-balanced interpolation objective — sinkhorn_objective","text":"Applies sinkhorn_iter iterations alternating row/column scaling enforce population-proportional row margins preserving source conservation (column sums = 1), computes calibration SSE.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Sinkhorn-balanced IDW weights — sinkhorn_weights","title":"Compute Sinkhorn-balanced IDW weights — sinkhorn_weights","text":"Builds inverse distance weights travel-time matrix per-zone decay parameters, applies Sinkhorn balancing enforce row column marginal constraints.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Sinkhorn-balanced IDW weights — sinkhorn_weights","text":"","code":"sinkhorn_weights(   time_matrix,   alpha,   offset = 1,   row_targets = NULL,   col_targets = NULL,   max_iter = 1000L,   tol = 1e-10 )"},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Sinkhorn-balanced IDW weights — sinkhorn_weights","text":"time_matrix Numeric matrix [n x m]. Raw travel times. Rows = target zones, columns = source points. alpha Numeric vector length n. Decay parameters per target zone. offset Numeric. Added travel times applying decay. Default: 1. row_targets Numeric vector length n. Desired row sums. electoral interpolation, use pop / sum(pop) * m pop population vector m = ncol(time_matrix). Default: NULL (uniform allocation). col_targets Numeric vector length m. Desired column sums. Default: NULL (rep(1, m) source conservation). max_iter Integer. Max Sinkhorn iterations. Default: 1000. tol Numeric. Convergence tolerance. Default: 1e-10.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_weights.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Sinkhorn-balanced IDW weights — sinkhorn_weights","text":"Numeric matrix [n x m]. Sinkhorn-balanced weights rowSums(W) approximately equal row_targets colSums(W) approximately equal col_targets. Preserves dimnames time_matrix. Carries attributes sinkhorn_balance().","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/sinkhorn_weights.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Sinkhorn-balanced IDW weights — sinkhorn_weights","text":"","code":"tt <- matrix(c(2, 5, 3, 4, 6, 2), nrow = 2) alpha <- c(1, 1.5) pop <- c(100, 200) m <- ncol(tt) W <- sinkhorn_weights(tt, alpha, row_targets = pop / sum(pop) * m) colSums(W)  # approx 1 (source conservation) #> [1] 1 1 1 rowSums(W)  # proportional to population #> [1] 1 2"},{"path":"https://antrologos.github.io/interpElections/reference/summary.interpElections_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize an interpElections result — summary.interpElections_result","title":"Summarize an interpElections result — summary.interpElections_result","text":"Prints detailed summary including calibration information, optimization details, per-variable statistics.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/summary.interpElections_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize an interpElections result — summary.interpElections_result","text":"","code":"# S3 method for class 'interpElections_result' summary(object, ...)"},{"path":"https://antrologos.github.io/interpElections/reference/summary.interpElections_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize an interpElections result — summary.interpElections_result","text":"object interpElections_result object. ... Ignored.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/summary.interpElections_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize an interpElections result — summary.interpElections_result","text":"Invisibly returns object.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/use_gpu.html","id":null,"dir":"Reference","previous_headings":"","what":"Enable or disable GPU acceleration — use_gpu","title":"Enable or disable GPU acceleration — use_gpu","text":"Sets package-wide options controlling whether optimize_alpha() uses GPU-accelerated optimization (torch ADAM) CPU-methods.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/use_gpu.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Enable or disable GPU acceleration — use_gpu","text":"","code":"use_gpu(enable = TRUE, device = NULL, dtype = \"float32\")"},{"path":"https://antrologos.github.io/interpElections/reference/use_gpu.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Enable or disable GPU acceleration — use_gpu","text":"enable Logical. TRUE enable GPU, FALSE CPU . device Character NULL. Torch device: \"cuda\", \"mps\", \"cpu\". NULL = auto-detect. dtype Character. \"float32\" \"float64\". Default: \"float32\".","code":""},{"path":"https://antrologos.github.io/interpElections/reference/use_gpu.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Enable or disable GPU acceleration — use_gpu","text":"Invisibly returns previous settings list.","code":""},{"path":"https://antrologos.github.io/interpElections/reference/use_gpu.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Enable or disable GPU acceleration — use_gpu","text":"GPU enabled, optimize_alpha() uses torch ADAM optimizer default. requires torch package installed working GPU backend (CUDA NVIDIA, MPS Apple Silicon). per-call use_gpu parameter optimize_alpha() always overrides global setting.","code":""},{"path":[]},{"path":"https://antrologos.github.io/interpElections/reference/use_gpu.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Enable or disable GPU acceleration — use_gpu","text":"","code":"use_gpu(FALSE) # ensure CPU mode #> GPU disabled. Using CPU optimization."}]
